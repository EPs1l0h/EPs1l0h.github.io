<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>unicorn模拟执行初探 | EPs1l0h's Castle</title><meta name="author" content="EPs1l0h"><meta name="copyright" content="EPs1l0h"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="从放寒假摆到现在，哈哈，再不学 re 👶要被开咯，本来想写写安洵杯的题的，结果从 pyc 开始后面全几把粪题，出题人自己都没玩明白，果断放弃（笑嘻了），RCTF 据说有个 unicorn ，之前大爹也说过 unicorn 模拟执行这个玩意儿，感觉很高级，找了一篇还能看的懂的年前起个头学一下。 什么是unicorn一些官方翻译Unicorn是一个轻量级，多平台，多架构的CPU模拟器框架，基于qem">
<meta property="og:type" content="article">
<meta property="og:title" content="unicorn模拟执行初探">
<meta property="og:url" content="https://example.com/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/index.html">
<meta property="og:site_name" content="EPs1l0h&#39;s Castle">
<meta property="og:description" content="从放寒假摆到现在，哈哈，再不学 re 👶要被开咯，本来想写写安洵杯的题的，结果从 pyc 开始后面全几把粪题，出题人自己都没玩明白，果断放弃（笑嘻了），RCTF 据说有个 unicorn ，之前大爹也说过 unicorn 模拟执行这个玩意儿，感觉很高级，找了一篇还能看的懂的年前起个头学一下。 什么是unicorn一些官方翻译Unicorn是一个轻量级，多平台，多架构的CPU模拟器框架，基于qem">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover1.jpg?raw=true">
<meta property="article:published_time" content="2023-01-18T14:54:05.000Z">
<meta property="article:modified_time" content="2024-04-04T05:29:11.040Z">
<meta property="article:author" content="EPs1l0h">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover1.jpg?raw=true"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://example.com/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'unicorn模拟执行初探',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-04 13:29:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover1.jpg?raw=true')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">EPs1l0h's Castle</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">unicorn模拟执行初探</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-18T14:54:05.000Z" title="发表于 2023-01-18 22:54:05">2023-01-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-04T05:29:11.040Z" title="更新于 2024-04-04 13:29:11">2024-04-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="unicorn模拟执行初探"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>从放寒假摆到现在，哈哈，再不学 re 👶要被开咯，本来想写写安洵杯的题的，结果从 pyc 开始后面全几把粪题，出题人自己都没玩明白，果断放弃（笑嘻了），RCTF 据说有个 unicorn ，之前大爹也说过 unicorn 模拟执行这个玩意儿，感觉很高级，<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-224330.htm#msg_header_h3_2">找了一篇还能看的懂的</a>年前起个头学一下。</p>
<h1 id="什么是unicorn"><a href="#什么是unicorn" class="headerlink" title="什么是unicorn"></a>什么是unicorn</h1><h2 id="一些官方翻译"><a href="#一些官方翻译" class="headerlink" title="一些官方翻译"></a>一些官方翻译</h2><p>Unicorn是一个轻量级，多平台，多架构的CPU模拟器框架，基于qemu开发，它可以代替CPU模拟代码的执行，就比如说我们需要调试某个程序，常见的调试器需要配置可执行文件需要的环境并且还需要考虑一些恶意代码导致的安全问题，但是通过unicorn我们就可以单纯的模拟代码的执行（甚至可以指定从某个地址开始执行）而不需要考虑这些问题。</p>
<p>它的亮点(这也归功于Unicorn是基于<a target="_blank" rel="noopener" href="http://www.qemu.org/">qemu</a>而开发的)有:</p>
<ul>
<li>支持多种架构: Arm, Arm64 (Armv8), M68K, Mips, Sparc, &amp; X86 (include X86_64).</li>
<li>对Windows和<em>nix系统(已确认包含Mac OSX, Linux, </em>BSD &amp; Solaris)的原生支持</li>
<li>具有平台独立且简洁易于使用的API</li>
<li>使用JIT编译技术, 性能表现优异</li>
</ul>
<h2 id="Unicorn-快速入门"><a href="#Unicorn-快速入门" class="headerlink" title="Unicorn 快速入门"></a>Unicorn 快速入门</h2><p>摘自博客 <a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1026209-1-1.html">汇编与反汇编神器Unicorn - 『移动安全区』 - 吾爱破解 - LCG - LSG |安卓破解|病毒分析|www.52pojie.cn</a> </p>
<h3 id="多架构"><a href="#多架构" class="headerlink" title="多架构"></a>多架构</h3><p>Unicorn 是一款基于qemu模拟器的模拟执行框架，支持Arm, Arm64 (Armv8), M68K, Mips, Sparc, &amp; X86 (include X86_64)等指令集。</p>
<h3 id="多语言"><a href="#多语言" class="headerlink" title="多语言"></a>多语言</h3><p>Unicorn 为多种语言提供编程接口比如C/C++、Python、Java 等语言。Unicorn的DLL 可以被更多的语言调用，比如易语言、Delphi，前途无量。</p>
<h3 id="多线程安全"><a href="#多线程安全" class="headerlink" title="多线程安全"></a>多线程安全</h3><p>Unicorn 设计之初就考虑到线程安全问题，能够同时并发模拟执行代码，极大的提高了实用性。</p>
<h3 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h3><p>Unicorn 采用虚拟内存机制，使得虚拟CPU的内存与真实CPU的内存隔离。Unicorn 使用如下API来操作内存:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uc_mem_map</span><br><span class="line">uc_mem_read</span><br><span class="line">uc_mem_write</span><br></pre></td></tr></table></figure><br>使用uc_mem_map映射内存的时候，address 与 size 都需要与0x1000对齐，也就是0x1000的整数倍，否则会报UC_ERR_ARG 异常。</p>
<h3 id="Hook-机制"><a href="#Hook-机制" class="headerlink" title="Hook 机制"></a>Hook 机制</h3><p>Unicorn的Hook机制为编程控制虚拟CPU提供了便利。<br>Unicorn 支持多种不同类型的Hook。<br>大致可以分为(hook_add第一参数，Unicorn常量)：</p>
<h3 id="指令执行类"><a href="#指令执行类" class="headerlink" title="指令执行类"></a>指令执行类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UC_HOOK_INTR</span><br><span class="line">UC_HOOK_INSN</span><br><span class="line">UC_HOOK_CODE</span><br><span class="line">UC_HOOK_BLOCK</span><br></pre></td></tr></table></figure>
<h3 id="内存访问类"><a href="#内存访问类" class="headerlink" title="内存访问类"></a>内存访问类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UC_HOOK_MEM_READ</span><br><span class="line">UC_HOOK_MEM_WRITE</span><br><span class="line">UC_HOOK_MEM_FETCH</span><br><span class="line">UC_HOOK_MEM_READ_AFTER</span><br><span class="line">UC_HOOK_MEM_PROT</span><br><span class="line">UC_HOOK_MEM_FETCH_INVALID</span><br><span class="line">UC_HOOK_MEM_INVALID</span><br><span class="line">UC_HOOK_MEM_VALID</span><br></pre></td></tr></table></figure>
<h3 id="异常处理类"><a href="#异常处理类" class="headerlink" title="异常处理类"></a>异常处理类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UC_HOOK_MEM_READ_UNMAPPED</span><br><span class="line">UC_HOOK_MEM_WRITE_UNMAPPED</span><br><span class="line">UC_HOOK_MEM_FETCH_UNMAPPED</span><br></pre></td></tr></table></figure>
<p>调用hook_add函数可添加一个Hook。Unicorn的Hook是链式的，而不是传统Hook的覆盖式，也就是说，可以同时添加多个同类型的Hook，Unicorn会依次调用每一个handler。hook callback 是有作用范围的（见hook_add begin参数）。 </p>
<h1 id="Task1"><a href="#Task1" class="headerlink" title="Task1"></a>Task1</h1><h2 id="程序逻辑"><a href="#程序逻辑" class="headerlink" title="程序逻辑"></a>程序逻辑</h2><p>一个 ELF 文件，打开以后自动输出flag，但是输出的越来越便秘</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1674054916412.png" alt="1674054916412"></p>
<p>用 ida 分析一下发现是通过斐波那契数列拖慢程序执行速度并且和输出的 flag 之间进行绑定：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// ebx</span></span><br><span class="line">  __int64 v5; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// r9</span></span><br><span class="line">  __int64 v7; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">int</span> v10[<span class="number">7</span>]; <span class="comment">// [rsp+Ch] [rbp-1Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = (<span class="type">char</span> *)&amp;unk_4007E1;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">setbuf</span>(stdout, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The flag is: &quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">LODWORD</span>(v5) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v10[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">fibonacci</span>(v4 + v5, v10);</span><br><span class="line">      v8 = v7;</span><br><span class="line">      v5 = v7 + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v5 != <span class="number">8</span> );</span><br><span class="line">    v4 += <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)(v10[<span class="number">0</span>] &lt;&lt; v8) == v6 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ++v3;</span><br><span class="line">    _IO_putc(v6 ^ (<span class="type">unsigned</span> __int8)(<span class="built_in">LOBYTE</span>(v10[<span class="number">0</span>]) &lt;&lt; v8), stdout);</span><br><span class="line">  &#125;</span><br><span class="line">  _IO_putc(<span class="number">10</span>, stdout);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以考虑把整个程序重写一遍然后优化一下，但是对于这道题来说有些麻烦，我们考虑用unicorn来获得 flag。<del>（好吧对于我来说这个方法更麻烦）</del></p>
<h2 id="unicorn模拟执行"><a href="#unicorn模拟执行" class="headerlink" title="unicorn模拟执行"></a>unicorn模拟执行</h2><p>使用Unicorn引擎之前需要手动初始化内存，我们需要初始化所有的寄存器，把这段代码装载到某个地方，并且分配一段栈空间，同时在执行代码之前我们还得在模拟执行之前加入hook函数，参数如下：</p>
<ul>
<li><code>Uc</code>实例句柄</li>
<li>指令的地址</li>
<li>执行的长度</li>
<li>用户自定义数据（我们可以在<code>hook_add</code>的可选参数中传递这个值）</li>
</ul>
<p>具体代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> * <span class="comment"># 加载主要的二进制模块和一些Unicorn中的一些基本常量</span></span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> * <span class="comment"># 加载一些特定的x86和x64的常量</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * <span class="comment"># 这里主要用到 u32 和 p32 两个函数，u32将4字节的string转换为integer，以小端序表示这个数据，p32与u32相反</span></span><br><span class="line"></span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_64) <span class="comment"># 第一个参数：架构类型，第二个参数：架构细节说明，为x86-64架构初始化一下Unicorn引擎</span></span><br><span class="line">BASE_ADDR = <span class="number">0x400000</span> <span class="comment"># 基址</span></span><br><span class="line">STACK_ADDR = <span class="number">0x0</span> <span class="comment"># 栈地址</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span> <span class="comment"># 栈空间</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE_ADDR, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE) <span class="comment"># mem_map函数来映射内存</span></span><br><span class="line">mu.mem_write(BASE_ADDR, read(<span class="string">&quot;./fibonacci&quot;</span>)) <span class="comment"># read仅仅返回文件中的内容，加载二进制文件到基址上</span></span><br><span class="line">mu.reg_write(UC_X86_REG_RSP, STACK_ADDR + STACK_SIZE - <span class="number">1</span>) <span class="comment"># 初始化RSP寄存器指向栈底（倒着的）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>): <span class="comment"># 在启动之前写一个hook函数来输出我们需要的信息</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27;</span> % (address, size))</span><br><span class="line">    </span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code) <span class="comment"># 添加hook</span></span><br><span class="line">mu.emu_start(<span class="number">0x4004E0</span>, <span class="number">0x400575</span>) <span class="comment"># 启动模拟执行，起始从main函数开始，遇到while循坏外面的IO_putc结束 </span></span><br></pre></td></tr></table></figure>
<p>执行该文件，我们就可以获取从main函数开始每一步指令的地址和指令大小</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1674056409459.png" alt="1674056409459"></p>
<p>并且我们也知道了从 <code>0x3003EF</code>这个地方出现了问题，我们看一眼这里是个啥代码</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1674056457576.png" alt="1674056457576"></p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1674056660721.png" alt="1674056660721"></p>
<p>这里的stdout是 bss 段的，但是我们并没有分配该区段，所以会报错，同时这一行对我们的模拟执行并没有影响，我们可以将其地址加入黑名单，遇到了直接跳过即可，此外，对于其它的会报错但是我们不需要的指令我们采用同样的方法进行跳过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:0x4004EF                 mov     rdi, cs:stdout  ; stream</span><br><span class="line">.text:0x4004F6                 call    _setbuf</span><br><span class="line">.text:0x400502                 call    _printf</span><br><span class="line">.text:0x40054F                 mov     rsi, cs:stdout  ; fp</span><br></pre></td></tr></table></figure>
<p>我们采用修改 RIP 寄存器的方法进行指令的跳过：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mu.reg_write(UC_X86_REG_RIP, address + size)</span><br></pre></td></tr></table></figure>
<p>同时修改 hook 函数，先判断 instruction 是否在黑名单中，之后我们需要关注的就是输出 flag，由于 IO_putc 会把输出结果暂存到 RDI 寄存器中，我们直接打印 RDI 寄存器的内容即可，得到如下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> * <span class="comment"># 加载主要的二进制模块和一些Unicorn中的一些基本常量</span></span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> * <span class="comment"># 加载一些特定的x86和x64的常量</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * <span class="comment"># 这里主要用到 u32 和 p32 两个函数，u32将4字节的string转换为integer，以小端序表示这个数据，p32与u32相反</span></span><br><span class="line"></span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_64) <span class="comment"># 第一个参数：架构类型，第二个参数：架构细节说明，为x86-64架构初始化一下Unicorn引擎</span></span><br><span class="line">BASE_ADDR = <span class="number">0x400000</span> <span class="comment"># 基址</span></span><br><span class="line">STACK_ADDR = <span class="number">0x0</span> <span class="comment"># 栈地址</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span> <span class="comment"># 栈空间</span></span><br><span class="line">mu.mem_map(BASE_ADDR, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE) <span class="comment"># mem_map函数来映射内存</span></span><br><span class="line">mu.mem_write(BASE_ADDR, read(<span class="string">&quot;./fibonacci&quot;</span>)) <span class="comment"># read仅仅返回文件中的内容，加载二进制文件到基址上</span></span><br><span class="line">mu.reg_write(UC_X86_REG_RSP, STACK_ADDR + STACK_SIZE - <span class="number">1</span>) <span class="comment"># 初始化RSP寄存器指向栈底（倒着的）</span></span><br><span class="line"></span><br><span class="line">Inst_skip_list = [<span class="number">0x4004EF</span>, <span class="number">0x4004F6</span>, <span class="number">0x400502</span>, <span class="number">0x40054F</span>] <span class="comment"># 需要跳过的黑名单</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>): <span class="comment"># 在启动之前写一个hook函数来输出我们需要的信息</span></span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; % (address, size))</span></span><br><span class="line">    <span class="keyword">if</span> address <span class="keyword">in</span> Inst_skip_list: <span class="comment"># 遇到了就跳过避免报错</span></span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address + size)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x400560</span>: <span class="comment"># 如果遇到了输出函数就打印输出的内容</span></span><br><span class="line">        flag = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        <span class="built_in">print</span>((<span class="built_in">chr</span>(flag)), end = <span class="string">&quot;&quot;</span>)</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address + size)</span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code) <span class="comment"># 添加hook</span></span><br><span class="line">mu.emu_start(<span class="number">0x4004E0</span>, <span class="number">0x400575</span>) <span class="comment"># 启动模拟执行</span></span><br></pre></td></tr></table></figure>
<p>此时我们可以通过模拟执行来实现对 main 函数的模拟，但是却并没有解决 flag 输出便秘的问题。</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1674057234095.png" alt="1674057234095"></p>
<p>那么如何提高程序执行的效率呢？</p>
<h2 id="修改hook函数提高效率"><a href="#修改hook函数提高效率" class="headerlink" title="修改hook函数提高效率"></a>修改hook函数提高效率</h2><p>根据之前的分析，斐波那契函数是一个递归函数，而且在该程序中反复调用，当所求项数越来越大，那么程序运行必然也越来越慢，且时间呈指数级上升，此时如果我们采用记忆化搜索的方法，那么就可以大大提升数列的求解效率。</p>
<p>我们可以看到 <code>fibonacci</code> 这个函数有两个参数</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1674057879022.png" alt="1674057879022"></p>
<p>第一个参数在进入的时候存在 EDI 寄存器中，第二个参数是一个指针，用 RSI 寄存器储存，同时返回值也有两个，第一个存在 RAX 寄存器中，第二个就是指针存在 RSI 寄存器中。</p>
<p>我们考虑用一个 dp 数组来存储这两个参数，并在入口处判断输入进该函数的两个参数之前是否被访问过，如果被访问过就直接 return 相应的返回值，否则就执行该函数并且记录下该参数对应的返回值。</p>
<p>由于这是一个递归过程，我们还需要用一个栈来存储每个参数对应的返回值，此外，也是由于递归的特性，我们在返回的时候由于函数本身处于hook中，所以我们需要从其它没有被hook的函数中随便找一个retn指令进行返回。</p>
<p>基于上述分析得到最终的 exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> * <span class="comment"># 加载主要的二进制模块和一些Unicorn中的一些基本常量</span></span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> * <span class="comment"># 加载一些特定的x86和x64的常量</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * <span class="comment"># 这里主要用到 u32 和 p32 两个函数，u32将4字节的string转换为integer，以小端序表示这个数据，p32与u32相反</span></span><br><span class="line"></span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_64) <span class="comment"># 第一个参数：架构类型，第二个参数：架构细节说明，为x86-64架构初始化一下Unicorn引擎</span></span><br><span class="line">BASE_ADDR = <span class="number">0x400000</span> <span class="comment"># 基址</span></span><br><span class="line">STACK_ADDR = <span class="number">0x0</span> <span class="comment"># 栈地址</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span> <span class="comment"># 栈空间</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE_ADDR, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE) <span class="comment"># mem_map函数来映射内存</span></span><br><span class="line">mu.mem_write(BASE_ADDR, read(<span class="string">&quot;./fibonacci&quot;</span>)) <span class="comment"># read仅仅返回文件中的内容，加载二进制文件到基址上</span></span><br><span class="line">mu.reg_write(UC_X86_REG_RSP, STACK_ADDR + STACK_SIZE - <span class="number">1</span>) <span class="comment"># 初始化RSP寄存器指向栈底（倒着的）</span></span><br><span class="line"></span><br><span class="line">Inst_skip_list = [<span class="number">0x4004EF</span>, <span class="number">0x4004F6</span>, <span class="number">0x400502</span>, <span class="number">0x40054F</span>]</span><br><span class="line">FIBONACCI_ENTRY = <span class="number">0x400670</span></span><br><span class="line"></span><br><span class="line">stack =  []</span><br><span class="line">dp = &#123;&#125;</span><br><span class="line">FIBONACCI_ENTRY = <span class="number">0x400670</span></span><br><span class="line">FIBONACCI_END = [<span class="number">0x4006F1</span>, <span class="number">0x400709</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>): <span class="comment"># 在启动之前写一个hook函数来输出我们需要的信息</span></span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; % (address, size))</span></span><br><span class="line">    <span class="keyword">if</span> address <span class="keyword">in</span> Inst_skip_list: <span class="comment"># 遇到了就跳过避免报错</span></span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address + size)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x400560</span>: <span class="comment"># 如果遇到了输出函数就打印输出的内容</span></span><br><span class="line">        flag = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        <span class="built_in">print</span>((<span class="built_in">chr</span>(flag)), end = <span class="string">&quot;&quot;</span>)</span><br><span class="line">        mu.reg_write(UC_X86_REG_RIP, address + size)</span><br><span class="line">    <span class="keyword">elif</span> address == FIBONACCI_ENTRY: <span class="comment"># 遇到fibonacci函数的入口</span></span><br><span class="line">        <span class="comment"># 把参数存储下来</span></span><br><span class="line">        arg0 = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line">        rsi = mu.reg_read(UC_X86_REG_RSI) <span class="comment"># 用rsi存储地址，这里是间接寻址，（rsi）是数据</span></span><br><span class="line">        arg1 = u32(mu.mem_read(rsi, <span class="number">4</span>))</span><br><span class="line">        <span class="comment"># 判断参数是否被访问过，如果被访问过就把dp数组中的第一个参数赋给RAX寄存器，第二个参数的数据写入rsi指向的地址中</span></span><br><span class="line">        <span class="keyword">if</span> (arg0, arg1) <span class="keyword">in</span> dp:</span><br><span class="line">            (ret_rax, ret_ref) = dp[(arg0, arg1)]</span><br><span class="line">            mu.reg_write(UC_X86_REG_RAX, ret_rax)</span><br><span class="line">            mu.mem_write(rsi, p32(ret_ref))</span><br><span class="line">            mu.reg_write(UC_X86_REG_RIP, <span class="number">0x400582</span>) <span class="comment"># 由于此时fibonacci这个函数还在被hook中，所以不能跳转到该函数本身的ret指令</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stack.append((arg0, arg1, rsi)) <span class="comment"># 不在dp数组中就入栈</span></span><br><span class="line">    <span class="keyword">elif</span> address <span class="keyword">in</span> FIBONACCI_END: <span class="comment"># 遇到fibonacci函数的出口，从栈顶拿出数据建立dp数组的映射</span></span><br><span class="line">        (arg0, arg1, rsi) = stack.pop()</span><br><span class="line">        ret_rax = mu.reg_read(UC_X86_REG_RAX)</span><br><span class="line">        ret_ref = u32(mu.mem_read(rsi, <span class="number">4</span>))</span><br><span class="line">        dp[(arg0, arg1)] = (ret_rax, ret_ref)</span><br><span class="line"></span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code) <span class="comment"># 添加hook</span></span><br><span class="line">mu.emu_start(<span class="number">0x4004E0</span>, <span class="number">0x400575</span>) <span class="comment"># 启动模拟执行</span></span><br></pre></td></tr></table></figure>
<p>此时再运行我们就可以得到 flag <code>hxp&#123;F1b0n4cCi_numZ_4r3_T0O_3a5Y&#125;</code></p>
<h1 id="Task2"><a href="#Task2" class="headerlink" title="Task2"></a>Task2</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shellcode = <span class="string">b&quot;\xe8\xff\xff\xff\xff\xc0\x5d\x6a\x05\x5b\x29\xdd\x83\xc5\x4e\x89\xe9\x6a\x02\x03\x0c\x24\x5b\x31\xd2\x66\xba\x12\x00\x8b\x39\xc1\xe7\x10\xc1\xef\x10\x81\xe9\xfe\xff\xff\xff\x8b\x45\x00\xc1\xe0\x10\xc1\xe8\x10\x89\xc3\x09\xfb\x21\xf8\xf7\xd0\x21\xd8\x66\x89\x45\x00\x83\xc5\x02\x4a\x85\xd2\x0f\x85\xcf\xff\xff\xff\xec\x37\x75\x5d\x7a\x05\x28\xed\x24\xed\x24\xed\x0b\x88\x7f\xeb\x50\x98\x38\xf9\x5c\x96\x2b\x96\x70\xfe\xc6\xff\xc6\xff\x9f\x32\x1f\x58\x1e\x00\xd3\x80&quot;</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h2 id="一些hint"><a href="#一些hint" class="headerlink" title="一些hint"></a>一些hint</h2><p>注意：代码基于<code>x86-32</code>架构。syscall 的调用号所对应的功能可以<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29343201/article/details/52209588">在这里找到</a></p>
<p>你可以HOOK<a target="_blank" rel="noopener" href="https://blog.csdn.net/shyanyang/article/details/8857555"><code>int 80h</code></a>指令，二进制代码是<code>cd 80</code>，然后读取寄存器和内存。请记住，shellcode是可以在任何地址被加载执行的代码，绝大多数的shellcode使用栈来执行。</p>
<h2 id="shellcode转汇编"><a href="#shellcode转汇编" class="headerlink" title="shellcode转汇编"></a>shellcode转汇编</h2><p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1675429793726.png" alt="1675429793726"></p>
<p>得到的汇编语言如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> 0:    e8 ff ff ff ff           call   0x4</span><br><span class="line"> 5:    c0 5d 6a 05              rcr    BYTE PTR [ebp+0x6a],  0x5</span><br><span class="line"> 9:    5b                       pop    ebx</span><br><span class="line"> a:    29 dd                    sub    ebp,  ebx</span><br><span class="line"> c:    83 c5 4e                 add    ebp,  0x4e</span><br><span class="line"> f:    89 e9                    mov    ecx,  ebp</span><br><span class="line">11:    6a 02                    push   0x2</span><br><span class="line">13:    03 0c 24                 add    ecx,  DWORD PTR [esp]</span><br><span class="line">16:    5b                       pop    ebx</span><br><span class="line">17:    31 d2                    xor    edx,  edx</span><br><span class="line">19:    66 ba 12 00              mov    dx,  0x12</span><br><span class="line">1d:    8b 39                    mov    edi,  DWORD PTR [ecx]</span><br><span class="line">1f:    c1 e7 10                 shl    edi,  0x10</span><br><span class="line">22:    c1 ef 10                 shr    edi,  0x10</span><br><span class="line">25:    81 e9 fe ff ff ff        sub    ecx,  0xfffffffe</span><br><span class="line">2b:    8b 45 00                 mov    eax,  DWORD PTR [ebp+0x0]</span><br><span class="line">2e:    c1 e0 10                 shl    eax,  0x10</span><br><span class="line">31:    c1 e8 10                 shr    eax,  0x10</span><br><span class="line">34:    89 c3                    mov    ebx,  eax</span><br><span class="line">36:    09 fb                    or     ebx,  edi</span><br><span class="line">38:    21 f8                    and    eax,  edi</span><br><span class="line">3a:    f7 d0                    not    eax</span><br><span class="line">3c:    21 d8                    and    eax,  ebx</span><br><span class="line">3e:    66 89 45 00              mov    WORD PTR [ebp+0x0],  ax</span><br><span class="line">42:    83 c5 02                 add    ebp,  0x2</span><br><span class="line">45:    4a                       dec    edx</span><br><span class="line">46:    85 d2                    test   edx,  edx</span><br><span class="line">48:    0f 85 cf ff ff ff        jne    0x1d</span><br><span class="line">4e:    ec                       in     al,  dx</span><br><span class="line">4f:    37                       aaa</span><br><span class="line">50:    75 5d                    jne    0xaf</span><br><span class="line">52:    7a 05                    jp     0x59</span><br><span class="line">54:    28 ed                    sub    ch,  ch</span><br><span class="line">56:    24 ed                    and    al,  0xed</span><br><span class="line">58:    24 ed                    and    al,  0xed</span><br><span class="line">5a:    0b 88 7f eb 50 98        or     ecx,  DWORD PTR [eax-0x67af1481]</span><br><span class="line">60:    38 f9                    cmp    cl,  bh</span><br><span class="line">62:    5c                       pop    esp</span><br><span class="line">63:    96                       xchg   esi,  eax</span><br><span class="line">64:    2b 96 70 fe c6 ff        sub    edx,  DWORD PTR [esi-0x390190]</span><br><span class="line">6a:    c6                       (bad)</span><br><span class="line">6b:    ff 9f 32 1f 58 1e        call   FWORD PTR [edi+0x1e581f32]</span><br><span class="line">71:    00 d3                    add    bl,  dl</span><br><span class="line">73:    80                       .byte 0x80</span><br></pre></td></tr></table></figure>
<h2 id="unicorn模拟执行-1"><a href="#unicorn模拟执行-1" class="headerlink" title="unicorn模拟执行"></a>unicorn模拟执行</h2><p>可以看到汇编的最下面是一条 <code>int 80</code>语句，那么我们对其进行hook，在遇到 <code>int 80</code> 指令的时候输出 syscall 的调用号来确定程序都进行了哪些调用，通过查询汇编可知，在进行 syscall 调用时， eax 寄存器存的是调用号。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">b&quot;\xe8\xff\xff\xff\xff\xc0\x5d\x6a\x05\x5b\x29\xdd\x83\xc5\x4e\x89\xe9\x6a\x02\x03\x0c\x24\x5b\x31\xd2\x66\xba\x12\x00\x8b\x39\xc1\xe7\x10\xc1\xef\x10\x81\xe9\xfe\xff\xff\xff\x8b\x45\x00\xc1\xe0\x10\xc1\xe8\x10\x89\xc3\x09\xfb\x21\xf8\xf7\xd0\x21\xd8\x66\x89\x45\x00\x83\xc5\x02\x4a\x85\xd2\x0f\x85\xcf\xff\xff\xff\xec\x37\x75\x5d\x7a\x05\x28\xed\x24\xed\x24\xed\x0b\x88\x7f\xeb\x50\x98\x38\xf9\x5c\x96\x2b\x96\x70\xfe\xc6\xff\xc6\xff\x9f\x32\x1f\x58\x1e\x00\xd3\x80&quot;</span></span><br><span class="line"></span><br><span class="line">BASE = <span class="number">0x400000</span></span><br><span class="line">STACK_ADDR = <span class="number">0x0</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_32)</span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE)</span><br><span class="line"></span><br><span class="line">mu.mem_write(BASE, shellcode)</span><br><span class="line">mu.reg_write(UC_X86_REG_ESP, STACK_ADDR + STACK_SIZE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; %(address, size))</span></span><br><span class="line"></span><br><span class="line">    machine_code = mu.mem_read(address, size)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (machine_code == <span class="string">b&quot;\xcd\x80&quot;</span>): <span class="comment"># 对 int 8 指令进行hook</span></span><br><span class="line">        r_eax = mu.reg_read(UC_X86_REG_EAX) <span class="comment"># dump eax 寄存器</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;intercepted system call: &quot;</span> + <span class="built_in">str</span>(r_eax))</span><br><span class="line">        mu.reg_write(UC_X86_REG_EIP, address + size) <span class="comment"># 跳过int8指令</span></span><br><span class="line">        </span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line">mu.emu_start(BASE, BASE - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1675432495733.png" alt="1675432495733"></p>
<h2 id="打印-chmod-和-exit-的参数"><a href="#打印-chmod-和-exit-的参数" class="headerlink" title="打印 chmod 和 exit 的参数"></a>打印 chmod 和 exit 的参数</h2><p>通过对照发现是 <code>chmod</code> 和 <code>exit</code> 两个系统调用，修改 hook 函数对其进行特判输出详细信息，同时结合汇编一共用到了  <code>eax, ebx, ecx, edx</code> 四个寄存器存储对应调用的参数，我们也把这几个寄存器的数据给 dump 下来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">b&quot;\xe8\xff\xff\xff\xff\xc0\x5d\x6a\x05\x5b\x29\xdd\x83\xc5\x4e\x89\xe9\x6a\x02\x03\x0c\x24\x5b\x31\xd2\x66\xba\x12\x00\x8b\x39\xc1\xe7\x10\xc1\xef\x10\x81\xe9\xfe\xff\xff\xff\x8b\x45\x00\xc1\xe0\x10\xc1\xe8\x10\x89\xc3\x09\xfb\x21\xf8\xf7\xd0\x21\xd8\x66\x89\x45\x00\x83\xc5\x02\x4a\x85\xd2\x0f\x85\xcf\xff\xff\xff\xec\x37\x75\x5d\x7a\x05\x28\xed\x24\xed\x24\xed\x0b\x88\x7f\xeb\x50\x98\x38\xf9\x5c\x96\x2b\x96\x70\xfe\xc6\xff\xc6\xff\x9f\x32\x1f\x58\x1e\x00\xd3\x80&quot;</span></span><br><span class="line"></span><br><span class="line">BASE = <span class="number">0x400000</span></span><br><span class="line">STACK_ADDR = <span class="number">0x0</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_32)</span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE)</span><br><span class="line"></span><br><span class="line">mu.mem_write(BASE, shellcode)</span><br><span class="line">mu.reg_write(UC_X86_REG_ESP, STACK_ADDR + STACK_SIZE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">syscall_num_to_name</span>(<span class="params">num</span>): <span class="comment"># 一共只有两种syscall</span></span><br><span class="line">    syscalls = &#123;<span class="number">1</span>: <span class="string">&quot;sys_exit&quot;</span>, <span class="number">15</span>: <span class="string">&quot;sys_chmod&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> syscalls[num]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; %(address, size))</span></span><br><span class="line"></span><br><span class="line">    machine_code = mu.mem_read(address, size)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (machine_code == <span class="string">b&quot;\xcd\x80&quot;</span>): <span class="comment"># 对 int 8 指令进行hook</span></span><br><span class="line">        r_eax = mu.reg_read(UC_X86_REG_EAX) <span class="comment"># dump 需要用的寄存器</span></span><br><span class="line">        r_ebx = mu.reg_read(UC_X86_REG_EBX)</span><br><span class="line">        r_ecx = mu.reg_read(UC_X86_REG_ECX)</span><br><span class="line">        r_edx = mu.reg_read(UC_X86_REG_EDX)</span><br><span class="line">        syscall_name = syscall_num_to_name(r_eax)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;--------------&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;intercepted system call: &quot;</span> + syscall_name)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(syscall_name == <span class="string">&quot;sys_chmod&quot;</span>): <span class="comment"># 输出 chmod 的参数</span></span><br><span class="line">            s = mu.mem_read(r_ebx, <span class="number">20</span>).split(<span class="string">b&quot;\x00&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arg0 = 0x%x -&gt; %s&quot;</span> % (r_ebx, s))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arg1 = &quot;</span> + <span class="built_in">oct</span>(r_ecx))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;--------------&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span>(syscall_name == <span class="string">&quot;sys_exit&quot;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arg0 = &quot;</span> + <span class="built_in">hex</span>(r_ebx))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;--------------&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line">            </span><br><span class="line">        mu.reg_write(UC_X86_REG_EIP, address + size) <span class="comment"># 跳过int8指令</span></span><br><span class="line">        </span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line"></span><br><span class="line">mu.emu_start(BASE, BASE - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1675435047056.png" alt="1675435047056"></p>
<h2 id="输出程序流"><a href="#输出程序流" class="headerlink" title="输出程序流"></a>输出程序流</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">b&quot;\xe8\xff\xff\xff\xff\xc0\x5d\x6a\x05\x5b\x29\xdd\x83\xc5\x4e\x89\xe9\x6a\x02\x03\x0c\x24\x5b\x31\xd2\x66\xba\x12\x00\x8b\x39\xc1\xe7\x10\xc1\xef\x10\x81\xe9\xfe\xff\xff\xff\x8b\x45\x00\xc1\xe0\x10\xc1\xe8\x10\x89\xc3\x09\xfb\x21\xf8\xf7\xd0\x21\xd8\x66\x89\x45\x00\x83\xc5\x02\x4a\x85\xd2\x0f\x85\xcf\xff\xff\xff\xec\x37\x75\x5d\x7a\x05\x28\xed\x24\xed\x24\xed\x0b\x88\x7f\xeb\x50\x98\x38\xf9\x5c\x96\x2b\x96\x70\xfe\xc6\xff\xc6\xff\x9f\x32\x1f\x58\x1e\x00\xd3\x80&quot;</span></span><br><span class="line"></span><br><span class="line">BASE = <span class="number">0x400000</span></span><br><span class="line">STACK_ADDR = <span class="number">0x0</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_32)</span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_32)</span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE)</span><br><span class="line"></span><br><span class="line">mu.mem_write(BASE, shellcode)</span><br><span class="line">mu.reg_write(UC_X86_REG_ESP, STACK_ADDR + STACK_SIZE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">syscall_num_to_name</span>(<span class="params">num</span>):</span><br><span class="line">    syscalls = &#123;<span class="number">1</span>: <span class="string">&quot;sys_exit&quot;</span>, <span class="number">15</span>: <span class="string">&quot;sys_chmod&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> syscalls[num]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment">#print(&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27; %(address, size))</span></span><br><span class="line"></span><br><span class="line">    machine_code = mu.mem_read(address, size)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> md.disasm(machine_code,address):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;     0x%x:\t%s\t%s&quot;</span> % (code.address, code.mnemonic, code.op_str))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> (machine_code == <span class="string">b&quot;\xcd\x80&quot;</span>):</span><br><span class="line">        r_eax = mu.reg_read(UC_X86_REG_EAX)</span><br><span class="line">        r_ebx = mu.reg_read(UC_X86_REG_EBX)</span><br><span class="line">        r_ecx = mu.reg_read(UC_X86_REG_ECX)</span><br><span class="line">        r_edx = mu.reg_read(UC_X86_REG_EDX)</span><br><span class="line">        syscall_name = syscall_num_to_name(r_eax)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;--------------&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;intercepted system call: &quot;</span> + syscall_name)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(syscall_name == <span class="string">&quot;sys_chmod&quot;</span>):</span><br><span class="line">            s = mu.mem_read(r_ebx, <span class="number">20</span>).split(<span class="string">b&quot;\x00&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arg0 = 0x%x -&gt; %s&quot;</span> % (r_ebx, s))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arg1 = &quot;</span> + <span class="built_in">oct</span>(r_ecx))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;--------------&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span>(syscall_name == <span class="string">&quot;sys_exit&quot;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arg0 = &quot;</span> + <span class="built_in">hex</span>(r_ebx))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;--------------&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line">            </span><br><span class="line">        mu.reg_write(UC_X86_REG_EIP, address + size)</span><br><span class="line">        </span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line"></span><br><span class="line">mu.emu_start(BASE, BASE - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br></pre></td><td class="code"><pre><span class="line">     0x400000:	call	0x400004</span><br><span class="line">     0x400004:	inc	eax</span><br><span class="line">     0x400006:	pop	ebp</span><br><span class="line">     0x400007:	push	5</span><br><span class="line">     0x400009:	pop	ebx</span><br><span class="line">     0x40000a:	sub	ebp, ebx</span><br><span class="line">     0x40000c:	add	ebp, 0x4e</span><br><span class="line">     0x40000f:	mov	ecx, ebp</span><br><span class="line">     0x400011:	push	2</span><br><span class="line">     0x400013:	add	ecx, dword ptr [esp]</span><br><span class="line">     0x400016:	pop	ebx</span><br><span class="line">     0x400017:	xor	edx, edx</span><br><span class="line">     0x400019:	mov	dx, 0x12</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40001d:	mov	edi, dword ptr [ecx]</span><br><span class="line">     0x40001f:	shl	edi, 0x10</span><br><span class="line">     0x400022:	shr	edi, 0x10</span><br><span class="line">     0x400025:	sub	ecx, 0xfffffffe</span><br><span class="line">     0x40002b:	mov	eax, dword ptr [ebp]</span><br><span class="line">     0x40002e:	shl	eax, 0x10</span><br><span class="line">     0x400031:	shr	eax, 0x10</span><br><span class="line">     0x400034:	mov	ebx, eax</span><br><span class="line">     0x400036:	or	ebx, edi</span><br><span class="line">     0x400038:	and	eax, edi</span><br><span class="line">     0x40003a:	not	eax</span><br><span class="line">     0x40003c:	and	eax, ebx</span><br><span class="line">     0x40003e:	mov	word ptr [ebp], ax</span><br><span class="line">     0x400042:	add	ebp, 2</span><br><span class="line">     0x400045:	dec	edx</span><br><span class="line">     0x400046:	test	edx, edx</span><br><span class="line">     0x400048:	jne	0x40001d</span><br><span class="line">     0x40004e:	cdq	</span><br><span class="line">     0x40004f:	push	0xf</span><br><span class="line">     0x400051:	pop	eax</span><br><span class="line">     0x400052:	push	edx</span><br><span class="line">     0x400053:	call	0x400064</span><br><span class="line">     0x400064:	pop	ebx</span><br><span class="line">     0x400065:	push	0x1b6</span><br><span class="line">     0x40006a:	pop	ecx</span><br><span class="line">     0x40006b:	int	0x80</span><br><span class="line">--------------</span><br><span class="line">intercepted system call: sys_chmod</span><br><span class="line">arg0 = 0x400058 -&gt; bytearray(b&#x27;/etc/shadow&#x27;)</span><br><span class="line">arg1 = 0o666</span><br><span class="line">--------------</span><br><span class="line">     0x40006d:	push	1</span><br><span class="line">     0x40006f:	pop	eax</span><br><span class="line">     0x400070:	int	0x80</span><br><span class="line">--------------</span><br><span class="line">intercepted system call: sys_exit</span><br><span class="line">arg0 = 0x400058</span><br><span class="line">--------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Task3"><a href="#Task3" class="headerlink" title="Task3"></a>Task3</h1><h2 id="程序分析"><a href="#程序分析" class="headerlink" title="程序分析"></a>程序分析</h2><p>用 ida 分析，源码很简，只有一个比较函数，任务就是让这个函数返回 <code>1</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">_BOOL4 __stdcall <span class="title function_">super_function</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> a1 == <span class="number">5</span> &amp;&amp; !<span class="built_in">strcmp</span>(a2, <span class="string">&quot;batman&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  super_function(<span class="number">1</span>, <span class="string">&quot;spiderman&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现传进去的整形和字符串都不一样，显然要 patch，之前我们的模拟执行是在不干涉程序流的前提下对程序进行 hook，这个 task 显然就是要我们使用 unicorn 进行patch，在修改完对应的数据以后再运行。</p>
<p>照例看下程序流：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_32)</span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_32)</span><br><span class="line"></span><br><span class="line">BASE_ADDR = <span class="number">0x0</span></span><br><span class="line">STACK_ADDR = <span class="number">0x400000</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE_ADDR, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE)</span><br><span class="line">mu.mem_write(BASE_ADDR, read(<span class="string">&quot;./function&quot;</span>))</span><br><span class="line">mu.reg_write(UC_X86_REG_ESP, STACK_ADDR + STACK_SIZE - <span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line"></span><br><span class="line">    machine_code = mu.mem_read(address, size)</span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> md.disasm(machine_code,address):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;     0x%x:\t%s\t%s&quot;</span> % (code.address, code.mnemonic, code.op_str))</span><br><span class="line">        </span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line">mu.emu_start(<span class="number">0x57B</span>, <span class="number">0x5B1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1675440200104.png" alt="1675440200104"></p>
<p>通过动态调试可以发现，比较的数据都是存放在 <code>ebp</code> 寄存器里的，也就是在栈空间里，起初我以为这两个比较函数访问的地址是主存中的地址，然后用 hook 函数在执行到比较指令时进行 patch 寄存器，后来发现由于里面存的是栈地址根本找不到寄存器指向的数据到底在哪遂放弃。</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1675440281782.png" alt="1675440281782"></p>
<h2 id="修改栈的高地址进行-patch"><a href="#修改栈的高地址进行-patch" class="headerlink" title="修改栈的高地址进行 patch"></a>修改栈的高地址进行 patch</h2><p>根据 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e848aad8930c">stdcall的传参特性</a> ，也就是下面这幅图</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/18583386-a62483101da0e92a.jpg" alt="img"></p>
<p>也就是说我们传入的两个参数是在比栈底还要高的地址，访问 <code>arg0</code> 和 <code>arg1</code> 只要分别加上 4 和 8 即可，同时我们选定一段未被使用的地址存储字符串 <code>batman</code> 进行间接寻址，进而实现 <code>super_fuction</code> 这个函数返回 <code>1</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_32)</span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_32)</span><br><span class="line"></span><br><span class="line">BASE_ADDR = <span class="number">0x0</span></span><br><span class="line">STACK_ADDR = <span class="number">0x400000</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE_ADDR, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE)</span><br><span class="line">mu.mem_write(BASE_ADDR, read(<span class="string">&quot;./function&quot;</span>))</span><br><span class="line"></span><br><span class="line">r_esp = STACK_ADDR + (STACK_SIZE - <span class="number">12</span>) <span class="comment"># 留空间放参数</span></span><br><span class="line">mu.reg_write(UC_X86_REG_ESP, r_esp)</span><br><span class="line"></span><br><span class="line">STRING_ADDR = BASE_ADDR + <span class="number">1024</span></span><br><span class="line">mu.mem_write(STRING_ADDR, <span class="string">b&quot;batman\x00&quot;</span>) <span class="comment"># 在没用的空间写上目标字符串</span></span><br><span class="line">mu.mem_write(r_esp + <span class="number">4</span>, p32(<span class="number">5</span>)) <span class="comment"># 第一个参数是 5</span></span><br><span class="line">mu.mem_write(r_esp + <span class="number">8</span>, p32(STRING_ADDR)) <span class="comment"># 第二个参数是STRING_ADDR对应的数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    machine_code = mu.mem_read(address, size)</span><br><span class="line">    <span class="keyword">for</span> code <span class="keyword">in</span> md.disasm(machine_code, address):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;     0x%x:\t%s\t%s&quot;</span> % (code.address, code.mnemonic, code.op_str))</span><br><span class="line"></span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line">mu.emu_start(<span class="number">0x57B</span>, <span class="number">0x5B1</span>)</span><br><span class="line">return_value = mu.reg_read(UC_X86_REG_EAX)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The returned value is: %d&quot;</span> % return_value)</span><br></pre></td></tr></table></figure>
<p>最后的输出流如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">     0x57b:    push    ebp</span><br><span class="line">     0x57c:    mov    ebp, esp</span><br><span class="line">     0x57e:    call    0x5d6</span><br><span class="line">     0x5d6:    mov    eax, dword ptr [esp]</span><br><span class="line">     0x5d9:    ret    </span><br><span class="line">     0x583:    add    eax, 0x1a7d</span><br><span class="line">     0x588:    cmp    dword ptr [ebp + 8], 5</span><br><span class="line">     0x58c:    jne    0x5ab</span><br><span class="line">     0x58e:    lea    eax, [eax - 0x19a0]</span><br><span class="line">     0x594:    push    eax</span><br><span class="line">     0x595:    push    dword ptr [ebp + 0xc]</span><br><span class="line">     0x598:    call    0x50d</span><br><span class="line">     0x50d:    push    ebp</span><br><span class="line">     0x50e:    mov    ebp, esp</span><br><span class="line">     0x510:    sub    esp, 0x10</span><br><span class="line">     0x513:    call    0x5d6</span><br><span class="line">     0x5d6:    mov    eax, dword ptr [esp]</span><br><span class="line">     0x5d9:    ret    </span><br><span class="line">     0x518:    add    eax, 0x1ae8</span><br><span class="line">     0x51d:    mov    dword ptr [ebp - 4], 0</span><br><span class="line">     0x524:    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">     0x527:    mov    dword ptr [ebp - 8], eax</span><br><span class="line">     0x52a:    jmp    0x534</span><br><span class="line">     0x534:    mov    eax, dword ptr [ebp - 8]</span><br><span class="line">     0x537:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x53a:    test    al, al</span><br><span class="line">     0x53c:    jne    0x52c</span><br><span class="line">     0x52c:    add    dword ptr [ebp - 8], 1</span><br><span class="line">     0x530:    add    dword ptr [ebp - 4], 1</span><br><span class="line">     0x534:    mov    eax, dword ptr [ebp - 8]</span><br><span class="line">     0x537:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x53a:    test    al, al</span><br><span class="line">     0x53c:    jne    0x52c</span><br><span class="line">     0x52c:    add    dword ptr [ebp - 8], 1</span><br><span class="line">     0x530:    add    dword ptr [ebp - 4], 1</span><br><span class="line">     0x534:    mov    eax, dword ptr [ebp - 8]</span><br><span class="line">     0x537:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x53a:    test    al, al</span><br><span class="line">     0x53c:    jne    0x52c</span><br><span class="line">     0x52c:    add    dword ptr [ebp - 8], 1</span><br><span class="line">     0x530:    add    dword ptr [ebp - 4], 1</span><br><span class="line">     0x534:    mov    eax, dword ptr [ebp - 8]</span><br><span class="line">     0x537:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x53a:    test    al, al</span><br><span class="line">     0x53c:    jne    0x52c</span><br><span class="line">     0x52c:    add    dword ptr [ebp - 8], 1</span><br><span class="line">     0x530:    add    dword ptr [ebp - 4], 1</span><br><span class="line">     0x534:    mov    eax, dword ptr [ebp - 8]</span><br><span class="line">     0x537:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x53a:    test    al, al</span><br><span class="line">     0x53c:    jne    0x52c</span><br><span class="line">     0x52c:    add    dword ptr [ebp - 8], 1</span><br><span class="line">     0x530:    add    dword ptr [ebp - 4], 1</span><br><span class="line">     0x534:    mov    eax, dword ptr [ebp - 8]</span><br><span class="line">     0x537:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x53a:    test    al, al</span><br><span class="line">     0x53c:    jne    0x52c</span><br><span class="line">     0x52c:    add    dword ptr [ebp - 8], 1</span><br><span class="line">     0x530:    add    dword ptr [ebp - 4], 1</span><br><span class="line">     0x534:    mov    eax, dword ptr [ebp - 8]</span><br><span class="line">     0x537:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x53a:    test    al, al</span><br><span class="line">     0x53c:    jne    0x52c</span><br><span class="line">     0x53e:    mov    dword ptr [ebp - 0xc], 0</span><br><span class="line">     0x545:    jmp    0x56c</span><br><span class="line">     0x56c:    mov    eax, dword ptr [ebp - 0xc]</span><br><span class="line">     0x56f:    cmp    eax, dword ptr [ebp - 4]</span><br><span class="line">     0x572:    jle    0x547</span><br><span class="line">     0x547:    mov    edx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x54a:    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">     0x54d:    add    eax, edx</span><br><span class="line">     0x54f:    movzx    edx, byte ptr [eax]</span><br><span class="line">     0x552:    mov    ecx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x555:    mov    eax, dword ptr [ebp + 0xc]</span><br><span class="line">     0x558:    add    eax, ecx</span><br><span class="line">     0x55a:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x55d:    cmp    dl, al</span><br><span class="line">     0x55f:    je    0x568</span><br><span class="line">     0x568:    add    dword ptr [ebp - 0xc], 1</span><br><span class="line">     0x56c:    mov    eax, dword ptr [ebp - 0xc]</span><br><span class="line">     0x56f:    cmp    eax, dword ptr [ebp - 4]</span><br><span class="line">     0x572:    jle    0x547</span><br><span class="line">     0x547:    mov    edx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x54a:    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">     0x54d:    add    eax, edx</span><br><span class="line">     0x54f:    movzx    edx, byte ptr [eax]</span><br><span class="line">     0x552:    mov    ecx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x555:    mov    eax, dword ptr [ebp + 0xc]</span><br><span class="line">     0x558:    add    eax, ecx</span><br><span class="line">     0x55a:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x55d:    cmp    dl, al</span><br><span class="line">     0x55f:    je    0x568</span><br><span class="line">     0x568:    add    dword ptr [ebp - 0xc], 1</span><br><span class="line">     0x56c:    mov    eax, dword ptr [ebp - 0xc]</span><br><span class="line">     0x56f:    cmp    eax, dword ptr [ebp - 4]</span><br><span class="line">     0x572:    jle    0x547</span><br><span class="line">     0x547:    mov    edx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x54a:    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">     0x54d:    add    eax, edx</span><br><span class="line">     0x54f:    movzx    edx, byte ptr [eax]</span><br><span class="line">     0x552:    mov    ecx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x555:    mov    eax, dword ptr [ebp + 0xc]</span><br><span class="line">     0x558:    add    eax, ecx</span><br><span class="line">     0x55a:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x55d:    cmp    dl, al</span><br><span class="line">     0x55f:    je    0x568</span><br><span class="line">     0x568:    add    dword ptr [ebp - 0xc], 1</span><br><span class="line">     0x56c:    mov    eax, dword ptr [ebp - 0xc]</span><br><span class="line">     0x56f:    cmp    eax, dword ptr [ebp - 4]</span><br><span class="line">     0x572:    jle    0x547</span><br><span class="line">     0x547:    mov    edx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x54a:    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">     0x54d:    add    eax, edx</span><br><span class="line">     0x54f:    movzx    edx, byte ptr [eax]</span><br><span class="line">     0x552:    mov    ecx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x555:    mov    eax, dword ptr [ebp + 0xc]</span><br><span class="line">     0x558:    add    eax, ecx</span><br><span class="line">     0x55a:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x55d:    cmp    dl, al</span><br><span class="line">     0x55f:    je    0x568</span><br><span class="line">     0x568:    add    dword ptr [ebp - 0xc], 1</span><br><span class="line">     0x56c:    mov    eax, dword ptr [ebp - 0xc]</span><br><span class="line">     0x56f:    cmp    eax, dword ptr [ebp - 4]</span><br><span class="line">     0x572:    jle    0x547</span><br><span class="line">     0x547:    mov    edx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x54a:    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">     0x54d:    add    eax, edx</span><br><span class="line">     0x54f:    movzx    edx, byte ptr [eax]</span><br><span class="line">     0x552:    mov    ecx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x555:    mov    eax, dword ptr [ebp + 0xc]</span><br><span class="line">     0x558:    add    eax, ecx</span><br><span class="line">     0x55a:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x55d:    cmp    dl, al</span><br><span class="line">     0x55f:    je    0x568</span><br><span class="line">     0x568:    add    dword ptr [ebp - 0xc], 1</span><br><span class="line">     0x56c:    mov    eax, dword ptr [ebp - 0xc]</span><br><span class="line">     0x56f:    cmp    eax, dword ptr [ebp - 4]</span><br><span class="line">     0x572:    jle    0x547</span><br><span class="line">     0x547:    mov    edx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x54a:    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">     0x54d:    add    eax, edx</span><br><span class="line">     0x54f:    movzx    edx, byte ptr [eax]</span><br><span class="line">     0x552:    mov    ecx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x555:    mov    eax, dword ptr [ebp + 0xc]</span><br><span class="line">     0x558:    add    eax, ecx</span><br><span class="line">     0x55a:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x55d:    cmp    dl, al</span><br><span class="line">     0x55f:    je    0x568</span><br><span class="line">     0x568:    add    dword ptr [ebp - 0xc], 1</span><br><span class="line">     0x56c:    mov    eax, dword ptr [ebp - 0xc]</span><br><span class="line">     0x56f:    cmp    eax, dword ptr [ebp - 4]</span><br><span class="line">     0x572:    jle    0x547</span><br><span class="line">     0x547:    mov    edx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x54a:    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">     0x54d:    add    eax, edx</span><br><span class="line">     0x54f:    movzx    edx, byte ptr [eax]</span><br><span class="line">     0x552:    mov    ecx, dword ptr [ebp - 0xc]</span><br><span class="line">     0x555:    mov    eax, dword ptr [ebp + 0xc]</span><br><span class="line">     0x558:    add    eax, ecx</span><br><span class="line">     0x55a:    movzx    eax, byte ptr [eax]</span><br><span class="line">     0x55d:    cmp    dl, al</span><br><span class="line">     0x55f:    je    0x568</span><br><span class="line">     0x568:    add    dword ptr [ebp - 0xc], 1</span><br><span class="line">     0x56c:    mov    eax, dword ptr [ebp - 0xc]</span><br><span class="line">     0x56f:    cmp    eax, dword ptr [ebp - 4]</span><br><span class="line">     0x572:    jle    0x547</span><br><span class="line">     0x574:    mov    eax, 0</span><br><span class="line">     0x579:    leave    </span><br><span class="line">     0x57a:    ret    </span><br><span class="line">     0x59d:    add    esp, 8</span><br><span class="line">     0x5a0:    test    eax, eax</span><br><span class="line">     0x5a2:    jne    0x5ab</span><br><span class="line">     0x5a4:    mov    eax, 1</span><br><span class="line">     0x5a9:    jmp    0x5b0</span><br><span class="line">     0x5b0:    leave    </span><br><span class="line">The returned value is: 1</span><br></pre></td></tr></table></figure>
<p>有傻逼先是把 <code>ESP</code> 写成了 <code>RSP</code>，又把 <code>CS_ARCH_X86</code> 写成了 <code>UC_ARCH_X86</code>，还把 <code>UC_MODE_X32</code> 写成了 <code>UC_MODE_X64</code> 导致模拟执行了半小时输不出来正确的返回值，那么他是谁呢👉🤣</p>
<h1 id="Task4"><a href="#Task4" class="headerlink" title="Task4"></a>Task4</h1><h2 id="程序分析-1"><a href="#程序分析-1" class="headerlink" title="程序分析"></a>程序分析</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">ccc</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// r5</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r1</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r2</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// r1</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// r2</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0u</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = ccc(a1 &gt;&gt; <span class="number">1</span>, a2, a3);</span><br><span class="line">  v7 = ccc(a1 - <span class="number">1</span>, v5, v6) * v4;</span><br><span class="line">  <span class="keyword">return</span> v7 + ccc(a1 - <span class="number">3</span>, v8, v9);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  v3 = ccc(<span class="number">10000u</span>, (<span class="type">int</span>)argv, (<span class="type">int</span>)envp);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, v3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和 task1 差不多，也是一个递归调用，输入 <code>10000</code>，需要得到一个返回值。不同的是该程序是个ARM架构的ELF文件</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1675492714947.png" alt="1675492714947"></p>
<p>同样，我们先跟踪程序流，程序跑的很欢，没有什么需要 skip 的指令，但是需要很长时间才能返回我们想知道的答案，我们同样使用unicorn来解决这个问题。</p>
<h2 id="unicorn-模拟执行用-stack-优化"><a href="#unicorn-模拟执行用-stack-优化" class="headerlink" title="unicorn 模拟执行用 stack 优化"></a>unicorn 模拟执行用 stack 优化</h2><p>如图，<code>ccc</code>的第一个参数由 R0 传入，且返回值存在 R0 中。</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1675492608887.png" alt="1675492608887"></p>
<p>那么我们就可以按照 task1 的套路，对 <code>ccc</code> 的入口和出口进行特判进行 hook 操作，最后由于输出结果在 <code>print</code> 的时候是存在 R1 寄存器中，我们把这个数据 dump 下来即可</p>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1675493357373.png" alt="1675493357373"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.arm_const <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">mu = Uc(UC_ARCH_ARM, UC_MODE_LITTLE_ENDIAN)</span><br><span class="line"></span><br><span class="line">BASE_ADDR = <span class="number">0x10000</span></span><br><span class="line">STACK_ADDR = <span class="number">0x400000</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE_ADDR, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR,  STACK_SIZE)</span><br><span class="line">mu.mem_write(BASE_ADDR, read(<span class="string">&quot;./task4&quot;</span>))</span><br><span class="line">mu.reg_write(UC_ARM_REG_SP, STACK_ADDR + (STACK_SIZE // <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">CCC_ENTRY = <span class="number">0x104D0</span></span><br><span class="line">CCC_RET = <span class="number">0x10580</span></span><br><span class="line">stack = []</span><br><span class="line">dp = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(address == CCC_ENTRY):</span><br><span class="line">        arg0 = mu.reg_read(UC_ARM_REG_R0)</span><br><span class="line">        <span class="keyword">if</span> arg0 <span class="keyword">in</span> dp:</span><br><span class="line">            ret_r0 = dp[arg0]</span><br><span class="line">            mu.reg_write(UC_ARM_REG_R0, ret_r0)</span><br><span class="line">            mu.reg_write(UC_ARM_REG_PC, <span class="number">0x105BC</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stack.append(arg0)</span><br><span class="line">    <span class="keyword">elif</span>(address == CCC_RET):</span><br><span class="line">        arg0 = stack.pop()</span><br><span class="line">        ret_r0 = mu.reg_read(UC_ARM_REG_R0)</span><br><span class="line">        dp[arg0] = ret_r0</span><br><span class="line"></span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line">mu.emu_start(<span class="number">0x10584</span>, <span class="number">0x105A8</span>)</span><br><span class="line"></span><br><span class="line">return_value = mu.reg_read(UC_ARM_REG_R1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The return value = %d&quot;</span> % return_value)</span><br></pre></td></tr></table></figure>
<p><img src="/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/1675493913532.png" alt="1675493913532"></p>
<p>最后的答案是 <code>2635833876</code></p>
<h2 id="信息安全铁人三项2024-ez-driver"><a href="#信息安全铁人三项2024-ez-driver" class="headerlink" title="信息安全铁人三项2024 - ez_driver"></a>信息安全铁人三项2024 - ez_driver</h2><p>是一个windows下的sys驱动文件，很难配置调试环境，主要加密逻辑如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140001510</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+20h] [rbp-B8h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+28h] [rbp-B0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+2Ch] [rbp-ACh]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+30h] [rbp-A8h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+34h] [rbp-A4h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+38h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+3Ch] [rbp-9Ch]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+40h] [rbp-98h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// [rsp+44h] [rbp-94h]</span></span><br><span class="line">  PCSTR Format; <span class="comment">// [rsp+48h] [rbp-90h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+50h] [rbp-88h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+54h] [rbp-84h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+58h] [rbp-80h]</span></span><br><span class="line">  _DWORD *v16; <span class="comment">// [rsp+60h] [rbp-78h]</span></span><br><span class="line">  <span class="type">char</span> *v17; <span class="comment">// [rsp+68h] [rbp-70h]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [rsp+70h] [rbp-68h]</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [rsp+74h] [rbp-64h]</span></span><br><span class="line">  PCSTR v20; <span class="comment">// [rsp+78h] [rbp-60h]</span></span><br><span class="line">  <span class="type">int</span> v21[<span class="number">4</span>]; <span class="comment">// [rsp+80h] [rbp-58h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v22[<span class="number">40</span>]; <span class="comment">// [rsp+90h] [rbp-48h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v16 = (_DWORD *)<span class="built_in">sub_140001C90</span>(a2);</span><br><span class="line">  v13 = v16[<span class="number">6</span>];</span><br><span class="line">  Format = *(PCSTR *)(a2 + <span class="number">24</span>);</span><br><span class="line">  v11 = v16[<span class="number">4</span>];</span><br><span class="line">  v18 = v16[<span class="number">2</span>];</span><br><span class="line">  v10 = v13;</span><br><span class="line">  <span class="keyword">if</span> ( v13 == <span class="number">2236416</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">DbgPrint</span>(&amp;byte_140002380);</span><br><span class="line">    <span class="built_in">memset</span>(v22, <span class="number">0</span>, <span class="built_in">sizeof</span>(v22));</span><br><span class="line">    v20 = Format;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v11; ++i )</span><br><span class="line">      v22[i] = v20[i];</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">32</span>; j += <span class="number">8</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">      v4 = (<span class="type">unsigned</span> __int8)v22[j] &lt;&lt; <span class="number">24</span>;</span><br><span class="line">      v4 += (<span class="type">unsigned</span> __int8)v22[j + <span class="number">1</span>] &lt;&lt; <span class="number">16</span>;</span><br><span class="line">      v4 += (<span class="type">unsigned</span> __int8)v22[j + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>;</span><br><span class="line">      v4 += (<span class="type">unsigned</span> __int8)v22[j + <span class="number">3</span>];</span><br><span class="line">      v5 = (<span class="type">unsigned</span> __int8)v22[j + <span class="number">4</span>] &lt;&lt; <span class="number">24</span>;</span><br><span class="line">      v5 += (<span class="type">unsigned</span> __int8)v22[j + <span class="number">5</span>] &lt;&lt; <span class="number">16</span>;</span><br><span class="line">      v5 += (<span class="type">unsigned</span> __int8)v22[j + <span class="number">6</span>] &lt;&lt; <span class="number">8</span>;</span><br><span class="line">      v5 += (<span class="type">unsigned</span> __int8)v22[j + <span class="number">7</span>];</span><br><span class="line">      v21[<span class="number">0</span>] = <span class="number">6699</span>;</span><br><span class="line">      v21[<span class="number">1</span>] = <span class="number">14925</span>;</span><br><span class="line">      v21[<span class="number">2</span>] = <span class="number">24175</span>;</span><br><span class="line">      v21[<span class="number">3</span>] = <span class="number">43571</span>;</span><br><span class="line">      v19 = <span class="number">2</span>;</span><br><span class="line">      v14 = <span class="number">33</span>;</span><br><span class="line">      <span class="built_in">sub_1400020E0</span>(<span class="number">0x21</span>u, (<span class="type">unsigned</span> <span class="type">int</span> *)&amp;v4, (__int64)v21);</span><br><span class="line">      v22[j] = <span class="built_in">HIBYTE</span>(v4);</span><br><span class="line">      v22[j + <span class="number">1</span>] = <span class="built_in">BYTE2</span>(v4);</span><br><span class="line">      v22[j + <span class="number">2</span>] = <span class="built_in">BYTE1</span>(v4);</span><br><span class="line">      v22[j + <span class="number">3</span>] = v4;</span><br><span class="line">      v22[j + <span class="number">4</span>] = <span class="built_in">HIBYTE</span>(v5);</span><br><span class="line">      v22[j + <span class="number">5</span>] = <span class="built_in">BYTE2</span>(v5);</span><br><span class="line">      v22[j + <span class="number">6</span>] = <span class="built_in">BYTE1</span>(v5);</span><br><span class="line">      v22[j + <span class="number">7</span>] = v5;</span><br><span class="line">    &#125;</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    v17 = v22;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v15 = v8;</span><br><span class="line">      <span class="built_in">sub_140001E70</span>(v17, v8++);</span><br><span class="line">      v17 += <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 &lt; <span class="number">2</span> );</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">32</span>; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v22[k] == byte_140004400[k] )</span><br><span class="line">        ++v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">DbgPrint</span>(&amp;byte_140002390);</span><br><span class="line">    <span class="keyword">if</span> ( v9 == <span class="number">32</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">strcpy</span>((<span class="type">char</span> *)Format, <span class="string">&quot;flag is you input&quot;</span>);</span><br><span class="line">      *(_QWORD *)(a2 + <span class="number">56</span>) = <span class="number">18</span>i64;</span><br><span class="line">      <span class="built_in">DbgPrint</span>(&amp;byte_1400023C0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">strcpy</span>((<span class="type">char</span> *)Format, <span class="string">&quot;wrong&quot;</span>);</span><br><span class="line">      *(_QWORD *)(a2 + <span class="number">56</span>) = <span class="number">6</span>i64;</span><br><span class="line">      <span class="built_in">DbgPrint</span>(&amp;byte_1400023E0);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v10 != <span class="number">2237440</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">DbgPrint</span>(aIrpdevicecontr, v11);</span><br><span class="line">  <span class="built_in">DbgPrint</span>(<span class="string">&quot;CODE_WRITE %X\n&quot;</span>, <span class="number">2237440</span>i64);</span><br><span class="line">  <span class="built_in">DbgPrint</span>(Format);</span><br><span class="line">  *(_QWORD *)(a2 + <span class="number">56</span>) = <span class="number">0</span>i64;</span><br><span class="line">LABEL_21:</span><br><span class="line">  *(_QWORD *)(a2 + <span class="number">56</span>) = <span class="number">65</span>i64;</span><br><span class="line">  <span class="built_in">IofCompleteRequest</span>((PIRP)a2, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们使用unicorn对其进行模拟执行</p>
<p>用010editor可以知道该PE文件的文件头长度为 0x400，因此我们需要将模拟执行的基址增加 0x400，可以在idapro里用编辑—&gt;段来重新定位基址，把基址增加0x400即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line">BASE_OFFSET = <span class="number">0x400</span></span><br><span class="line">mu = Uc(UC_ARCH_X86, UC_MODE_64)</span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_64)</span><br><span class="line"></span><br><span class="line">BASE_ADDR = <span class="number">0x140001000</span></span><br><span class="line">STACK_ADDR = <span class="number">0x1000</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line">mu.mem_map(BASE_ADDR, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE)</span><br><span class="line">mu.mem_write(BASE_ADDR, read(<span class="string">&quot;./ez_driver.sys&quot;</span>))</span><br><span class="line">mu.reg_write(UC_X86_REG_RBP, STACK_ADDR + STACK_SIZE // <span class="number">2</span>) <span class="comment"># 分配栈底</span></span><br><span class="line">mu.reg_write(UC_X86_REG_RSP, STACK_ADDR + STACK_SIZE // <span class="number">4</span>) <span class="comment"># 分配栈顶，栈地址是倒序的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用mem_write, mem_read, reg_write, reg_read函数，配合汇编进行hook。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="comment"># code = mu.mem_read(address, size)</span></span><br><span class="line">    <span class="comment"># for instruction in md.disasm(code, address):</span></span><br><span class="line">    <span class="comment">#     print(&quot;0x%x: %s %s&quot; % (instruction.address, instruction.mnemonic, instruction.op_str))</span></span><br><span class="line">    <span class="keyword">if</span> address == <span class="number">0x14000161D</span>:</span><br><span class="line">        mu.mem_write(mu.reg_read(UC_X86_REG_RSP) + <span class="number">144</span>, <span class="string">b&#x27;12345678123456781234567812345678&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(mu.mem_read(mu.reg_read(mu.reg_read(UC_X86_REG_RSP) + 72), 32))</span></span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x14000180F</span>:</span><br><span class="line">        tea_input = mu.mem_read(mu.reg_read(UC_X86_REG_RSP) + <span class="number">40</span>, <span class="number">8</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;tea_input: <span class="subst">&#123;<span class="built_in">bytes</span>(tea_input)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x14000182D</span>:</span><br><span class="line">        tea_output = mu.mem_read(mu.reg_read(UC_X86_REG_RSP) + <span class="number">40</span>, <span class="number">8</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;tea_output: <span class="subst">&#123;[<span class="built_in">hex</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> tea_output]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x140001930</span>:</span><br><span class="line">        cipher_1 = mu.mem_read(mu.reg_read(UC_X86_REG_RSP) + <span class="number">144</span>, <span class="number">32</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;cipher_1: <span class="subst">&#123;[<span class="built_in">hex</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> cipher_1]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> address == <span class="number">0x14000197A</span>:</span><br><span class="line">        cipher_2 = mu.mem_read(mu.reg_read(UC_X86_REG_RSP) + <span class="number">104</span>, <span class="number">32</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;cipher_2: <span class="subst">&#123;[<span class="built_in">hex</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> cipher_2]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line">mu.emu_start(<span class="number">0x1400015D9</span>, <span class="number">0x1400019C9</span>)</span><br></pre></td></tr></table></figure>
<h1 id="备录"><a href="#备录" class="headerlink" title="备录"></a>备录</h1><p>全是网上抄的，个人存档用</p>
<p><code>from unicorn import *</code> - 加载Unicorn库。包含一些函数和基本的常量。</p>
<p><code>from unicorn.x86_const import*</code> - 加载 X86 和X64架构相关的常量</p>
<h2 id="所有unicorn模块中的常量"><a href="#所有unicorn模块中的常量" class="headerlink" title="所有unicorn模块中的常量"></a>所有unicorn模块中的常量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">UC_API_MAJOR                UC_ERR_VERSION              UC_MEM_READ                 UC_PROT_ALL</span><br><span class="line">UC_API_MINOR                UC_ERR_WRITE_PROT           UC_MEM_READ_AFTER           UC_PROT_EXEC</span><br><span class="line">UC_ARCH_ARM                 UC_ERR_WRITE_UNALIGNED      UC_MEM_READ_PROT            UC_PROT_NONE</span><br><span class="line">UC_ARCH_ARM64               UC_ERR_WRITE_UNMAPPED       UC_MEM_READ_UNMAPPED        UC_PROT_READ</span><br><span class="line">UC_ARCH_M68K                UC_HOOK_BLOCK               UC_MEM_WRITE                UC_PROT_WRITE</span><br><span class="line">UC_ARCH_MAX                 UC_HOOK_CODE                UC_MEM_WRITE_PROT           UC_QUERY_MODE</span><br><span class="line">UC_ARCH_MIPS                UC_HOOK_INSN                UC_MEM_WRITE_UNMAPPED       UC_QUERY_PAGE_SIZE</span><br><span class="line">UC_ARCH_PPC                 UC_HOOK_INTR                UC_MILISECOND_SCALE         UC_SECOND_SCALE</span><br><span class="line">UC_ARCH_SPARC               UC_HOOK_MEM_FETCH           UC_MODE_16                  UC_VERSION_EXTRA</span><br><span class="line">UC_ARCH_X86                 UC_HOOK_MEM_FETCH_INVALID   UC_MODE_32                  UC_VERSION_MAJOR</span><br><span class="line">UC_ERR_ARCH                 UC_HOOK_MEM_FETCH_PROT      UC_MODE_64                  UC_VERSION_MINOR</span><br><span class="line">UC_ERR_ARG                  UC_HOOK_MEM_FETCH_UNMAPPED  UC_MODE_ARM                 Uc</span><br><span class="line">UC_ERR_EXCEPTION            UC_HOOK_MEM_INVALID         UC_MODE_BIG_ENDIAN          UcError</span><br><span class="line">UC_ERR_FETCH_PROT           UC_HOOK_MEM_PROT            UC_MODE_LITTLE_ENDIAN       arm64_const</span><br><span class="line">UC_ERR_FETCH_UNALIGNED      UC_HOOK_MEM_READ            UC_MODE_MCLASS              arm_const</span><br><span class="line">UC_ERR_FETCH_UNMAPPED       UC_HOOK_MEM_READ_AFTER      UC_MODE_MICRO               debug</span><br><span class="line">UC_ERR_HANDLE               UC_HOOK_MEM_READ_INVALID    UC_MODE_MIPS3               m68k_const</span><br><span class="line">UC_ERR_HOOK                 UC_HOOK_MEM_READ_PROT       UC_MODE_MIPS32              mips_const</span><br><span class="line">UC_ERR_HOOK_EXIST           UC_HOOK_MEM_READ_UNMAPPED   UC_MODE_MIPS32R6            sparc_const</span><br><span class="line">UC_ERR_INSN_INVALID         UC_HOOK_MEM_UNMAPPED        UC_MODE_MIPS64              uc_arch_supported</span><br><span class="line">UC_ERR_MAP                  UC_HOOK_MEM_VALID           UC_MODE_PPC32               uc_version</span><br><span class="line">UC_ERR_MODE                 UC_HOOK_MEM_WRITE           UC_MODE_PPC64               unicorn</span><br><span class="line">UC_ERR_NOMEM                UC_HOOK_MEM_WRITE_INVALID   UC_MODE_QPX                 unicorn_const</span><br><span class="line">UC_ERR_OK                   UC_HOOK_MEM_WRITE_PROT      UC_MODE_SPARC32             version_bind</span><br><span class="line">UC_ERR_READ_PROT            UC_HOOK_MEM_WRITE_UNMAPPED  UC_MODE_SPARC64             x86_const</span><br><span class="line">UC_ERR_READ_UNALIGNED       UC_MEM_FETCH                UC_MODE_THUMB              </span><br><span class="line">UC_ERR_READ_UNMAPPED        UC_MEM_FETCH_PROT           UC_MODE_V8                 </span><br><span class="line">UC_ERR_RESOURCE             UC_MEM_FETCH_UNMAPPED       UC_MODE_V9</span><br></pre></td></tr></table></figure>
<p>一些<code>unicorn.x86_const</code>中的常量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UC_X86_REG_EAX</span><br><span class="line">UC_X86_REG_RIP</span><br><span class="line">UC_X86_REG_RAX</span><br></pre></td></tr></table></figure>
<p><code>mu = Uc(arch,mode)</code> - 获取<code>Uc</code>实例。在这里指定目标架构，例如：</p>
<ul>
<li><code>mu = Uc(UC_ARCH_X86,UC_MODE_64)</code> - 获取<code>X86-64</code>架构的实例。</li>
<li><code>mu = Uc(UC_ARCH_X86,UC_MODE_32)</code> - 获取<code>X86-32</code>架构的实例。</li>
</ul>
<p><code>mu.mem_map(ADDRESS,4096)</code> - 映射一片内存区域</p>
<p><code>mu.mem_write(ADDRESS,DATA)</code> - 向内存中写入数据</p>
<p><code>tmp = mu.mem_read(ADDRESS,SIZE)</code> - 从内存中读取数据</p>
<p><code>mu.reg_write(UC_X86_REG_ECX,0X0)</code> - 设置ECX值。</p>
<p><code>r_esp = mu.reg_read(UC_X86_REG_ESP)</code> - 读取ESP的值。</p>
<p><code>mu.emu_start(ADDRESS_START,ADDRESS_END)</code> - 开始执行模拟。</p>
<p>命令追踪:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>): </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&gt;&gt;&gt; Tracing instruction at 0x%x, instruction size = 0x%x&#x27;</span> %(address, size)) </span><br><span class="line"> </span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br></pre></td></tr></table></figure>
<p>这段代码添加了一个HOOK（向Unicorn引擎中），我们定义的函数会在执行每一条命令之前被执行。参数含义如下：</p>
<ul>
<li><code>Uc</code>实例</li>
<li>指令的地址</li>
<li>指令的长度</li>
<li>用户定义数据（通过<code>hook_add()</code>函数传递）</li>
</ul>
<h2 id="hook的类型"><a href="#hook的类型" class="headerlink" title="hook的类型"></a>hook的类型</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// All type of hooks for uc_hook_add() API.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">uc_hook_type</span> &#123;</span><br><span class="line">    <span class="comment">// Hook all interrupt/syscall events</span></span><br><span class="line">    UC_HOOK_INTR = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// Hook a particular instruction - only a very small subset of instructions supported here</span></span><br><span class="line">    UC_HOOK_INSN = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line">    <span class="comment">// Hook a range of code</span></span><br><span class="line">    UC_HOOK_CODE = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line">    <span class="comment">// Hook basic blocks</span></span><br><span class="line">    UC_HOOK_BLOCK = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line">    <span class="comment">// Hook for memory read on unmapped memory</span></span><br><span class="line">    UC_HOOK_MEM_READ_UNMAPPED = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</span><br><span class="line">    <span class="comment">// Hook for invalid memory write events</span></span><br><span class="line">    UC_HOOK_MEM_WRITE_UNMAPPED = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,</span><br><span class="line">    <span class="comment">// Hook for invalid memory fetch for execution events</span></span><br><span class="line">    UC_HOOK_MEM_FETCH_UNMAPPED = <span class="number">1</span> &lt;&lt; <span class="number">6</span>,</span><br><span class="line">    <span class="comment">// Hook for memory read on read-protected memory</span></span><br><span class="line">    UC_HOOK_MEM_READ_PROT = <span class="number">1</span> &lt;&lt; <span class="number">7</span>,</span><br><span class="line">    <span class="comment">// Hook for memory write on write-protected memory</span></span><br><span class="line">    UC_HOOK_MEM_WRITE_PROT = <span class="number">1</span> &lt;&lt; <span class="number">8</span>,</span><br><span class="line">    <span class="comment">// Hook for memory fetch on non-executable memory</span></span><br><span class="line">    UC_HOOK_MEM_FETCH_PROT = <span class="number">1</span> &lt;&lt; <span class="number">9</span>,</span><br><span class="line">    <span class="comment">// Hook memory read events.</span></span><br><span class="line">    UC_HOOK_MEM_READ = <span class="number">1</span> &lt;&lt; <span class="number">10</span>,</span><br><span class="line">    <span class="comment">// Hook memory write events.</span></span><br><span class="line">    UC_HOOK_MEM_WRITE = <span class="number">1</span> &lt;&lt; <span class="number">11</span>,</span><br><span class="line">    <span class="comment">// Hook memory fetch for execution events</span></span><br><span class="line">    UC_HOOK_MEM_FETCH = <span class="number">1</span> &lt;&lt; <span class="number">12</span>,</span><br><span class="line">    <span class="comment">// Hook memory read events, but only successful access.</span></span><br><span class="line">    <span class="comment">// The callback will be triggered after successful read.</span></span><br><span class="line">    UC_HOOK_MEM_READ_AFTER = <span class="number">1</span> &lt;&lt; <span class="number">13</span>,</span><br><span class="line">&#125; uc_hook_type;</span><br></pre></td></tr></table></figure>
<h2 id="关键函数的声明等"><a href="#关键函数的声明等" class="headerlink" title="关键函数的声明等"></a>关键函数的声明等</h2><h3 id="uc-open"><a href="#uc-open" class="headerlink" title="uc_open"></a>uc_open</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Create new instance of unicorn engine.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @arch: architecture type (UC_ARCH_*)</span></span><br><span class="line"><span class="comment"> @mode: hardware mode. This is combined of UC_MODE_*</span></span><br><span class="line"><span class="comment"> @uc: pointer to uc_engine, which will be updated at return time</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @return UC_ERR_OK on success, or other value on failure (refer to uc_err enum</span></span><br><span class="line"><span class="comment">   for detailed error).</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">UNICORN_EXPORT</span><br><span class="line">uc_err <span class="title function_">uc_open</span><span class="params">(uc_arch arch, uc_mode mode, uc_engine **uc)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>@arch：架构类型（UC_ARCH_*）<br>@mode：硬件模式。 这是结合 UC_MODE_*<br>@uc：指向uc_engine的指针，返回时会更新<br>@return UC_ERR_OK 成功，或其他值失败（参考 uc_err 枚举详细错误）。</p>
</blockquote>
<p>uc_arch和uc_mode的枚举值：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> <span class="title">uc_arch</span> &#123;</span></span><br><span class="line">    UC_ARCH_ARM = <span class="number">1</span>,    <span class="comment">// ARM architecture (including Thumb, Thumb-2)</span></span><br><span class="line">    UC_ARCH_ARM64,      <span class="comment">// ARM-64, also called AArch64</span></span><br><span class="line">    UC_ARCH_MIPS,       <span class="comment">// Mips architecture</span></span><br><span class="line">    UC_ARCH_X86,        <span class="comment">// X86 architecture (including x86 &amp; x86-64)</span></span><br><span class="line">    UC_ARCH_PPC,        <span class="comment">// PowerPC architecture (currently unsupported)</span></span><br><span class="line">    UC_ARCH_SPARC,      <span class="comment">// Sparc architecture</span></span><br><span class="line">    UC_ARCH_M68K,       <span class="comment">// M68K architecture</span></span><br><span class="line">    UC_ARCH_MAX,</span><br><span class="line">&#125; uc_arch;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mode type</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> <span class="title">uc_mode</span> &#123;</span></span><br><span class="line">    UC_MODE_LITTLE_ENDIAN = <span class="number">0</span>,    <span class="comment">// little-endian mode (default mode)</span></span><br><span class="line">    UC_MODE_BIG_ENDIAN = <span class="number">1</span> &lt;&lt; <span class="number">30</span>, <span class="comment">// big-endian mode</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// arm / arm64</span></span><br><span class="line">    UC_MODE_ARM = <span class="number">0</span>,              <span class="comment">// ARM mode</span></span><br><span class="line">    UC_MODE_THUMB = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,       <span class="comment">// THUMB mode (including Thumb-2)</span></span><br><span class="line">    UC_MODE_MCLASS = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,      <span class="comment">// ARM&#x27;s Cortex-M series (currently unsupported)</span></span><br><span class="line">    UC_MODE_V8 = <span class="number">1</span> &lt;&lt; <span class="number">6</span>,          <span class="comment">// ARMv8 A32 encodings for ARM (currently unsupported)</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// arm (32bit) cpu types</span></span><br><span class="line">    UC_MODE_ARM926 = <span class="number">1</span> &lt;&lt; <span class="number">7</span>,      <span class="comment">// ARM926 CPU type</span></span><br><span class="line">    UC_MODE_ARM946 = <span class="number">1</span> &lt;&lt; <span class="number">8</span>,      <span class="comment">// ARM946 CPU type</span></span><br><span class="line">    UC_MODE_ARM1176 = <span class="number">1</span> &lt;&lt; <span class="number">9</span>,      <span class="comment">// ARM1176 CPU type</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ARM BE8</span></span><br><span class="line">    UC_MODE_ARMBE8 = <span class="number">1</span> &lt;&lt; <span class="number">10</span>,     <span class="comment">// Big-endian data and Little-endian code</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// mips</span></span><br><span class="line">    UC_MODE_MICRO = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,       <span class="comment">// MicroMips mode (currently unsupported)</span></span><br><span class="line">    UC_MODE_MIPS3 = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,       <span class="comment">// Mips III ISA (currently unsupported)</span></span><br><span class="line">    UC_MODE_MIPS32R6 = <span class="number">1</span> &lt;&lt; <span class="number">6</span>,    <span class="comment">// Mips32r6 ISA (currently unsupported)</span></span><br><span class="line">    UC_MODE_MIPS32 = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,      <span class="comment">// Mips32 ISA</span></span><br><span class="line">    UC_MODE_MIPS64 = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,      <span class="comment">// Mips64 ISA</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// x86 / x64</span></span><br><span class="line">    UC_MODE_16 = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,          <span class="comment">// 16-bit mode</span></span><br><span class="line">    UC_MODE_32 = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,          <span class="comment">// 32-bit mode</span></span><br><span class="line">    UC_MODE_64 = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,          <span class="comment">// 64-bit mode</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ppc</span></span><br><span class="line">    UC_MODE_PPC32 = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,       <span class="comment">// 32-bit mode (currently unsupported)</span></span><br><span class="line">    UC_MODE_PPC64 = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,       <span class="comment">// 64-bit mode (currently unsupported)</span></span><br><span class="line">    UC_MODE_QPX = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,         <span class="comment">// Quad Processing eXtensions mode (currently unsupported)</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// sparc</span></span><br><span class="line">    UC_MODE_SPARC32 = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,     <span class="comment">// 32-bit mode</span></span><br><span class="line">    UC_MODE_SPARC64 = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,     <span class="comment">// 64-bit mode</span></span><br><span class="line">    UC_MODE_V9 = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,          <span class="comment">// SparcV9 mode (currently unsupported)</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// m68k</span></span><br><span class="line">&#125; uc_mode;</span><br></pre></td></tr></table></figure>
<h3 id="uc-mem-map"><a href="#uc-mem-map" class="headerlink" title="uc_mem_map"></a>uc_mem_map</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Map memory in for emulation.</span></span><br><span class="line"><span class="comment"> This API adds a memory region that can be used by emulation.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @uc: handle returned by uc_open()</span></span><br><span class="line"><span class="comment"> @address: starting address of the new memory region to be mapped in.</span></span><br><span class="line"><span class="comment">    This address must be aligned to 4KB, or this will return with UC_ERR_ARG error.</span></span><br><span class="line"><span class="comment"> @size: size of the new memory region to be mapped in.</span></span><br><span class="line"><span class="comment">    This size must be a multiple of 4KB, or this will return with UC_ERR_ARG error.</span></span><br><span class="line"><span class="comment"> @perms: Permissions for the newly mapped region.</span></span><br><span class="line"><span class="comment">    This must be some combination of UC_PROT_READ | UC_PROT_WRITE | UC_PROT_EXEC,</span></span><br><span class="line"><span class="comment">    or this will return with UC_ERR_ARG error.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @return UC_ERR_OK on success, or other value on failure (refer to uc_err enum</span></span><br><span class="line"><span class="comment">   for detailed error).</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">UNICORN_EXPORT</span><br><span class="line">uc_err <span class="title function_">uc_mem_map</span><span class="params">(uc_engine *uc, <span class="type">uint64_t</span> address, <span class="type">size_t</span> size, <span class="type">uint32_t</span> perms)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>映射内存以进行仿真。<br>    该API添加了一个可供仿真使用的内存区域。<br>参数:<br>    @uc: uc_open() 返回的句柄<br>    @address：要映射到的新内存区域的起始地址。<br>        该地址必须与 4KB 对齐，否则将返回 UC_ERR_ARG 错误。<br>    @size：要映射到的新内存区域的大小。<br>        此大小必须是 4KB 的倍数，否则将返回 UC_ERR_ARG 错误。<br>    @perms：新映射区域的权限。<br>        这必须是 UC_PROT_READ | 的某种组合。 UC_PROT_WRITE | UC_PROT_EXEC,<br>        否则这将返回 UC_ERR_ARG 错误。<br>    @return UC_ERR_OK 成功，或其他值失败（参考 uc_err 枚举详细错误）。</p>
</blockquote>
<p>最后一个参数是uc_prot的枚举值：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> <span class="title">uc_prot</span> &#123;</span></span><br><span class="line">   UC_PROT_NONE = <span class="number">0</span>,</span><br><span class="line">   UC_PROT_READ = <span class="number">1</span>,</span><br><span class="line">   UC_PROT_WRITE = <span class="number">2</span>,</span><br><span class="line">   UC_PROT_EXEC = <span class="number">4</span>,</span><br><span class="line">   UC_PROT_ALL = <span class="number">7</span>,</span><br><span class="line">&#125; uc_prot;</span><br></pre></td></tr></table></figure>
<h3 id="uc-mem-write"><a href="#uc-mem-write" class="headerlink" title="uc_mem_write"></a>uc_mem_write</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Write to a range of bytes in memory.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @uc: handle returned by uc_open()</span></span><br><span class="line"><span class="comment"> @address: starting memory address of bytes to set.</span></span><br><span class="line"><span class="comment"> @bytes:   pointer to a variable containing data to be written to memory.</span></span><br><span class="line"><span class="comment"> @size:   size of memory to write to.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> <span class="doctag">NOTE:</span> @bytes must be big enough to contain @size bytes.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @return UC_ERR_OK on success, or other value on failure (refer to uc_err enum</span></span><br><span class="line"><span class="comment">   for detailed error).</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">UNICORN_EXPORT</span><br><span class="line">uc_err <span class="title function_">uc_mem_write</span><span class="params">(uc_engine *uc, <span class="type">uint64_t</span> address, <span class="type">const</span> <span class="type">void</span> *bytes, <span class="type">size_t</span> size)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>写入内存中的字节范围。<br>    @uc: uc_open() 返回的句柄<br>    @address：要设置的字节的起始内存地址。<br>    @bytes：指向包含要写入内存的数据的变量的指针。<br>    @size：要写入的内存大小。<br>    注意：@bytes 必须足够大以包含 @size 字节。<br>    @return UC_ERR_OK 成功，或其他值失败（参考 uc_err 枚举详细错误）</p>
</blockquote>
<h3 id="uc-reg-write"><a href="#uc-reg-write" class="headerlink" title="uc_reg_write"></a>uc_reg_write</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Write to register.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @uc: handle returned by uc_open()</span></span><br><span class="line"><span class="comment"> @regid:  register ID that is to be modified.</span></span><br><span class="line"><span class="comment"> @value:  pointer to the value that will set to register @regid</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @return UC_ERR_OK on success, or other value on failure (refer to uc_err enum</span></span><br><span class="line"><span class="comment">   for detailed error).</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">UNICORN_EXPORT</span><br><span class="line">uc_err <span class="title function_">uc_reg_write</span><span class="params">(uc_engine *uc, <span class="type">int</span> regid, <span class="type">const</span> <span class="type">void</span> *value)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>@uc: uc_open() 返回的句柄<br>@regid：要修改的注册ID。<br>@value：指向将设置为注册@regid 的值的指针<br>@return UC_ERR_OK 成功，或其他值失败（参考 uc_err 枚举详细错误）。</p>
</blockquote>
<p>第二个值是unicorn规定的x86寄存器的枚举值：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&gt; X86 registers</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> <span class="title">uc_x86_reg</span> &#123;</span></span><br><span class="line">    UC_X86_REG_INVALID = <span class="number">0</span>,</span><br><span class="line">    UC_X86_REG_AH, UC_X86_REG_AL, UC_X86_REG_AX, UC_X86_REG_BH, UC_X86_REG_BL,</span><br><span class="line">    UC_X86_REG_BP, UC_X86_REG_BPL, UC_X86_REG_BX, UC_X86_REG_CH, UC_X86_REG_CL,</span><br><span class="line">    UC_X86_REG_CS, UC_X86_REG_CX, UC_X86_REG_DH, UC_X86_REG_DI, UC_X86_REG_DIL,</span><br><span class="line">    UC_X86_REG_DL, UC_X86_REG_DS, UC_X86_REG_DX, UC_X86_REG_EAX, UC_X86_REG_EBP,</span><br><span class="line">    UC_X86_REG_EBX, UC_X86_REG_ECX, UC_X86_REG_EDI, UC_X86_REG_EDX, UC_X86_REG_EFLAGS,</span><br><span class="line">    UC_X86_REG_EIP, UC_X86_REG_EIZ, UC_X86_REG_ES, UC_X86_REG_ESI, UC_X86_REG_ESP,</span><br><span class="line">    UC_X86_REG_FPSW, UC_X86_REG_FS, UC_X86_REG_GS, UC_X86_REG_IP, UC_X86_REG_RAX,</span><br><span class="line">    UC_X86_REG_RBP, UC_X86_REG_RBX, UC_X86_REG_RCX, UC_X86_REG_RDI, UC_X86_REG_RDX,</span><br><span class="line">    UC_X86_REG_RIP, UC_X86_REG_RIZ, UC_X86_REG_RSI, UC_X86_REG_RSP, UC_X86_REG_SI,</span><br><span class="line">    UC_X86_REG_SIL, UC_X86_REG_SP, UC_X86_REG_SPL, UC_X86_REG_SS, UC_X86_REG_CR0,</span><br><span class="line">    UC_X86_REG_CR1, UC_X86_REG_CR2, UC_X86_REG_CR3, UC_X86_REG_CR4, UC_X86_REG_CR5,</span><br><span class="line">    UC_X86_REG_CR6, UC_X86_REG_CR7, UC_X86_REG_CR8, UC_X86_REG_CR9, UC_X86_REG_CR10,</span><br><span class="line">    UC_X86_REG_CR11, UC_X86_REG_CR12, UC_X86_REG_CR13, UC_X86_REG_CR14, UC_X86_REG_CR15,</span><br><span class="line">    UC_X86_REG_DR0, UC_X86_REG_DR1, UC_X86_REG_DR2, UC_X86_REG_DR3, UC_X86_REG_DR4,</span><br><span class="line">    UC_X86_REG_DR5, UC_X86_REG_DR6, UC_X86_REG_DR7, UC_X86_REG_DR8, UC_X86_REG_DR9,</span><br><span class="line">    UC_X86_REG_DR10, UC_X86_REG_DR11, UC_X86_REG_DR12, UC_X86_REG_DR13, UC_X86_REG_DR14,</span><br><span class="line">    UC_X86_REG_DR15, UC_X86_REG_FP0, UC_X86_REG_FP1, UC_X86_REG_FP2, UC_X86_REG_FP3,</span><br><span class="line">    UC_X86_REG_FP4, UC_X86_REG_FP5, UC_X86_REG_FP6, UC_X86_REG_FP7,</span><br><span class="line">    UC_X86_REG_K0, UC_X86_REG_K1, UC_X86_REG_K2, UC_X86_REG_K3, UC_X86_REG_K4,</span><br><span class="line">    UC_X86_REG_K5, UC_X86_REG_K6, UC_X86_REG_K7, UC_X86_REG_MM0, UC_X86_REG_MM1,</span><br><span class="line">    UC_X86_REG_MM2, UC_X86_REG_MM3, UC_X86_REG_MM4, UC_X86_REG_MM5, UC_X86_REG_MM6,</span><br><span class="line">    UC_X86_REG_MM7, UC_X86_REG_R8, UC_X86_REG_R9, UC_X86_REG_R10, UC_X86_REG_R11,</span><br><span class="line">    UC_X86_REG_R12, UC_X86_REG_R13, UC_X86_REG_R14, UC_X86_REG_R15,</span><br><span class="line">    UC_X86_REG_ST0, UC_X86_REG_ST1, UC_X86_REG_ST2, UC_X86_REG_ST3,</span><br><span class="line">    UC_X86_REG_ST4, UC_X86_REG_ST5, UC_X86_REG_ST6, UC_X86_REG_ST7,</span><br><span class="line">    UC_X86_REG_XMM0, UC_X86_REG_XMM1, UC_X86_REG_XMM2, UC_X86_REG_XMM3, UC_X86_REG_XMM4,</span><br><span class="line">    UC_X86_REG_XMM5, UC_X86_REG_XMM6, UC_X86_REG_XMM7, UC_X86_REG_XMM8, UC_X86_REG_XMM9,</span><br><span class="line">    UC_X86_REG_XMM10, UC_X86_REG_XMM11, UC_X86_REG_XMM12, UC_X86_REG_XMM13, UC_X86_REG_XMM14,</span><br><span class="line">    UC_X86_REG_XMM15, UC_X86_REG_XMM16, UC_X86_REG_XMM17, UC_X86_REG_XMM18, UC_X86_REG_XMM19,</span><br><span class="line">    UC_X86_REG_XMM20, UC_X86_REG_XMM21, UC_X86_REG_XMM22, UC_X86_REG_XMM23, UC_X86_REG_XMM24,</span><br><span class="line">    UC_X86_REG_XMM25, UC_X86_REG_XMM26, UC_X86_REG_XMM27, UC_X86_REG_XMM28, UC_X86_REG_XMM29,</span><br><span class="line">    UC_X86_REG_XMM30, UC_X86_REG_XMM31, UC_X86_REG_YMM0, UC_X86_REG_YMM1, UC_X86_REG_YMM2,</span><br><span class="line">    UC_X86_REG_YMM3, UC_X86_REG_YMM4, UC_X86_REG_YMM5, UC_X86_REG_YMM6, UC_X86_REG_YMM7,</span><br><span class="line">    UC_X86_REG_YMM8, UC_X86_REG_YMM9, UC_X86_REG_YMM10, UC_X86_REG_YMM11, UC_X86_REG_YMM12,</span><br><span class="line">    UC_X86_REG_YMM13, UC_X86_REG_YMM14, UC_X86_REG_YMM15, UC_X86_REG_YMM16, UC_X86_REG_YMM17,</span><br><span class="line">    UC_X86_REG_YMM18, UC_X86_REG_YMM19, UC_X86_REG_YMM20, UC_X86_REG_YMM21, UC_X86_REG_YMM22,</span><br><span class="line">    UC_X86_REG_YMM23, UC_X86_REG_YMM24, UC_X86_REG_YMM25, UC_X86_REG_YMM26, UC_X86_REG_YMM27,</span><br><span class="line">    UC_X86_REG_YMM28, UC_X86_REG_YMM29, UC_X86_REG_YMM30, UC_X86_REG_YMM31, UC_X86_REG_ZMM0,</span><br><span class="line">    UC_X86_REG_ZMM1, UC_X86_REG_ZMM2, UC_X86_REG_ZMM3, UC_X86_REG_ZMM4, UC_X86_REG_ZMM5,</span><br><span class="line">    UC_X86_REG_ZMM6, UC_X86_REG_ZMM7, UC_X86_REG_ZMM8, UC_X86_REG_ZMM9, UC_X86_REG_ZMM10,</span><br><span class="line">    UC_X86_REG_ZMM11, UC_X86_REG_ZMM12, UC_X86_REG_ZMM13, UC_X86_REG_ZMM14, UC_X86_REG_ZMM15,</span><br><span class="line">    UC_X86_REG_ZMM16, UC_X86_REG_ZMM17, UC_X86_REG_ZMM18, UC_X86_REG_ZMM19, UC_X86_REG_ZMM20,</span><br><span class="line">    UC_X86_REG_ZMM21, UC_X86_REG_ZMM22, UC_X86_REG_ZMM23, UC_X86_REG_ZMM24, UC_X86_REG_ZMM25,</span><br><span class="line">    UC_X86_REG_ZMM26, UC_X86_REG_ZMM27, UC_X86_REG_ZMM28, UC_X86_REG_ZMM29, UC_X86_REG_ZMM30,</span><br><span class="line">    UC_X86_REG_ZMM31, UC_X86_REG_R8B, UC_X86_REG_R9B, UC_X86_REG_R10B, UC_X86_REG_R11B,</span><br><span class="line">    UC_X86_REG_R12B, UC_X86_REG_R13B, UC_X86_REG_R14B, UC_X86_REG_R15B, UC_X86_REG_R8D,</span><br><span class="line">    UC_X86_REG_R9D, UC_X86_REG_R10D, UC_X86_REG_R11D, UC_X86_REG_R12D, UC_X86_REG_R13D,</span><br><span class="line">    UC_X86_REG_R14D, UC_X86_REG_R15D, UC_X86_REG_R8W, UC_X86_REG_R9W, UC_X86_REG_R10W,</span><br><span class="line">    UC_X86_REG_R11W, UC_X86_REG_R12W, UC_X86_REG_R13W, UC_X86_REG_R14W, UC_X86_REG_R15W,</span><br><span class="line">    UC_X86_REG_IDTR, UC_X86_REG_GDTR, UC_X86_REG_LDTR, UC_X86_REG_TR, UC_X86_REG_FPCW,</span><br><span class="line">    UC_X86_REG_FPTAG,</span><br><span class="line">    UC_X86_REG_MSR, <span class="comment">// Model-Specific Register</span></span><br><span class="line">    UC_X86_REG_MXCSR,</span><br><span class="line">    UC_X86_REG_FS_BASE, <span class="comment">// Base regs for x86_64</span></span><br><span class="line">    UC_X86_REG_GS_BASE,</span><br><span class="line">    UC_X86_REG_ENDING        <span class="comment">// &lt;-- mark the end of the list of registers</span></span><br><span class="line">&#125; uc_x86_reg;</span><br></pre></td></tr></table></figure>
<h3 id="uc-hook-add"><a href="#uc-hook-add" class="headerlink" title="uc_hook_add"></a>uc_hook_add</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Register callback for a hook event.</span></span><br><span class="line"><span class="comment"> The callback will be run when the hook event is hit.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @uc: handle returned by uc_open()</span></span><br><span class="line"><span class="comment"> @hh: hook handle returned from this registration. To be used in uc_hook_del() API</span></span><br><span class="line"><span class="comment"> @type: hook type, refer to uc_hook_type enum</span></span><br><span class="line"><span class="comment"> @callback: callback to be run when instruction is hit</span></span><br><span class="line"><span class="comment"> @user_data: user-defined data. This will be passed to callback function in its</span></span><br><span class="line"><span class="comment">      last argument @user_data</span></span><br><span class="line"><span class="comment"> @begin: start address of the area where the callback is in effect (inclusive)</span></span><br><span class="line"><span class="comment"> @end: end address of the area where the callback is in effect (inclusive)</span></span><br><span class="line"><span class="comment">   NOTE 1: the callback is called only if related address is in range [@begin, @end]</span></span><br><span class="line"><span class="comment">   NOTE 2: if @begin &gt; @end, callback is called whenever this hook type is triggered</span></span><br><span class="line"><span class="comment"> @...: variable arguments (depending on @type)</span></span><br><span class="line"><span class="comment">   <span class="doctag">NOTE:</span> if @type = UC_HOOK_INSN, this is the instruction ID (ex: UC_X86_INS_OUT)</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> @return UC_ERR_OK on success, or other value on failure (refer to uc_err enum</span></span><br><span class="line"><span class="comment">   for detailed error).</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">UNICORN_EXPORT</span><br><span class="line">uc_err <span class="title function_">uc_hook_add</span><span class="params">(uc_engine *uc, uc_hook *hh, <span class="type">int</span> type, <span class="type">void</span> *callback,</span></span><br><span class="line"><span class="params">        <span class="type">void</span> *user_data, <span class="type">uint64_t</span> begin, <span class="type">uint64_t</span> end, ...)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>为钩子事件注册回调<br>当钩子事件被命中时，回调将运行</strong></p>
<p>@uc: uc_open() 返回的句柄<br>@hh：<strong>从这个注册函数返回的钩子句柄</strong>。用于 uc_hook_del() API<br><strong>@type：钩子类型，参考uc_hook_type枚举</strong><br><strong>@callback：当指令被命中时运行的回调</strong><br><strong>@user_data：用户定义的数据。这将传递给回调函数的最后一个参数@user_data</strong><br>@begin：回调生效区域的起始地址（含）<br>@end：回调生效区域的结束地址（含）<br>    注意 1：仅当相关地址在 [@begin, @end] 范围内时才会调用回调<br>    注意 2：如果 @begin &gt; @end，每当触发此钩子类型时都会调用回调<br>@…：可变参数（取决于@type）<br>    <strong>注意：如果@type = UC_HOOK_INSN，这是指令ID（例如：UC_X86_INS_OUT）</strong><br>@return UC_ERR_OK 成功，或其他值失败（参考 uc_err 枚举详细错误）。</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// All type of hooks for uc_hook_add() API.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> <span class="title">uc_hook_type</span> &#123;</span></span><br><span class="line">    <span class="comment">// Hook all interrupt/syscall events</span></span><br><span class="line">    UC_HOOK_INTR = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</span><br><span class="line">    **<span class="comment">// Hook a particular instruction - only a very small subset of instructions supported here</span></span><br><span class="line">    UC_HOOK_INSN = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,**</span><br><span class="line">    <span class="comment">// Hook a range of code</span></span><br><span class="line">    UC_HOOK_CODE = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line">    <span class="comment">// Hook basic blocks</span></span><br><span class="line">    UC_HOOK_BLOCK = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line">    <span class="comment">// Hook for memory read on unmapped memory</span></span><br><span class="line">    UC_HOOK_MEM_READ_UNMAPPED = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</span><br><span class="line">    <span class="comment">// Hook for invalid memory write events</span></span><br><span class="line">    UC_HOOK_MEM_WRITE_UNMAPPED = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,</span><br><span class="line">    <span class="comment">// Hook for invalid memory fetch for execution events</span></span><br><span class="line">    UC_HOOK_MEM_FETCH_UNMAPPED = <span class="number">1</span> &lt;&lt; <span class="number">6</span>,</span><br><span class="line">    <span class="comment">// Hook for memory read on read-protected memory</span></span><br><span class="line">    UC_HOOK_MEM_READ_PROT = <span class="number">1</span> &lt;&lt; <span class="number">7</span>,</span><br><span class="line">    <span class="comment">// Hook for memory write on write-protected memory</span></span><br><span class="line">    UC_HOOK_MEM_WRITE_PROT = <span class="number">1</span> &lt;&lt; <span class="number">8</span>,</span><br><span class="line">    <span class="comment">// Hook for memory fetch on non-executable memory</span></span><br><span class="line">    UC_HOOK_MEM_FETCH_PROT = <span class="number">1</span> &lt;&lt; <span class="number">9</span>,</span><br><span class="line">    **<span class="comment">// Hook memory read events.</span></span><br><span class="line">    UC_HOOK_MEM_READ = <span class="number">1</span> &lt;&lt; <span class="number">10</span>,**</span><br><span class="line">    <span class="comment">// Hook memory write events.</span></span><br><span class="line">    UC_HOOK_MEM_WRITE = <span class="number">1</span> &lt;&lt; <span class="number">11</span>,</span><br><span class="line">    <span class="comment">// Hook memory fetch for execution events</span></span><br><span class="line">    UC_HOOK_MEM_FETCH = <span class="number">1</span> &lt;&lt; <span class="number">12</span>,</span><br><span class="line">    <span class="comment">// Hook memory read events, but only successful access.</span></span><br><span class="line">    <span class="comment">// The callback will be triggered after successful read.</span></span><br><span class="line">    UC_HOOK_MEM_READ_AFTER = <span class="number">1</span> &lt;&lt; <span class="number">13</span>,</span><br><span class="line">    <span class="comment">// Hook invalid instructions exceptions.</span></span><br><span class="line">    UC_HOOK_INSN_INVALID = <span class="number">1</span> &lt;&lt; <span class="number">14</span>,</span><br><span class="line">&#125; uc_hook_type;</span><br></pre></td></tr></table></figure>
<p>uc_hook_add的第三个参数的值是2，即(uc_hook_type)UC_HOOK_INSN， 钩住一个特定的指令——这里只支持非常小的指令子集</p>
<p>如果第三个参数的值是0x400，说明这是钩取的内存读 <strong>// Hook memory read events.</strong></p>
<p>反正这个函数的关键就在第三个参数</p>
<p>最后一个参数，就像函数声明中说的一样，如果@type = UC_HOOK_INSN，这是指令ID（例如：UC_X86_INS_OUT，就是一些X86的指令，枚举值如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br></pre></td><td class="code"><pre><span class="line">//&gt; X86 instructions</span><br><span class="line">typedef enum uc_x86_insn &#123;</span><br><span class="line">    UC_X86_INS_INVALID = 0,</span><br><span class="line">    UC_X86_INS_AAA,</span><br><span class="line">    UC_X86_INS_AAD,</span><br><span class="line">    UC_X86_INS_AAM,</span><br><span class="line">    UC_X86_INS_AAS,</span><br><span class="line">    UC_X86_INS_FABS,</span><br><span class="line">    UC_X86_INS_ADC,</span><br><span class="line">    UC_X86_INS_ADCX,</span><br><span class="line">    UC_X86_INS_ADD,</span><br><span class="line">    UC_X86_INS_ADDPD,</span><br><span class="line">    UC_X86_INS_ADDPS,</span><br><span class="line">    UC_X86_INS_ADDSD,</span><br><span class="line">    UC_X86_INS_ADDSS,</span><br><span class="line">    UC_X86_INS_ADDSUBPD,</span><br><span class="line">    UC_X86_INS_ADDSUBPS,</span><br><span class="line">    UC_X86_INS_FADD,</span><br><span class="line">    UC_X86_INS_FIADD,</span><br><span class="line">    UC_X86_INS_FADDP,</span><br><span class="line">    UC_X86_INS_ADOX,</span><br><span class="line">    UC_X86_INS_AESDECLAST,</span><br><span class="line">    UC_X86_INS_AESDEC,</span><br><span class="line">    UC_X86_INS_AESENCLAST,</span><br><span class="line">    UC_X86_INS_AESENC,</span><br><span class="line">    UC_X86_INS_AESIMC,</span><br><span class="line">    UC_X86_INS_AESKEYGENASSIST,</span><br><span class="line">    UC_X86_INS_AND,</span><br><span class="line">    UC_X86_INS_ANDN,</span><br><span class="line">    UC_X86_INS_ANDNPD,</span><br><span class="line">    UC_X86_INS_ANDNPS,</span><br><span class="line">    UC_X86_INS_ANDPD,</span><br><span class="line">    UC_X86_INS_ANDPS,</span><br><span class="line">    UC_X86_INS_ARPL,</span><br><span class="line">    UC_X86_INS_BEXTR,</span><br><span class="line">    UC_X86_INS_BLCFILL,</span><br><span class="line">    UC_X86_INS_BLCI,</span><br><span class="line">    UC_X86_INS_BLCIC,</span><br><span class="line">    UC_X86_INS_BLCMSK,</span><br><span class="line">    UC_X86_INS_BLCS,</span><br><span class="line">    UC_X86_INS_BLENDPD,</span><br><span class="line">    UC_X86_INS_BLENDPS,</span><br><span class="line">    UC_X86_INS_BLENDVPD,</span><br><span class="line">    UC_X86_INS_BLENDVPS,</span><br><span class="line">    UC_X86_INS_BLSFILL,</span><br><span class="line">    UC_X86_INS_BLSI,</span><br><span class="line">    UC_X86_INS_BLSIC,</span><br><span class="line">    UC_X86_INS_BLSMSK,</span><br><span class="line">    UC_X86_INS_BLSR,</span><br><span class="line">    UC_X86_INS_BOUND,</span><br><span class="line">    UC_X86_INS_BSF,</span><br><span class="line">    UC_X86_INS_BSR,</span><br><span class="line">    UC_X86_INS_BSWAP,</span><br><span class="line">    UC_X86_INS_BT,</span><br><span class="line">    UC_X86_INS_BTC,</span><br><span class="line">    UC_X86_INS_BTR,</span><br><span class="line">    UC_X86_INS_BTS,</span><br><span class="line">    UC_X86_INS_BZHI,</span><br><span class="line">    UC_X86_INS_CALL,</span><br><span class="line">    UC_X86_INS_CBW,</span><br><span class="line">    UC_X86_INS_CDQ,</span><br><span class="line">    UC_X86_INS_CDQE,</span><br><span class="line">    UC_X86_INS_FCHS,</span><br><span class="line">    UC_X86_INS_CLAC,</span><br><span class="line">    UC_X86_INS_CLC,</span><br><span class="line">    UC_X86_INS_CLD,</span><br><span class="line">    UC_X86_INS_CLFLUSH,</span><br><span class="line">    UC_X86_INS_CLFLUSHOPT,</span><br><span class="line">    UC_X86_INS_CLGI,</span><br><span class="line">    UC_X86_INS_CLI,</span><br><span class="line">    UC_X86_INS_CLTS,</span><br><span class="line">    UC_X86_INS_CLWB,</span><br><span class="line">    UC_X86_INS_CMC,</span><br><span class="line">    UC_X86_INS_CMOVA,</span><br><span class="line">    UC_X86_INS_CMOVAE,</span><br><span class="line">    UC_X86_INS_CMOVB,</span><br><span class="line">    UC_X86_INS_CMOVBE,</span><br><span class="line">    UC_X86_INS_FCMOVBE,</span><br><span class="line">    UC_X86_INS_FCMOVB,</span><br><span class="line">    UC_X86_INS_CMOVE,</span><br><span class="line">    UC_X86_INS_FCMOVE,</span><br><span class="line">    UC_X86_INS_CMOVG,</span><br><span class="line">    UC_X86_INS_CMOVGE,</span><br><span class="line">    UC_X86_INS_CMOVL,</span><br><span class="line">    UC_X86_INS_CMOVLE,</span><br><span class="line">    UC_X86_INS_FCMOVNBE,</span><br><span class="line">    UC_X86_INS_FCMOVNB,</span><br><span class="line">    UC_X86_INS_CMOVNE,</span><br><span class="line">    UC_X86_INS_FCMOVNE,</span><br><span class="line">    UC_X86_INS_CMOVNO,</span><br><span class="line">    UC_X86_INS_CMOVNP,</span><br><span class="line">    UC_X86_INS_FCMOVNU,</span><br><span class="line">    UC_X86_INS_CMOVNS,</span><br><span class="line">    UC_X86_INS_CMOVO,</span><br><span class="line">    UC_X86_INS_CMOVP,</span><br><span class="line">    UC_X86_INS_FCMOVU,</span><br><span class="line">    UC_X86_INS_CMOVS,</span><br><span class="line">    UC_X86_INS_CMP,</span><br><span class="line">    UC_X86_INS_CMPPD,</span><br><span class="line">    UC_X86_INS_CMPPS,</span><br><span class="line">    UC_X86_INS_CMPSB,</span><br><span class="line">    UC_X86_INS_CMPSD,</span><br><span class="line">    UC_X86_INS_CMPSQ,</span><br><span class="line">    UC_X86_INS_CMPSS,</span><br><span class="line">    UC_X86_INS_CMPSW,</span><br><span class="line">    UC_X86_INS_CMPXCHG16B,</span><br><span class="line">    UC_X86_INS_CMPXCHG,</span><br><span class="line">    UC_X86_INS_CMPXCHG8B,</span><br><span class="line">    UC_X86_INS_COMISD,</span><br><span class="line">    UC_X86_INS_COMISS,</span><br><span class="line">    UC_X86_INS_FCOMP,</span><br><span class="line">    UC_X86_INS_FCOMPI,</span><br><span class="line">    UC_X86_INS_FCOMI,</span><br><span class="line">    UC_X86_INS_FCOM,</span><br><span class="line">    UC_X86_INS_FCOS,</span><br><span class="line">    UC_X86_INS_CPUID,</span><br><span class="line">    UC_X86_INS_CQO,</span><br><span class="line">    UC_X86_INS_CRC32,</span><br><span class="line">    UC_X86_INS_CVTDQ2PD,</span><br><span class="line">    UC_X86_INS_CVTDQ2PS,</span><br><span class="line">    UC_X86_INS_CVTPD2DQ,</span><br><span class="line">    UC_X86_INS_CVTPD2PS,</span><br><span class="line">    UC_X86_INS_CVTPS2DQ,</span><br><span class="line">    UC_X86_INS_CVTPS2PD,</span><br><span class="line">    UC_X86_INS_CVTSD2SI,</span><br><span class="line">    UC_X86_INS_CVTSD2SS,</span><br><span class="line">    UC_X86_INS_CVTSI2SD,</span><br><span class="line">    UC_X86_INS_CVTSI2SS,</span><br><span class="line">    UC_X86_INS_CVTSS2SD,</span><br><span class="line">    UC_X86_INS_CVTSS2SI,</span><br><span class="line">    UC_X86_INS_CVTTPD2DQ,</span><br><span class="line">    UC_X86_INS_CVTTPS2DQ,</span><br><span class="line">    UC_X86_INS_CVTTSD2SI,</span><br><span class="line">    UC_X86_INS_CVTTSS2SI,</span><br><span class="line">    UC_X86_INS_CWD,</span><br><span class="line">    UC_X86_INS_CWDE,</span><br><span class="line">    UC_X86_INS_DAA,</span><br><span class="line">    UC_X86_INS_DAS,</span><br><span class="line">    UC_X86_INS_DATA16,</span><br><span class="line">    UC_X86_INS_DEC,</span><br><span class="line">    UC_X86_INS_DIV,</span><br><span class="line">    UC_X86_INS_DIVPD,</span><br><span class="line">    UC_X86_INS_DIVPS,</span><br><span class="line">    UC_X86_INS_FDIVR,</span><br><span class="line">    UC_X86_INS_FIDIVR,</span><br><span class="line">    UC_X86_INS_FDIVRP,</span><br><span class="line">    UC_X86_INS_DIVSD,</span><br><span class="line">    UC_X86_INS_DIVSS,</span><br><span class="line">    UC_X86_INS_FDIV,</span><br><span class="line">    UC_X86_INS_FIDIV,</span><br><span class="line">    UC_X86_INS_FDIVP,</span><br><span class="line">    UC_X86_INS_DPPD,</span><br><span class="line">    UC_X86_INS_DPPS,</span><br><span class="line">    UC_X86_INS_RET,</span><br><span class="line">    UC_X86_INS_ENCLS,</span><br><span class="line">    UC_X86_INS_ENCLU,</span><br><span class="line">    UC_X86_INS_ENTER,</span><br><span class="line">    UC_X86_INS_EXTRACTPS,</span><br><span class="line">    UC_X86_INS_EXTRQ,</span><br><span class="line">    UC_X86_INS_F2XM1,</span><br><span class="line">    UC_X86_INS_LCALL,</span><br><span class="line">    UC_X86_INS_LJMP,</span><br><span class="line">    UC_X86_INS_FBLD,</span><br><span class="line">    UC_X86_INS_FBSTP,</span><br><span class="line">    UC_X86_INS_FCOMPP,</span><br><span class="line">    UC_X86_INS_FDECSTP,</span><br><span class="line">    UC_X86_INS_FEMMS,</span><br><span class="line">    UC_X86_INS_FFREE,</span><br><span class="line">    UC_X86_INS_FICOM,</span><br><span class="line">    UC_X86_INS_FICOMP,</span><br><span class="line">    UC_X86_INS_FINCSTP,</span><br><span class="line">    UC_X86_INS_FLDCW,</span><br><span class="line">    UC_X86_INS_FLDENV,</span><br><span class="line">    UC_X86_INS_FLDL2E,</span><br><span class="line">    UC_X86_INS_FLDL2T,</span><br><span class="line">    UC_X86_INS_FLDLG2,</span><br><span class="line">    UC_X86_INS_FLDLN2,</span><br><span class="line">    UC_X86_INS_FLDPI,</span><br><span class="line">    UC_X86_INS_FNCLEX,</span><br><span class="line">    UC_X86_INS_FNINIT,</span><br><span class="line">    UC_X86_INS_FNOP,</span><br><span class="line">    UC_X86_INS_FNSTCW,</span><br><span class="line">    UC_X86_INS_FNSTSW,</span><br><span class="line">    UC_X86_INS_FPATAN,</span><br><span class="line">    UC_X86_INS_FPREM,</span><br><span class="line">    UC_X86_INS_FPREM1,</span><br><span class="line">    UC_X86_INS_FPTAN,</span><br><span class="line">    UC_X86_INS_FFREEP,</span><br><span class="line">    UC_X86_INS_FRNDINT,</span><br><span class="line">    UC_X86_INS_FRSTOR,</span><br><span class="line">    UC_X86_INS_FNSAVE,</span><br><span class="line">    UC_X86_INS_FSCALE,</span><br><span class="line">    UC_X86_INS_FSETPM,</span><br><span class="line">    UC_X86_INS_FSINCOS,</span><br><span class="line">    UC_X86_INS_FNSTENV,</span><br><span class="line">    UC_X86_INS_FXAM,</span><br><span class="line">    UC_X86_INS_FXRSTOR,</span><br><span class="line">    UC_X86_INS_FXRSTOR64,</span><br><span class="line">    UC_X86_INS_FXSAVE,</span><br><span class="line">    UC_X86_INS_FXSAVE64,</span><br><span class="line">    UC_X86_INS_FXTRACT,</span><br><span class="line">    UC_X86_INS_FYL2X,</span><br><span class="line">    UC_X86_INS_FYL2XP1,</span><br><span class="line">    UC_X86_INS_MOVAPD,</span><br><span class="line">    UC_X86_INS_MOVAPS,</span><br><span class="line">    UC_X86_INS_ORPD,</span><br><span class="line">    UC_X86_INS_ORPS,</span><br><span class="line">    UC_X86_INS_VMOVAPD,</span><br><span class="line">    UC_X86_INS_VMOVAPS,</span><br><span class="line">    UC_X86_INS_XORPD,</span><br><span class="line">    UC_X86_INS_XORPS,</span><br><span class="line">    UC_X86_INS_GETSEC,</span><br><span class="line">    UC_X86_INS_HADDPD,</span><br><span class="line">    UC_X86_INS_HADDPS,</span><br><span class="line">    UC_X86_INS_HLT,</span><br><span class="line">    UC_X86_INS_HSUBPD,</span><br><span class="line">    UC_X86_INS_HSUBPS,</span><br><span class="line">    UC_X86_INS_IDIV,</span><br><span class="line">    UC_X86_INS_FILD,</span><br><span class="line">    UC_X86_INS_IMUL,</span><br><span class="line">    UC_X86_INS_IN,</span><br><span class="line">    UC_X86_INS_INC,</span><br><span class="line">    UC_X86_INS_INSB,</span><br><span class="line">    UC_X86_INS_INSERTPS,</span><br><span class="line">    UC_X86_INS_INSERTQ,</span><br><span class="line">    UC_X86_INS_INSD,</span><br><span class="line">    UC_X86_INS_INSW,</span><br><span class="line">    UC_X86_INS_INT,</span><br><span class="line">    UC_X86_INS_INT1,</span><br><span class="line">    UC_X86_INS_INT3,</span><br><span class="line">    UC_X86_INS_INTO,</span><br><span class="line">    UC_X86_INS_INVD,</span><br><span class="line">    UC_X86_INS_INVEPT,</span><br><span class="line">    UC_X86_INS_INVLPG,</span><br><span class="line">    UC_X86_INS_INVLPGA,</span><br><span class="line">    UC_X86_INS_INVPCID,</span><br><span class="line">    UC_X86_INS_INVVPID,</span><br><span class="line">    UC_X86_INS_IRET,</span><br><span class="line">    UC_X86_INS_IRETD,</span><br><span class="line">    UC_X86_INS_IRETQ,</span><br><span class="line">    UC_X86_INS_FISTTP,</span><br><span class="line">    UC_X86_INS_FIST,</span><br><span class="line">    UC_X86_INS_FISTP,</span><br><span class="line">    UC_X86_INS_UCOMISD,</span><br><span class="line">    UC_X86_INS_UCOMISS,</span><br><span class="line">    UC_X86_INS_VCOMISD,</span><br><span class="line">    UC_X86_INS_VCOMISS,</span><br><span class="line">    UC_X86_INS_VCVTSD2SS,</span><br><span class="line">    UC_X86_INS_VCVTSI2SD,</span><br><span class="line">    UC_X86_INS_VCVTSI2SS,</span><br><span class="line">    UC_X86_INS_VCVTSS2SD,</span><br><span class="line">    UC_X86_INS_VCVTTSD2SI,</span><br><span class="line">    UC_X86_INS_VCVTTSD2USI,</span><br><span class="line">    UC_X86_INS_VCVTTSS2SI,</span><br><span class="line">    UC_X86_INS_VCVTTSS2USI,</span><br><span class="line">    UC_X86_INS_VCVTUSI2SD,</span><br><span class="line">    UC_X86_INS_VCVTUSI2SS,</span><br><span class="line">    UC_X86_INS_VUCOMISD,</span><br><span class="line">    UC_X86_INS_VUCOMISS,</span><br><span class="line">    UC_X86_INS_JAE,</span><br><span class="line">    UC_X86_INS_JA,</span><br><span class="line">    UC_X86_INS_JBE,</span><br><span class="line">    UC_X86_INS_JB,</span><br><span class="line">    UC_X86_INS_JCXZ,</span><br><span class="line">    UC_X86_INS_JECXZ,</span><br><span class="line">    UC_X86_INS_JE,</span><br><span class="line">    UC_X86_INS_JGE,</span><br><span class="line">    UC_X86_INS_JG,</span><br><span class="line">    UC_X86_INS_JLE,</span><br><span class="line">    UC_X86_INS_JL,</span><br><span class="line">    UC_X86_INS_JMP,</span><br><span class="line">    UC_X86_INS_JNE,</span><br><span class="line">    UC_X86_INS_JNO,</span><br><span class="line">    UC_X86_INS_JNP,</span><br><span class="line">    UC_X86_INS_JNS,</span><br><span class="line">    UC_X86_INS_JO,</span><br><span class="line">    UC_X86_INS_JP,</span><br><span class="line">    UC_X86_INS_JRCXZ,</span><br><span class="line">    UC_X86_INS_JS,</span><br><span class="line">    UC_X86_INS_KANDB,</span><br><span class="line">    UC_X86_INS_KANDD,</span><br><span class="line">    UC_X86_INS_KANDNB,</span><br><span class="line">    UC_X86_INS_KANDND,</span><br><span class="line">    UC_X86_INS_KANDNQ,</span><br><span class="line">    UC_X86_INS_KANDNW,</span><br><span class="line">    UC_X86_INS_KANDQ,</span><br><span class="line">    UC_X86_INS_KANDW,</span><br><span class="line">    UC_X86_INS_KMOVB,</span><br><span class="line">    UC_X86_INS_KMOVD,</span><br><span class="line">    UC_X86_INS_KMOVQ,</span><br><span class="line">    UC_X86_INS_KMOVW,</span><br><span class="line">    UC_X86_INS_KNOTB,</span><br><span class="line">    UC_X86_INS_KNOTD,</span><br><span class="line">    UC_X86_INS_KNOTQ,</span><br><span class="line">    UC_X86_INS_KNOTW,</span><br><span class="line">    UC_X86_INS_KORB,</span><br><span class="line">    UC_X86_INS_KORD,</span><br><span class="line">    UC_X86_INS_KORQ,</span><br><span class="line">    UC_X86_INS_KORTESTB,</span><br><span class="line">    UC_X86_INS_KORTESTD,</span><br><span class="line">    UC_X86_INS_KORTESTQ,</span><br><span class="line">    UC_X86_INS_KORTESTW,</span><br><span class="line">    UC_X86_INS_KORW,</span><br><span class="line">    UC_X86_INS_KSHIFTLB,</span><br><span class="line">    UC_X86_INS_KSHIFTLD,</span><br><span class="line">    UC_X86_INS_KSHIFTLQ,</span><br><span class="line">    UC_X86_INS_KSHIFTLW,</span><br><span class="line">    UC_X86_INS_KSHIFTRB,</span><br><span class="line">    UC_X86_INS_KSHIFTRD,</span><br><span class="line">    UC_X86_INS_KSHIFTRQ,</span><br><span class="line">    UC_X86_INS_KSHIFTRW,</span><br><span class="line">    UC_X86_INS_KUNPCKBW,</span><br><span class="line">    UC_X86_INS_KXNORB,</span><br><span class="line">    UC_X86_INS_KXNORD,</span><br><span class="line">    UC_X86_INS_KXNORQ,</span><br><span class="line">    UC_X86_INS_KXNORW,</span><br><span class="line">    UC_X86_INS_KXORB,</span><br><span class="line">    UC_X86_INS_KXORD,</span><br><span class="line">    UC_X86_INS_KXORQ,</span><br><span class="line">    UC_X86_INS_KXORW,</span><br><span class="line">    UC_X86_INS_LAHF,</span><br><span class="line">    UC_X86_INS_LAR,</span><br><span class="line">    UC_X86_INS_LDDQU,</span><br><span class="line">    UC_X86_INS_LDMXCSR,</span><br><span class="line">    UC_X86_INS_LDS,</span><br><span class="line">    UC_X86_INS_FLDZ,</span><br><span class="line">    UC_X86_INS_FLD1,</span><br><span class="line">    UC_X86_INS_FLD,</span><br><span class="line">    UC_X86_INS_LEA,</span><br><span class="line">    UC_X86_INS_LEAVE,</span><br><span class="line">    UC_X86_INS_LES,</span><br><span class="line">    UC_X86_INS_LFENCE,</span><br><span class="line">    UC_X86_INS_LFS,</span><br><span class="line">    UC_X86_INS_LGDT,</span><br><span class="line">    UC_X86_INS_LGS,</span><br><span class="line">    UC_X86_INS_LIDT,</span><br><span class="line">    UC_X86_INS_LLDT,</span><br><span class="line">    UC_X86_INS_LMSW,</span><br><span class="line">    UC_X86_INS_OR,</span><br><span class="line">    UC_X86_INS_SUB,</span><br><span class="line">    UC_X86_INS_XOR,</span><br><span class="line">    UC_X86_INS_LODSB,</span><br><span class="line">    UC_X86_INS_LODSD,</span><br><span class="line">    UC_X86_INS_LODSQ,</span><br><span class="line">    UC_X86_INS_LODSW,</span><br><span class="line">    UC_X86_INS_LOOP,</span><br><span class="line">    UC_X86_INS_LOOPE,</span><br><span class="line">    UC_X86_INS_LOOPNE,</span><br><span class="line">    UC_X86_INS_RETF,</span><br><span class="line">    UC_X86_INS_RETFQ,</span><br><span class="line">    UC_X86_INS_LSL,</span><br><span class="line">    UC_X86_INS_LSS,</span><br><span class="line">    UC_X86_INS_LTR,</span><br><span class="line">    UC_X86_INS_XADD,</span><br><span class="line">    UC_X86_INS_LZCNT,</span><br><span class="line">    UC_X86_INS_MASKMOVDQU,</span><br><span class="line">    UC_X86_INS_MAXPD,</span><br><span class="line">    UC_X86_INS_MAXPS,</span><br><span class="line">    UC_X86_INS_MAXSD,</span><br><span class="line">    UC_X86_INS_MAXSS,</span><br><span class="line">    UC_X86_INS_MFENCE,</span><br><span class="line">    UC_X86_INS_MINPD,</span><br><span class="line">    UC_X86_INS_MINPS,</span><br><span class="line">    UC_X86_INS_MINSD,</span><br><span class="line">    UC_X86_INS_MINSS,</span><br><span class="line">    UC_X86_INS_CVTPD2PI,</span><br><span class="line">    UC_X86_INS_CVTPI2PD,</span><br><span class="line">    UC_X86_INS_CVTPI2PS,</span><br><span class="line">    UC_X86_INS_CVTPS2PI,</span><br><span class="line">    UC_X86_INS_CVTTPD2PI,</span><br><span class="line">    UC_X86_INS_CVTTPS2PI,</span><br><span class="line">    UC_X86_INS_EMMS,</span><br><span class="line">    UC_X86_INS_MASKMOVQ,</span><br><span class="line">    UC_X86_INS_MOVD,</span><br><span class="line">    UC_X86_INS_MOVDQ2Q,</span><br><span class="line">    UC_X86_INS_MOVNTQ,</span><br><span class="line">    UC_X86_INS_MOVQ2DQ,</span><br><span class="line">    UC_X86_INS_MOVQ,</span><br><span class="line">    UC_X86_INS_PABSB,</span><br><span class="line">    UC_X86_INS_PABSD,</span><br><span class="line">    UC_X86_INS_PABSW,</span><br><span class="line">    UC_X86_INS_PACKSSDW,</span><br><span class="line">    UC_X86_INS_PACKSSWB,</span><br><span class="line">    UC_X86_INS_PACKUSWB,</span><br><span class="line">    UC_X86_INS_PADDB,</span><br><span class="line">    UC_X86_INS_PADDD,</span><br><span class="line">    UC_X86_INS_PADDQ,</span><br><span class="line">    UC_X86_INS_PADDSB,</span><br><span class="line">    UC_X86_INS_PADDSW,</span><br><span class="line">    UC_X86_INS_PADDUSB,</span><br><span class="line">    UC_X86_INS_PADDUSW,</span><br><span class="line">    UC_X86_INS_PADDW,</span><br><span class="line">    UC_X86_INS_PALIGNR,</span><br><span class="line">    UC_X86_INS_PANDN,</span><br><span class="line">    UC_X86_INS_PAND,</span><br><span class="line">    UC_X86_INS_PAVGB,</span><br><span class="line">    UC_X86_INS_PAVGW,</span><br><span class="line">    UC_X86_INS_PCMPEQB,</span><br><span class="line">    UC_X86_INS_PCMPEQD,</span><br><span class="line">    UC_X86_INS_PCMPEQW,</span><br><span class="line">    UC_X86_INS_PCMPGTB,</span><br><span class="line">    UC_X86_INS_PCMPGTD,</span><br><span class="line">    UC_X86_INS_PCMPGTW,</span><br><span class="line">    UC_X86_INS_PEXTRW,</span><br><span class="line">    UC_X86_INS_PHADDSW,</span><br><span class="line">    UC_X86_INS_PHADDW,</span><br><span class="line">    UC_X86_INS_PHADDD,</span><br><span class="line">    UC_X86_INS_PHSUBD,</span><br><span class="line">    UC_X86_INS_PHSUBSW,</span><br><span class="line">    UC_X86_INS_PHSUBW,</span><br><span class="line">    UC_X86_INS_PINSRW,</span><br><span class="line">    UC_X86_INS_PMADDUBSW,</span><br><span class="line">    UC_X86_INS_PMADDWD,</span><br><span class="line">    UC_X86_INS_PMAXSW,</span><br><span class="line">    UC_X86_INS_PMAXUB,</span><br><span class="line">    UC_X86_INS_PMINSW,</span><br><span class="line">    UC_X86_INS_PMINUB,</span><br><span class="line">    UC_X86_INS_PMOVMSKB,</span><br><span class="line">    UC_X86_INS_PMULHRSW,</span><br><span class="line">    UC_X86_INS_PMULHUW,</span><br><span class="line">    UC_X86_INS_PMULHW,</span><br><span class="line">    UC_X86_INS_PMULLW,</span><br><span class="line">    UC_X86_INS_PMULUDQ,</span><br><span class="line">    UC_X86_INS_POR,</span><br><span class="line">    UC_X86_INS_PSADBW,</span><br><span class="line">    UC_X86_INS_PSHUFB,</span><br><span class="line">    UC_X86_INS_PSHUFW,</span><br><span class="line">    UC_X86_INS_PSIGNB,</span><br><span class="line">    UC_X86_INS_PSIGND,</span><br><span class="line">    UC_X86_INS_PSIGNW,</span><br><span class="line">    UC_X86_INS_PSLLD,</span><br><span class="line">    UC_X86_INS_PSLLQ,</span><br><span class="line">    UC_X86_INS_PSLLW,</span><br><span class="line">    UC_X86_INS_PSRAD,</span><br><span class="line">    UC_X86_INS_PSRAW,</span><br><span class="line">    UC_X86_INS_PSRLD,</span><br><span class="line">    UC_X86_INS_PSRLQ,</span><br><span class="line">    UC_X86_INS_PSRLW,</span><br><span class="line">    UC_X86_INS_PSUBB,</span><br><span class="line">    UC_X86_INS_PSUBD,</span><br><span class="line">    UC_X86_INS_PSUBQ,</span><br><span class="line">    UC_X86_INS_PSUBSB,</span><br><span class="line">    UC_X86_INS_PSUBSW,</span><br><span class="line">    UC_X86_INS_PSUBUSB,</span><br><span class="line">    UC_X86_INS_PSUBUSW,</span><br><span class="line">    UC_X86_INS_PSUBW,</span><br><span class="line">    UC_X86_INS_PUNPCKHBW,</span><br><span class="line">    UC_X86_INS_PUNPCKHDQ,</span><br><span class="line">    UC_X86_INS_PUNPCKHWD,</span><br><span class="line">    UC_X86_INS_PUNPCKLBW,</span><br><span class="line">    UC_X86_INS_PUNPCKLDQ,</span><br><span class="line">    UC_X86_INS_PUNPCKLWD,</span><br><span class="line">    UC_X86_INS_PXOR,</span><br><span class="line">    UC_X86_INS_MONITOR,</span><br><span class="line">    UC_X86_INS_MONTMUL,</span><br><span class="line">    UC_X86_INS_MOV,</span><br><span class="line">    UC_X86_INS_MOVABS,</span><br><span class="line">    UC_X86_INS_MOVBE,</span><br><span class="line">    UC_X86_INS_MOVDDUP,</span><br><span class="line">    UC_X86_INS_MOVDQA,</span><br><span class="line">    UC_X86_INS_MOVDQU,</span><br><span class="line">    UC_X86_INS_MOVHLPS,</span><br><span class="line">    UC_X86_INS_MOVHPD,</span><br><span class="line">    UC_X86_INS_MOVHPS,</span><br><span class="line">    UC_X86_INS_MOVLHPS,</span><br><span class="line">    UC_X86_INS_MOVLPD,</span><br><span class="line">    UC_X86_INS_MOVLPS,</span><br><span class="line">    UC_X86_INS_MOVMSKPD,</span><br><span class="line">    UC_X86_INS_MOVMSKPS,</span><br><span class="line">    UC_X86_INS_MOVNTDQA,</span><br><span class="line">    UC_X86_INS_MOVNTDQ,</span><br><span class="line">    UC_X86_INS_MOVNTI,</span><br><span class="line">    UC_X86_INS_MOVNTPD,</span><br><span class="line">    UC_X86_INS_MOVNTPS,</span><br><span class="line">    UC_X86_INS_MOVNTSD,</span><br><span class="line">    UC_X86_INS_MOVNTSS,</span><br><span class="line">    UC_X86_INS_MOVSB,</span><br><span class="line">    UC_X86_INS_MOVSD,</span><br><span class="line">    UC_X86_INS_MOVSHDUP,</span><br><span class="line">    UC_X86_INS_MOVSLDUP,</span><br><span class="line">    UC_X86_INS_MOVSQ,</span><br><span class="line">    UC_X86_INS_MOVSS,</span><br><span class="line">    UC_X86_INS_MOVSW,</span><br><span class="line">    UC_X86_INS_MOVSX,</span><br><span class="line">    UC_X86_INS_MOVSXD,</span><br><span class="line">    UC_X86_INS_MOVUPD,</span><br><span class="line">    UC_X86_INS_MOVUPS,</span><br><span class="line">    UC_X86_INS_MOVZX,</span><br><span class="line">    UC_X86_INS_MPSADBW,</span><br><span class="line">    UC_X86_INS_MUL,</span><br><span class="line">    UC_X86_INS_MULPD,</span><br><span class="line">    UC_X86_INS_MULPS,</span><br><span class="line">    UC_X86_INS_MULSD,</span><br><span class="line">    UC_X86_INS_MULSS,</span><br><span class="line">    UC_X86_INS_MULX,</span><br><span class="line">    UC_X86_INS_FMUL,</span><br><span class="line">    UC_X86_INS_FIMUL,</span><br><span class="line">    UC_X86_INS_FMULP,</span><br><span class="line">    UC_X86_INS_MWAIT,</span><br><span class="line">    UC_X86_INS_NEG,</span><br><span class="line">    UC_X86_INS_NOP,</span><br><span class="line">    UC_X86_INS_NOT,</span><br><span class="line">    UC_X86_INS_OUT,</span><br><span class="line">    UC_X86_INS_OUTSB,</span><br><span class="line">    UC_X86_INS_OUTSD,</span><br><span class="line">    UC_X86_INS_OUTSW,</span><br><span class="line">    UC_X86_INS_PACKUSDW,</span><br><span class="line">    UC_X86_INS_PAUSE,</span><br><span class="line">    UC_X86_INS_PAVGUSB,</span><br><span class="line">    UC_X86_INS_PBLENDVB,</span><br><span class="line">    UC_X86_INS_PBLENDW,</span><br><span class="line">    UC_X86_INS_PCLMULQDQ,</span><br><span class="line">    UC_X86_INS_PCMPEQQ,</span><br><span class="line">    UC_X86_INS_PCMPESTRI,</span><br><span class="line">    UC_X86_INS_PCMPESTRM,</span><br><span class="line">    UC_X86_INS_PCMPGTQ,</span><br><span class="line">    UC_X86_INS_PCMPISTRI,</span><br><span class="line">    UC_X86_INS_PCMPISTRM,</span><br><span class="line">    UC_X86_INS_PCOMMIT,</span><br><span class="line">    UC_X86_INS_PDEP,</span><br><span class="line">    UC_X86_INS_PEXT,</span><br><span class="line">    UC_X86_INS_PEXTRB,</span><br><span class="line">    UC_X86_INS_PEXTRD,</span><br><span class="line">    UC_X86_INS_PEXTRQ,</span><br><span class="line">    UC_X86_INS_PF2ID,</span><br><span class="line">    UC_X86_INS_PF2IW,</span><br><span class="line">    UC_X86_INS_PFACC,</span><br><span class="line">    UC_X86_INS_PFADD,</span><br><span class="line">    UC_X86_INS_PFCMPEQ,</span><br><span class="line">    UC_X86_INS_PFCMPGE,</span><br><span class="line">    UC_X86_INS_PFCMPGT,</span><br><span class="line">    UC_X86_INS_PFMAX,</span><br><span class="line">    UC_X86_INS_PFMIN,</span><br><span class="line">    UC_X86_INS_PFMUL,</span><br><span class="line">    UC_X86_INS_PFNACC,</span><br><span class="line">    UC_X86_INS_PFPNACC,</span><br><span class="line">    UC_X86_INS_PFRCPIT1,</span><br><span class="line">    UC_X86_INS_PFRCPIT2,</span><br><span class="line">    UC_X86_INS_PFRCP,</span><br><span class="line">    UC_X86_INS_PFRSQIT1,</span><br><span class="line">    UC_X86_INS_PFRSQRT,</span><br><span class="line">    UC_X86_INS_PFSUBR,</span><br><span class="line">    UC_X86_INS_PFSUB,</span><br><span class="line">    UC_X86_INS_PHMINPOSUW,</span><br><span class="line">    UC_X86_INS_PI2FD,</span><br><span class="line">    UC_X86_INS_PI2FW,</span><br><span class="line">    UC_X86_INS_PINSRB,</span><br><span class="line">    UC_X86_INS_PINSRD,</span><br><span class="line">    UC_X86_INS_PINSRQ,</span><br><span class="line">    UC_X86_INS_PMAXSB,</span><br><span class="line">    UC_X86_INS_PMAXSD,</span><br><span class="line">    UC_X86_INS_PMAXUD,</span><br><span class="line">    UC_X86_INS_PMAXUW,</span><br><span class="line">    UC_X86_INS_PMINSB,</span><br><span class="line">    UC_X86_INS_PMINSD,</span><br><span class="line">    UC_X86_INS_PMINUD,</span><br><span class="line">    UC_X86_INS_PMINUW,</span><br><span class="line">    UC_X86_INS_PMOVSXBD,</span><br><span class="line">    UC_X86_INS_PMOVSXBQ,</span><br><span class="line">    UC_X86_INS_PMOVSXBW,</span><br><span class="line">    UC_X86_INS_PMOVSXDQ,</span><br><span class="line">    UC_X86_INS_PMOVSXWD,</span><br><span class="line">    UC_X86_INS_PMOVSXWQ,</span><br><span class="line">    UC_X86_INS_PMOVZXBD,</span><br><span class="line">    UC_X86_INS_PMOVZXBQ,</span><br><span class="line">    UC_X86_INS_PMOVZXBW,</span><br><span class="line">    UC_X86_INS_PMOVZXDQ,</span><br><span class="line">    UC_X86_INS_PMOVZXWD,</span><br><span class="line">    UC_X86_INS_PMOVZXWQ,</span><br><span class="line">    UC_X86_INS_PMULDQ,</span><br><span class="line">    UC_X86_INS_PMULHRW,</span><br><span class="line">    UC_X86_INS_PMULLD,</span><br><span class="line">    UC_X86_INS_POP,</span><br><span class="line">    UC_X86_INS_POPAW,</span><br><span class="line">    UC_X86_INS_POPAL,</span><br><span class="line">    UC_X86_INS_POPCNT,</span><br><span class="line">    UC_X86_INS_POPF,</span><br><span class="line">    UC_X86_INS_POPFD,</span><br><span class="line">    UC_X86_INS_POPFQ,</span><br><span class="line">    UC_X86_INS_PREFETCH,</span><br><span class="line">    UC_X86_INS_PREFETCHNTA,</span><br><span class="line">    UC_X86_INS_PREFETCHT0,</span><br><span class="line">    UC_X86_INS_PREFETCHT1,</span><br><span class="line">    UC_X86_INS_PREFETCHT2,</span><br><span class="line">    UC_X86_INS_PREFETCHW,</span><br><span class="line">    UC_X86_INS_PSHUFD,</span><br><span class="line">    UC_X86_INS_PSHUFHW,</span><br><span class="line">    UC_X86_INS_PSHUFLW,</span><br><span class="line">    UC_X86_INS_PSLLDQ,</span><br><span class="line">    UC_X86_INS_PSRLDQ,</span><br><span class="line">    UC_X86_INS_PSWAPD,</span><br><span class="line">    UC_X86_INS_PTEST,</span><br><span class="line">    UC_X86_INS_PUNPCKHQDQ,</span><br><span class="line">    UC_X86_INS_PUNPCKLQDQ,</span><br><span class="line">    UC_X86_INS_PUSH,</span><br><span class="line">    UC_X86_INS_PUSHAW,</span><br><span class="line">    UC_X86_INS_PUSHAL,</span><br><span class="line">    UC_X86_INS_PUSHF,</span><br><span class="line">    UC_X86_INS_PUSHFD,</span><br><span class="line">    UC_X86_INS_PUSHFQ,</span><br><span class="line">    UC_X86_INS_RCL,</span><br><span class="line">    UC_X86_INS_RCPPS,</span><br><span class="line">    UC_X86_INS_RCPSS,</span><br><span class="line">    UC_X86_INS_RCR,</span><br><span class="line">    UC_X86_INS_RDFSBASE,</span><br><span class="line">    UC_X86_INS_RDGSBASE,</span><br><span class="line">    UC_X86_INS_RDMSR,</span><br><span class="line">    UC_X86_INS_RDPMC,</span><br><span class="line">    UC_X86_INS_RDRAND,</span><br><span class="line">    UC_X86_INS_RDSEED,</span><br><span class="line">    UC_X86_INS_RDTSC,</span><br><span class="line">    UC_X86_INS_RDTSCP,</span><br><span class="line">    UC_X86_INS_ROL,</span><br><span class="line">    UC_X86_INS_ROR,</span><br><span class="line">    UC_X86_INS_RORX,</span><br><span class="line">    UC_X86_INS_ROUNDPD,</span><br><span class="line">    UC_X86_INS_ROUNDPS,</span><br><span class="line">    UC_X86_INS_ROUNDSD,</span><br><span class="line">    UC_X86_INS_ROUNDSS,</span><br><span class="line">    UC_X86_INS_RSM,</span><br><span class="line">    UC_X86_INS_RSQRTPS,</span><br><span class="line">    UC_X86_INS_RSQRTSS,</span><br><span class="line">    UC_X86_INS_SAHF,</span><br><span class="line">    UC_X86_INS_SAL,</span><br><span class="line">    UC_X86_INS_SALC,</span><br><span class="line">    UC_X86_INS_SAR,</span><br><span class="line">    UC_X86_INS_SARX,</span><br><span class="line">    UC_X86_INS_SBB,</span><br><span class="line">    UC_X86_INS_SCASB,</span><br><span class="line">    UC_X86_INS_SCASD,</span><br><span class="line">    UC_X86_INS_SCASQ,</span><br><span class="line">    UC_X86_INS_SCASW,</span><br><span class="line">    UC_X86_INS_SETAE,</span><br><span class="line">    UC_X86_INS_SETA,</span><br><span class="line">    UC_X86_INS_SETBE,</span><br><span class="line">    UC_X86_INS_SETB,</span><br><span class="line">    UC_X86_INS_SETE,</span><br><span class="line">    UC_X86_INS_SETGE,</span><br><span class="line">    UC_X86_INS_SETG,</span><br><span class="line">    UC_X86_INS_SETLE,</span><br><span class="line">    UC_X86_INS_SETL,</span><br><span class="line">    UC_X86_INS_SETNE,</span><br><span class="line">    UC_X86_INS_SETNO,</span><br><span class="line">    UC_X86_INS_SETNP,</span><br><span class="line">    UC_X86_INS_SETNS,</span><br><span class="line">    UC_X86_INS_SETO,</span><br><span class="line">    UC_X86_INS_SETP,</span><br><span class="line">    UC_X86_INS_SETS,</span><br><span class="line">    UC_X86_INS_SFENCE,</span><br><span class="line">    UC_X86_INS_SGDT,</span><br><span class="line">    UC_X86_INS_SHA1MSG1,</span><br><span class="line">    UC_X86_INS_SHA1MSG2,</span><br><span class="line">    UC_X86_INS_SHA1NEXTE,</span><br><span class="line">    UC_X86_INS_SHA1RNDS4,</span><br><span class="line">    UC_X86_INS_SHA256MSG1,</span><br><span class="line">    UC_X86_INS_SHA256MSG2,</span><br><span class="line">    UC_X86_INS_SHA256RNDS2,</span><br><span class="line">    UC_X86_INS_SHL,</span><br><span class="line">    UC_X86_INS_SHLD,</span><br><span class="line">    UC_X86_INS_SHLX,</span><br><span class="line">    UC_X86_INS_SHR,</span><br><span class="line">    UC_X86_INS_SHRD,</span><br><span class="line">    UC_X86_INS_SHRX,</span><br><span class="line">    UC_X86_INS_SHUFPD,</span><br><span class="line">    UC_X86_INS_SHUFPS,</span><br><span class="line">    UC_X86_INS_SIDT,</span><br><span class="line">    UC_X86_INS_FSIN,</span><br><span class="line">    UC_X86_INS_SKINIT,</span><br><span class="line">    UC_X86_INS_SLDT,</span><br><span class="line">    UC_X86_INS_SMSW,</span><br><span class="line">    UC_X86_INS_SQRTPD,</span><br><span class="line">    UC_X86_INS_SQRTPS,</span><br><span class="line">    UC_X86_INS_SQRTSD,</span><br><span class="line">    UC_X86_INS_SQRTSS,</span><br><span class="line">    UC_X86_INS_FSQRT,</span><br><span class="line">    UC_X86_INS_STAC,</span><br><span class="line">    UC_X86_INS_STC,</span><br><span class="line">    UC_X86_INS_STD,</span><br><span class="line">    UC_X86_INS_STGI,</span><br><span class="line">    UC_X86_INS_STI,</span><br><span class="line">    UC_X86_INS_STMXCSR,</span><br><span class="line">    UC_X86_INS_STOSB,</span><br><span class="line">    UC_X86_INS_STOSD,</span><br><span class="line">    UC_X86_INS_STOSQ,</span><br><span class="line">    UC_X86_INS_STOSW,</span><br><span class="line">    UC_X86_INS_STR,</span><br><span class="line">    UC_X86_INS_FST,</span><br><span class="line">    UC_X86_INS_FSTP,</span><br><span class="line">    UC_X86_INS_FSTPNCE,</span><br><span class="line">    UC_X86_INS_FXCH,</span><br><span class="line">    UC_X86_INS_SUBPD,</span><br><span class="line">    UC_X86_INS_SUBPS,</span><br><span class="line">    UC_X86_INS_FSUBR,</span><br><span class="line">    UC_X86_INS_FISUBR,</span><br><span class="line">    UC_X86_INS_FSUBRP,</span><br><span class="line">    UC_X86_INS_SUBSD,</span><br><span class="line">    UC_X86_INS_SUBSS,</span><br><span class="line">    UC_X86_INS_FSUB,</span><br><span class="line">    UC_X86_INS_FISUB,</span><br><span class="line">    UC_X86_INS_FSUBP,</span><br><span class="line">    UC_X86_INS_SWAPGS,</span><br><span class="line">    UC_X86_INS_SYSCALL,</span><br><span class="line">    UC_X86_INS_SYSENTER,</span><br><span class="line">    UC_X86_INS_SYSEXIT,</span><br><span class="line">    UC_X86_INS_SYSRET,</span><br><span class="line">    UC_X86_INS_T1MSKC,</span><br><span class="line">    UC_X86_INS_TEST,</span><br><span class="line">    UC_X86_INS_UD2,</span><br><span class="line">    UC_X86_INS_FTST,</span><br><span class="line">    UC_X86_INS_TZCNT,</span><br><span class="line">    UC_X86_INS_TZMSK,</span><br><span class="line">    UC_X86_INS_FUCOMPI,</span><br><span class="line">    UC_X86_INS_FUCOMI,</span><br><span class="line">    UC_X86_INS_FUCOMPP,</span><br><span class="line">    UC_X86_INS_FUCOMP,</span><br><span class="line">    UC_X86_INS_FUCOM,</span><br><span class="line">    UC_X86_INS_UD2B,</span><br><span class="line">    UC_X86_INS_UNPCKHPD,</span><br><span class="line">    UC_X86_INS_UNPCKHPS,</span><br><span class="line">    UC_X86_INS_UNPCKLPD,</span><br><span class="line">    UC_X86_INS_UNPCKLPS,</span><br><span class="line">    UC_X86_INS_VADDPD,</span><br><span class="line">    UC_X86_INS_VADDPS,</span><br><span class="line">    UC_X86_INS_VADDSD,</span><br><span class="line">    UC_X86_INS_VADDSS,</span><br><span class="line">    UC_X86_INS_VADDSUBPD,</span><br><span class="line">    UC_X86_INS_VADDSUBPS,</span><br><span class="line">    UC_X86_INS_VAESDECLAST,</span><br><span class="line">    UC_X86_INS_VAESDEC,</span><br><span class="line">    UC_X86_INS_VAESENCLAST,</span><br><span class="line">    UC_X86_INS_VAESENC,</span><br><span class="line">    UC_X86_INS_VAESIMC,</span><br><span class="line">    UC_X86_INS_VAESKEYGENASSIST,</span><br><span class="line">    UC_X86_INS_VALIGND,</span><br><span class="line">    UC_X86_INS_VALIGNQ,</span><br><span class="line">    UC_X86_INS_VANDNPD,</span><br><span class="line">    UC_X86_INS_VANDNPS,</span><br><span class="line">    UC_X86_INS_VANDPD,</span><br><span class="line">    UC_X86_INS_VANDPS,</span><br><span class="line">    UC_X86_INS_VBLENDMPD,</span><br><span class="line">    UC_X86_INS_VBLENDMPS,</span><br><span class="line">    UC_X86_INS_VBLENDPD,</span><br><span class="line">    UC_X86_INS_VBLENDPS,</span><br><span class="line">    UC_X86_INS_VBLENDVPD,</span><br><span class="line">    UC_X86_INS_VBLENDVPS,</span><br><span class="line">    UC_X86_INS_VBROADCASTF128,</span><br><span class="line">    UC_X86_INS_VBROADCASTI32X4,</span><br><span class="line">    UC_X86_INS_VBROADCASTI64X4,</span><br><span class="line">    UC_X86_INS_VBROADCASTSD,</span><br><span class="line">    UC_X86_INS_VBROADCASTSS,</span><br><span class="line">    UC_X86_INS_VCMPPD,</span><br><span class="line">    UC_X86_INS_VCMPPS,</span><br><span class="line">    UC_X86_INS_VCMPSD,</span><br><span class="line">    UC_X86_INS_VCMPSS,</span><br><span class="line">    UC_X86_INS_VCOMPRESSPD,</span><br><span class="line">    UC_X86_INS_VCOMPRESSPS,</span><br><span class="line">    UC_X86_INS_VCVTDQ2PD,</span><br><span class="line">    UC_X86_INS_VCVTDQ2PS,</span><br><span class="line">    UC_X86_INS_VCVTPD2DQX,</span><br><span class="line">    UC_X86_INS_VCVTPD2DQ,</span><br><span class="line">    UC_X86_INS_VCVTPD2PSX,</span><br><span class="line">    UC_X86_INS_VCVTPD2PS,</span><br><span class="line">    UC_X86_INS_VCVTPD2UDQ,</span><br><span class="line">    UC_X86_INS_VCVTPH2PS,</span><br><span class="line">    UC_X86_INS_VCVTPS2DQ,</span><br><span class="line">    UC_X86_INS_VCVTPS2PD,</span><br><span class="line">    UC_X86_INS_VCVTPS2PH,</span><br><span class="line">    UC_X86_INS_VCVTPS2UDQ,</span><br><span class="line">    UC_X86_INS_VCVTSD2SI,</span><br><span class="line">    UC_X86_INS_VCVTSD2USI,</span><br><span class="line">    UC_X86_INS_VCVTSS2SI,</span><br><span class="line">    UC_X86_INS_VCVTSS2USI,</span><br><span class="line">    UC_X86_INS_VCVTTPD2DQX,</span><br><span class="line">    UC_X86_INS_VCVTTPD2DQ,</span><br><span class="line">    UC_X86_INS_VCVTTPD2UDQ,</span><br><span class="line">    UC_X86_INS_VCVTTPS2DQ,</span><br><span class="line">    UC_X86_INS_VCVTTPS2UDQ,</span><br><span class="line">    UC_X86_INS_VCVTUDQ2PD,</span><br><span class="line">    UC_X86_INS_VCVTUDQ2PS,</span><br><span class="line">    UC_X86_INS_VDIVPD,</span><br><span class="line">    UC_X86_INS_VDIVPS,</span><br><span class="line">    UC_X86_INS_VDIVSD,</span><br><span class="line">    UC_X86_INS_VDIVSS,</span><br><span class="line">    UC_X86_INS_VDPPD,</span><br><span class="line">    UC_X86_INS_VDPPS,</span><br><span class="line">    UC_X86_INS_VERR,</span><br><span class="line">    UC_X86_INS_VERW,</span><br><span class="line">    UC_X86_INS_VEXP2PD,</span><br><span class="line">    UC_X86_INS_VEXP2PS,</span><br><span class="line">    UC_X86_INS_VEXPANDPD,</span><br><span class="line">    UC_X86_INS_VEXPANDPS,</span><br><span class="line">    UC_X86_INS_VEXTRACTF128,</span><br><span class="line">    UC_X86_INS_VEXTRACTF32X4,</span><br><span class="line">    UC_X86_INS_VEXTRACTF64X4,</span><br><span class="line">    UC_X86_INS_VEXTRACTI128,</span><br><span class="line">    UC_X86_INS_VEXTRACTI32X4,</span><br><span class="line">    UC_X86_INS_VEXTRACTI64X4,</span><br><span class="line">    UC_X86_INS_VEXTRACTPS,</span><br><span class="line">    UC_X86_INS_VFMADD132PD,</span><br><span class="line">    UC_X86_INS_VFMADD132PS,</span><br><span class="line">    UC_X86_INS_VFMADDPD,</span><br><span class="line">    UC_X86_INS_VFMADD213PD,</span><br><span class="line">    UC_X86_INS_VFMADD231PD,</span><br><span class="line">    UC_X86_INS_VFMADDPS,</span><br><span class="line">    UC_X86_INS_VFMADD213PS,</span><br><span class="line">    UC_X86_INS_VFMADD231PS,</span><br><span class="line">    UC_X86_INS_VFMADDSD,</span><br><span class="line">    UC_X86_INS_VFMADD213SD,</span><br><span class="line">    UC_X86_INS_VFMADD132SD,</span><br><span class="line">    UC_X86_INS_VFMADD231SD,</span><br><span class="line">    UC_X86_INS_VFMADDSS,</span><br><span class="line">    UC_X86_INS_VFMADD213SS,</span><br><span class="line">    UC_X86_INS_VFMADD132SS,</span><br><span class="line">    UC_X86_INS_VFMADD231SS,</span><br><span class="line">    UC_X86_INS_VFMADDSUB132PD,</span><br><span class="line">    UC_X86_INS_VFMADDSUB132PS,</span><br><span class="line">    UC_X86_INS_VFMADDSUBPD,</span><br><span class="line">    UC_X86_INS_VFMADDSUB213PD,</span><br><span class="line">    UC_X86_INS_VFMADDSUB231PD,</span><br><span class="line">    UC_X86_INS_VFMADDSUBPS,</span><br><span class="line">    UC_X86_INS_VFMADDSUB213PS,</span><br><span class="line">    UC_X86_INS_VFMADDSUB231PS,</span><br><span class="line">    UC_X86_INS_VFMSUB132PD,</span><br><span class="line">    UC_X86_INS_VFMSUB132PS,</span><br><span class="line">    UC_X86_INS_VFMSUBADD132PD,</span><br><span class="line">    UC_X86_INS_VFMSUBADD132PS,</span><br><span class="line">    UC_X86_INS_VFMSUBADDPD,</span><br><span class="line">    UC_X86_INS_VFMSUBADD213PD,</span><br><span class="line">    UC_X86_INS_VFMSUBADD231PD,</span><br><span class="line">    UC_X86_INS_VFMSUBADDPS,</span><br><span class="line">    UC_X86_INS_VFMSUBADD213PS,</span><br><span class="line">    UC_X86_INS_VFMSUBADD231PS,</span><br><span class="line">    UC_X86_INS_VFMSUBPD,</span><br><span class="line">    UC_X86_INS_VFMSUB213PD,</span><br><span class="line">    UC_X86_INS_VFMSUB231PD,</span><br><span class="line">    UC_X86_INS_VFMSUBPS,</span><br><span class="line">    UC_X86_INS_VFMSUB213PS,</span><br><span class="line">    UC_X86_INS_VFMSUB231PS,</span><br><span class="line">    UC_X86_INS_VFMSUBSD,</span><br><span class="line">    UC_X86_INS_VFMSUB213SD,</span><br><span class="line">    UC_X86_INS_VFMSUB132SD,</span><br><span class="line">    UC_X86_INS_VFMSUB231SD,</span><br><span class="line">    UC_X86_INS_VFMSUBSS,</span><br><span class="line">    UC_X86_INS_VFMSUB213SS,</span><br><span class="line">    UC_X86_INS_VFMSUB132SS,</span><br><span class="line">    UC_X86_INS_VFMSUB231SS,</span><br><span class="line">    UC_X86_INS_VFNMADD132PD,</span><br><span class="line">    UC_X86_INS_VFNMADD132PS,</span><br><span class="line">    UC_X86_INS_VFNMADDPD,</span><br><span class="line">    UC_X86_INS_VFNMADD213PD,</span><br><span class="line">    UC_X86_INS_VFNMADD231PD,</span><br><span class="line">    UC_X86_INS_VFNMADDPS,</span><br><span class="line">    UC_X86_INS_VFNMADD213PS,</span><br><span class="line">    UC_X86_INS_VFNMADD231PS,</span><br><span class="line">    UC_X86_INS_VFNMADDSD,</span><br><span class="line">    UC_X86_INS_VFNMADD213SD,</span><br><span class="line">    UC_X86_INS_VFNMADD132SD,</span><br><span class="line">    UC_X86_INS_VFNMADD231SD,</span><br><span class="line">    UC_X86_INS_VFNMADDSS,</span><br><span class="line">    UC_X86_INS_VFNMADD213SS,</span><br><span class="line">    UC_X86_INS_VFNMADD132SS,</span><br><span class="line">    UC_X86_INS_VFNMADD231SS,</span><br><span class="line">    UC_X86_INS_VFNMSUB132PD,</span><br><span class="line">    UC_X86_INS_VFNMSUB132PS,</span><br><span class="line">    UC_X86_INS_VFNMSUBPD,</span><br><span class="line">    UC_X86_INS_VFNMSUB213PD,</span><br><span class="line">    UC_X86_INS_VFNMSUB231PD,</span><br><span class="line">    UC_X86_INS_VFNMSUBPS,</span><br><span class="line">    UC_X86_INS_VFNMSUB213PS,</span><br><span class="line">    UC_X86_INS_VFNMSUB231PS,</span><br><span class="line">    UC_X86_INS_VFNMSUBSD,</span><br><span class="line">    UC_X86_INS_VFNMSUB213SD,</span><br><span class="line">    UC_X86_INS_VFNMSUB132SD,</span><br><span class="line">    UC_X86_INS_VFNMSUB231SD,</span><br><span class="line">    UC_X86_INS_VFNMSUBSS,</span><br><span class="line">    UC_X86_INS_VFNMSUB213SS,</span><br><span class="line">    UC_X86_INS_VFNMSUB132SS,</span><br><span class="line">    UC_X86_INS_VFNMSUB231SS,</span><br><span class="line">    UC_X86_INS_VFRCZPD,</span><br><span class="line">    UC_X86_INS_VFRCZPS,</span><br><span class="line">    UC_X86_INS_VFRCZSD,</span><br><span class="line">    UC_X86_INS_VFRCZSS,</span><br><span class="line">    UC_X86_INS_VORPD,</span><br><span class="line">    UC_X86_INS_VORPS,</span><br><span class="line">    UC_X86_INS_VXORPD,</span><br><span class="line">    UC_X86_INS_VXORPS,</span><br><span class="line">    UC_X86_INS_VGATHERDPD,</span><br><span class="line">    UC_X86_INS_VGATHERDPS,</span><br><span class="line">    UC_X86_INS_VGATHERPF0DPD,</span><br><span class="line">    UC_X86_INS_VGATHERPF0DPS,</span><br><span class="line">    UC_X86_INS_VGATHERPF0QPD,</span><br><span class="line">    UC_X86_INS_VGATHERPF0QPS,</span><br><span class="line">    UC_X86_INS_VGATHERPF1DPD,</span><br><span class="line">    UC_X86_INS_VGATHERPF1DPS,</span><br><span class="line">    UC_X86_INS_VGATHERPF1QPD,</span><br><span class="line">    UC_X86_INS_VGATHERPF1QPS,</span><br><span class="line">    UC_X86_INS_VGATHERQPD,</span><br><span class="line">    UC_X86_INS_VGATHERQPS,</span><br><span class="line">    UC_X86_INS_VHADDPD,</span><br><span class="line">    UC_X86_INS_VHADDPS,</span><br><span class="line">    UC_X86_INS_VHSUBPD,</span><br><span class="line">    UC_X86_INS_VHSUBPS,</span><br><span class="line">    UC_X86_INS_VINSERTF128,</span><br><span class="line">    UC_X86_INS_VINSERTF32X4,</span><br><span class="line">    UC_X86_INS_VINSERTF32X8,</span><br><span class="line">    UC_X86_INS_VINSERTF64X2,</span><br><span class="line">    UC_X86_INS_VINSERTF64X4,</span><br><span class="line">    UC_X86_INS_VINSERTI128,</span><br><span class="line">    UC_X86_INS_VINSERTI32X4,</span><br><span class="line">    UC_X86_INS_VINSERTI32X8,</span><br><span class="line">    UC_X86_INS_VINSERTI64X2,</span><br><span class="line">    UC_X86_INS_VINSERTI64X4,</span><br><span class="line">    UC_X86_INS_VINSERTPS,</span><br><span class="line">    UC_X86_INS_VLDDQU,</span><br><span class="line">    UC_X86_INS_VLDMXCSR,</span><br><span class="line">    UC_X86_INS_VMASKMOVDQU,</span><br><span class="line">    UC_X86_INS_VMASKMOVPD,</span><br><span class="line">    UC_X86_INS_VMASKMOVPS,</span><br><span class="line">    UC_X86_INS_VMAXPD,</span><br><span class="line">    UC_X86_INS_VMAXPS,</span><br><span class="line">    UC_X86_INS_VMAXSD,</span><br><span class="line">    UC_X86_INS_VMAXSS,</span><br><span class="line">    UC_X86_INS_VMCALL,</span><br><span class="line">    UC_X86_INS_VMCLEAR,</span><br><span class="line">    UC_X86_INS_VMFUNC,</span><br><span class="line">    UC_X86_INS_VMINPD,</span><br><span class="line">    UC_X86_INS_VMINPS,</span><br><span class="line">    UC_X86_INS_VMINSD,</span><br><span class="line">    UC_X86_INS_VMINSS,</span><br><span class="line">    UC_X86_INS_VMLAUNCH,</span><br><span class="line">    UC_X86_INS_VMLOAD,</span><br><span class="line">    UC_X86_INS_VMMCALL,</span><br><span class="line">    UC_X86_INS_VMOVQ,</span><br><span class="line">    UC_X86_INS_VMOVDDUP,</span><br><span class="line">    UC_X86_INS_VMOVD,</span><br><span class="line">    UC_X86_INS_VMOVDQA32,</span><br><span class="line">    UC_X86_INS_VMOVDQA64,</span><br><span class="line">    UC_X86_INS_VMOVDQA,</span><br><span class="line">    UC_X86_INS_VMOVDQU16,</span><br><span class="line">    UC_X86_INS_VMOVDQU32,</span><br><span class="line">    UC_X86_INS_VMOVDQU64,</span><br><span class="line">    UC_X86_INS_VMOVDQU8,</span><br><span class="line">    UC_X86_INS_VMOVDQU,</span><br><span class="line">    UC_X86_INS_VMOVHLPS,</span><br><span class="line">    UC_X86_INS_VMOVHPD,</span><br><span class="line">    UC_X86_INS_VMOVHPS,</span><br><span class="line">    UC_X86_INS_VMOVLHPS,</span><br><span class="line">    UC_X86_INS_VMOVLPD,</span><br><span class="line">    UC_X86_INS_VMOVLPS,</span><br><span class="line">    UC_X86_INS_VMOVMSKPD,</span><br><span class="line">    UC_X86_INS_VMOVMSKPS,</span><br><span class="line">    UC_X86_INS_VMOVNTDQA,</span><br><span class="line">    UC_X86_INS_VMOVNTDQ,</span><br><span class="line">    UC_X86_INS_VMOVNTPD,</span><br><span class="line">    UC_X86_INS_VMOVNTPS,</span><br><span class="line">    UC_X86_INS_VMOVSD,</span><br><span class="line">    UC_X86_INS_VMOVSHDUP,</span><br><span class="line">    UC_X86_INS_VMOVSLDUP,</span><br><span class="line">    UC_X86_INS_VMOVSS,</span><br><span class="line">    UC_X86_INS_VMOVUPD,</span><br><span class="line">    UC_X86_INS_VMOVUPS,</span><br><span class="line">    UC_X86_INS_VMPSADBW,</span><br><span class="line">    UC_X86_INS_VMPTRLD,</span><br><span class="line">    UC_X86_INS_VMPTRST,</span><br><span class="line">    UC_X86_INS_VMREAD,</span><br><span class="line">    UC_X86_INS_VMRESUME,</span><br><span class="line">    UC_X86_INS_VMRUN,</span><br><span class="line">    UC_X86_INS_VMSAVE,</span><br><span class="line">    UC_X86_INS_VMULPD,</span><br><span class="line">    UC_X86_INS_VMULPS,</span><br><span class="line">    UC_X86_INS_VMULSD,</span><br><span class="line">    UC_X86_INS_VMULSS,</span><br><span class="line">    UC_X86_INS_VMWRITE,</span><br><span class="line">    UC_X86_INS_VMXOFF,</span><br><span class="line">    UC_X86_INS_VMXON,</span><br><span class="line">    UC_X86_INS_VPABSB,</span><br><span class="line">    UC_X86_INS_VPABSD,</span><br><span class="line">    UC_X86_INS_VPABSQ,</span><br><span class="line">    UC_X86_INS_VPABSW,</span><br><span class="line">    UC_X86_INS_VPACKSSDW,</span><br><span class="line">    UC_X86_INS_VPACKSSWB,</span><br><span class="line">    UC_X86_INS_VPACKUSDW,</span><br><span class="line">    UC_X86_INS_VPACKUSWB,</span><br><span class="line">    UC_X86_INS_VPADDB,</span><br><span class="line">    UC_X86_INS_VPADDD,</span><br><span class="line">    UC_X86_INS_VPADDQ,</span><br><span class="line">    UC_X86_INS_VPADDSB,</span><br><span class="line">    UC_X86_INS_VPADDSW,</span><br><span class="line">    UC_X86_INS_VPADDUSB,</span><br><span class="line">    UC_X86_INS_VPADDUSW,</span><br><span class="line">    UC_X86_INS_VPADDW,</span><br><span class="line">    UC_X86_INS_VPALIGNR,</span><br><span class="line">    UC_X86_INS_VPANDD,</span><br><span class="line">    UC_X86_INS_VPANDND,</span><br><span class="line">    UC_X86_INS_VPANDNQ,</span><br><span class="line">    UC_X86_INS_VPANDN,</span><br><span class="line">    UC_X86_INS_VPANDQ,</span><br><span class="line">    UC_X86_INS_VPAND,</span><br><span class="line">    UC_X86_INS_VPAVGB,</span><br><span class="line">    UC_X86_INS_VPAVGW,</span><br><span class="line">    UC_X86_INS_VPBLENDD,</span><br><span class="line">    UC_X86_INS_VPBLENDMB,</span><br><span class="line">    UC_X86_INS_VPBLENDMD,</span><br><span class="line">    UC_X86_INS_VPBLENDMQ,</span><br><span class="line">    UC_X86_INS_VPBLENDMW,</span><br><span class="line">    UC_X86_INS_VPBLENDVB,</span><br><span class="line">    UC_X86_INS_VPBLENDW,</span><br><span class="line">    UC_X86_INS_VPBROADCASTB,</span><br><span class="line">    UC_X86_INS_VPBROADCASTD,</span><br><span class="line">    UC_X86_INS_VPBROADCASTMB2Q,</span><br><span class="line">    UC_X86_INS_VPBROADCASTMW2D,</span><br><span class="line">    UC_X86_INS_VPBROADCASTQ,</span><br><span class="line">    UC_X86_INS_VPBROADCASTW,</span><br><span class="line">    UC_X86_INS_VPCLMULQDQ,</span><br><span class="line">    UC_X86_INS_VPCMOV,</span><br><span class="line">    UC_X86_INS_VPCMPB,</span><br><span class="line">    UC_X86_INS_VPCMPD,</span><br><span class="line">    UC_X86_INS_VPCMPEQB,</span><br><span class="line">    UC_X86_INS_VPCMPEQD,</span><br><span class="line">    UC_X86_INS_VPCMPEQQ,</span><br><span class="line">    UC_X86_INS_VPCMPEQW,</span><br><span class="line">    UC_X86_INS_VPCMPESTRI,</span><br><span class="line">    UC_X86_INS_VPCMPESTRM,</span><br><span class="line">    UC_X86_INS_VPCMPGTB,</span><br><span class="line">    UC_X86_INS_VPCMPGTD,</span><br><span class="line">    UC_X86_INS_VPCMPGTQ,</span><br><span class="line">    UC_X86_INS_VPCMPGTW,</span><br><span class="line">    UC_X86_INS_VPCMPISTRI,</span><br><span class="line">    UC_X86_INS_VPCMPISTRM,</span><br><span class="line">    UC_X86_INS_VPCMPQ,</span><br><span class="line">    UC_X86_INS_VPCMPUB,</span><br><span class="line">    UC_X86_INS_VPCMPUD,</span><br><span class="line">    UC_X86_INS_VPCMPUQ,</span><br><span class="line">    UC_X86_INS_VPCMPUW,</span><br><span class="line">    UC_X86_INS_VPCMPW,</span><br><span class="line">    UC_X86_INS_VPCOMB,</span><br><span class="line">    UC_X86_INS_VPCOMD,</span><br><span class="line">    UC_X86_INS_VPCOMPRESSD,</span><br><span class="line">    UC_X86_INS_VPCOMPRESSQ,</span><br><span class="line">    UC_X86_INS_VPCOMQ,</span><br><span class="line">    UC_X86_INS_VPCOMUB,</span><br><span class="line">    UC_X86_INS_VPCOMUD,</span><br><span class="line">    UC_X86_INS_VPCOMUQ,</span><br><span class="line">    UC_X86_INS_VPCOMUW,</span><br><span class="line">    UC_X86_INS_VPCOMW,</span><br><span class="line">    UC_X86_INS_VPCONFLICTD,</span><br><span class="line">    UC_X86_INS_VPCONFLICTQ,</span><br><span class="line">    UC_X86_INS_VPERM2F128,</span><br><span class="line">    UC_X86_INS_VPERM2I128,</span><br><span class="line">    UC_X86_INS_VPERMD,</span><br><span class="line">    UC_X86_INS_VPERMI2D,</span><br><span class="line">    UC_X86_INS_VPERMI2PD,</span><br><span class="line">    UC_X86_INS_VPERMI2PS,</span><br><span class="line">    UC_X86_INS_VPERMI2Q,</span><br><span class="line">    UC_X86_INS_VPERMIL2PD,</span><br><span class="line">    UC_X86_INS_VPERMIL2PS,</span><br><span class="line">    UC_X86_INS_VPERMILPD,</span><br><span class="line">    UC_X86_INS_VPERMILPS,</span><br><span class="line">    UC_X86_INS_VPERMPD,</span><br><span class="line">    UC_X86_INS_VPERMPS,</span><br><span class="line">    UC_X86_INS_VPERMQ,</span><br><span class="line">    UC_X86_INS_VPERMT2D,</span><br><span class="line">    UC_X86_INS_VPERMT2PD,</span><br><span class="line">    UC_X86_INS_VPERMT2PS,</span><br><span class="line">    UC_X86_INS_VPERMT2Q,</span><br><span class="line">    UC_X86_INS_VPEXPANDD,</span><br><span class="line">    UC_X86_INS_VPEXPANDQ,</span><br><span class="line">    UC_X86_INS_VPEXTRB,</span><br><span class="line">    UC_X86_INS_VPEXTRD,</span><br><span class="line">    UC_X86_INS_VPEXTRQ,</span><br><span class="line">    UC_X86_INS_VPEXTRW,</span><br><span class="line">    UC_X86_INS_VPGATHERDD,</span><br><span class="line">    UC_X86_INS_VPGATHERDQ,</span><br><span class="line">    UC_X86_INS_VPGATHERQD,</span><br><span class="line">    UC_X86_INS_VPGATHERQQ,</span><br><span class="line">    UC_X86_INS_VPHADDBD,</span><br><span class="line">    UC_X86_INS_VPHADDBQ,</span><br><span class="line">    UC_X86_INS_VPHADDBW,</span><br><span class="line">    UC_X86_INS_VPHADDDQ,</span><br><span class="line">    UC_X86_INS_VPHADDD,</span><br><span class="line">    UC_X86_INS_VPHADDSW,</span><br><span class="line">    UC_X86_INS_VPHADDUBD,</span><br><span class="line">    UC_X86_INS_VPHADDUBQ,</span><br><span class="line">    UC_X86_INS_VPHADDUBW,</span><br><span class="line">    UC_X86_INS_VPHADDUDQ,</span><br><span class="line">    UC_X86_INS_VPHADDUWD,</span><br><span class="line">    UC_X86_INS_VPHADDUWQ,</span><br><span class="line">    UC_X86_INS_VPHADDWD,</span><br><span class="line">    UC_X86_INS_VPHADDWQ,</span><br><span class="line">    UC_X86_INS_VPHADDW,</span><br><span class="line">    UC_X86_INS_VPHMINPOSUW,</span><br><span class="line">    UC_X86_INS_VPHSUBBW,</span><br><span class="line">    UC_X86_INS_VPHSUBDQ,</span><br><span class="line">    UC_X86_INS_VPHSUBD,</span><br><span class="line">    UC_X86_INS_VPHSUBSW,</span><br><span class="line">    UC_X86_INS_VPHSUBWD,</span><br><span class="line">    UC_X86_INS_VPHSUBW,</span><br><span class="line">    UC_X86_INS_VPINSRB,</span><br><span class="line">    UC_X86_INS_VPINSRD,</span><br><span class="line">    UC_X86_INS_VPINSRQ,</span><br><span class="line">    UC_X86_INS_VPINSRW,</span><br><span class="line">    UC_X86_INS_VPLZCNTD,</span><br><span class="line">    UC_X86_INS_VPLZCNTQ,</span><br><span class="line">    UC_X86_INS_VPMACSDD,</span><br><span class="line">    UC_X86_INS_VPMACSDQH,</span><br><span class="line">    UC_X86_INS_VPMACSDQL,</span><br><span class="line">    UC_X86_INS_VPMACSSDD,</span><br><span class="line">    UC_X86_INS_VPMACSSDQH,</span><br><span class="line">    UC_X86_INS_VPMACSSDQL,</span><br><span class="line">    UC_X86_INS_VPMACSSWD,</span><br><span class="line">    UC_X86_INS_VPMACSSWW,</span><br><span class="line">    UC_X86_INS_VPMACSWD,</span><br><span class="line">    UC_X86_INS_VPMACSWW,</span><br><span class="line">    UC_X86_INS_VPMADCSSWD,</span><br><span class="line">    UC_X86_INS_VPMADCSWD,</span><br><span class="line">    UC_X86_INS_VPMADDUBSW,</span><br><span class="line">    UC_X86_INS_VPMADDWD,</span><br><span class="line">    UC_X86_INS_VPMASKMOVD,</span><br><span class="line">    UC_X86_INS_VPMASKMOVQ,</span><br><span class="line">    UC_X86_INS_VPMAXSB,</span><br><span class="line">    UC_X86_INS_VPMAXSD,</span><br><span class="line">    UC_X86_INS_VPMAXSQ,</span><br><span class="line">    UC_X86_INS_VPMAXSW,</span><br><span class="line">    UC_X86_INS_VPMAXUB,</span><br><span class="line">    UC_X86_INS_VPMAXUD,</span><br><span class="line">    UC_X86_INS_VPMAXUQ,</span><br><span class="line">    UC_X86_INS_VPMAXUW,</span><br><span class="line">    UC_X86_INS_VPMINSB,</span><br><span class="line">    UC_X86_INS_VPMINSD,</span><br><span class="line">    UC_X86_INS_VPMINSQ,</span><br><span class="line">    UC_X86_INS_VPMINSW,</span><br><span class="line">    UC_X86_INS_VPMINUB,</span><br><span class="line">    UC_X86_INS_VPMINUD,</span><br><span class="line">    UC_X86_INS_VPMINUQ,</span><br><span class="line">    UC_X86_INS_VPMINUW,</span><br><span class="line">    UC_X86_INS_VPMOVDB,</span><br><span class="line">    UC_X86_INS_VPMOVDW,</span><br><span class="line">    UC_X86_INS_VPMOVM2B,</span><br><span class="line">    UC_X86_INS_VPMOVM2D,</span><br><span class="line">    UC_X86_INS_VPMOVM2Q,</span><br><span class="line">    UC_X86_INS_VPMOVM2W,</span><br><span class="line">    UC_X86_INS_VPMOVMSKB,</span><br><span class="line">    UC_X86_INS_VPMOVQB,</span><br><span class="line">    UC_X86_INS_VPMOVQD,</span><br><span class="line">    UC_X86_INS_VPMOVQW,</span><br><span class="line">    UC_X86_INS_VPMOVSDB,</span><br><span class="line">    UC_X86_INS_VPMOVSDW,</span><br><span class="line">    UC_X86_INS_VPMOVSQB,</span><br><span class="line">    UC_X86_INS_VPMOVSQD,</span><br><span class="line">    UC_X86_INS_VPMOVSQW,</span><br><span class="line">    UC_X86_INS_VPMOVSXBD,</span><br><span class="line">    UC_X86_INS_VPMOVSXBQ,</span><br><span class="line">    UC_X86_INS_VPMOVSXBW,</span><br><span class="line">    UC_X86_INS_VPMOVSXDQ,</span><br><span class="line">    UC_X86_INS_VPMOVSXWD,</span><br><span class="line">    UC_X86_INS_VPMOVSXWQ,</span><br><span class="line">    UC_X86_INS_VPMOVUSDB,</span><br><span class="line">    UC_X86_INS_VPMOVUSDW,</span><br><span class="line">    UC_X86_INS_VPMOVUSQB,</span><br><span class="line">    UC_X86_INS_VPMOVUSQD,</span><br><span class="line">    UC_X86_INS_VPMOVUSQW,</span><br><span class="line">    UC_X86_INS_VPMOVZXBD,</span><br><span class="line">    UC_X86_INS_VPMOVZXBQ,</span><br><span class="line">    UC_X86_INS_VPMOVZXBW,</span><br><span class="line">    UC_X86_INS_VPMOVZXDQ,</span><br><span class="line">    UC_X86_INS_VPMOVZXWD,</span><br><span class="line">    UC_X86_INS_VPMOVZXWQ,</span><br><span class="line">    UC_X86_INS_VPMULDQ,</span><br><span class="line">    UC_X86_INS_VPMULHRSW,</span><br><span class="line">    UC_X86_INS_VPMULHUW,</span><br><span class="line">    UC_X86_INS_VPMULHW,</span><br><span class="line">    UC_X86_INS_VPMULLD,</span><br><span class="line">    UC_X86_INS_VPMULLQ,</span><br><span class="line">    UC_X86_INS_VPMULLW,</span><br><span class="line">    UC_X86_INS_VPMULUDQ,</span><br><span class="line">    UC_X86_INS_VPORD,</span><br><span class="line">    UC_X86_INS_VPORQ,</span><br><span class="line">    UC_X86_INS_VPOR,</span><br><span class="line">    UC_X86_INS_VPPERM,</span><br><span class="line">    UC_X86_INS_VPROTB,</span><br><span class="line">    UC_X86_INS_VPROTD,</span><br><span class="line">    UC_X86_INS_VPROTQ,</span><br><span class="line">    UC_X86_INS_VPROTW,</span><br><span class="line">    UC_X86_INS_VPSADBW,</span><br><span class="line">    UC_X86_INS_VPSCATTERDD,</span><br><span class="line">    UC_X86_INS_VPSCATTERDQ,</span><br><span class="line">    UC_X86_INS_VPSCATTERQD,</span><br><span class="line">    UC_X86_INS_VPSCATTERQQ,</span><br><span class="line">    UC_X86_INS_VPSHAB,</span><br><span class="line">    UC_X86_INS_VPSHAD,</span><br><span class="line">    UC_X86_INS_VPSHAQ,</span><br><span class="line">    UC_X86_INS_VPSHAW,</span><br><span class="line">    UC_X86_INS_VPSHLB,</span><br><span class="line">    UC_X86_INS_VPSHLD,</span><br><span class="line">    UC_X86_INS_VPSHLQ,</span><br><span class="line">    UC_X86_INS_VPSHLW,</span><br><span class="line">    UC_X86_INS_VPSHUFB,</span><br><span class="line">    UC_X86_INS_VPSHUFD,</span><br><span class="line">    UC_X86_INS_VPSHUFHW,</span><br><span class="line">    UC_X86_INS_VPSHUFLW,</span><br><span class="line">    UC_X86_INS_VPSIGNB,</span><br><span class="line">    UC_X86_INS_VPSIGND,</span><br><span class="line">    UC_X86_INS_VPSIGNW,</span><br><span class="line">    UC_X86_INS_VPSLLDQ,</span><br><span class="line">    UC_X86_INS_VPSLLD,</span><br><span class="line">    UC_X86_INS_VPSLLQ,</span><br><span class="line">    UC_X86_INS_VPSLLVD,</span><br><span class="line">    UC_X86_INS_VPSLLVQ,</span><br><span class="line">    UC_X86_INS_VPSLLW,</span><br><span class="line">    UC_X86_INS_VPSRAD,</span><br><span class="line">    UC_X86_INS_VPSRAQ,</span><br><span class="line">    UC_X86_INS_VPSRAVD,</span><br><span class="line">    UC_X86_INS_VPSRAVQ,</span><br><span class="line">    UC_X86_INS_VPSRAW,</span><br><span class="line">    UC_X86_INS_VPSRLDQ,</span><br><span class="line">    UC_X86_INS_VPSRLD,</span><br><span class="line">    UC_X86_INS_VPSRLQ,</span><br><span class="line">    UC_X86_INS_VPSRLVD,</span><br><span class="line">    UC_X86_INS_VPSRLVQ,</span><br><span class="line">    UC_X86_INS_VPSRLW,</span><br><span class="line">    UC_X86_INS_VPSUBB,</span><br><span class="line">    UC_X86_INS_VPSUBD,</span><br><span class="line">    UC_X86_INS_VPSUBQ,</span><br><span class="line">    UC_X86_INS_VPSUBSB,</span><br><span class="line">    UC_X86_INS_VPSUBSW,</span><br><span class="line">    UC_X86_INS_VPSUBUSB,</span><br><span class="line">    UC_X86_INS_VPSUBUSW,</span><br><span class="line">    UC_X86_INS_VPSUBW,</span><br><span class="line">    UC_X86_INS_VPTESTMD,</span><br><span class="line">    UC_X86_INS_VPTESTMQ,</span><br><span class="line">    UC_X86_INS_VPTESTNMD,</span><br><span class="line">    UC_X86_INS_VPTESTNMQ,</span><br><span class="line">    UC_X86_INS_VPTEST,</span><br><span class="line">    UC_X86_INS_VPUNPCKHBW,</span><br><span class="line">    UC_X86_INS_VPUNPCKHDQ,</span><br><span class="line">    UC_X86_INS_VPUNPCKHQDQ,</span><br><span class="line">    UC_X86_INS_VPUNPCKHWD,</span><br><span class="line">    UC_X86_INS_VPUNPCKLBW,</span><br><span class="line">    UC_X86_INS_VPUNPCKLDQ,</span><br><span class="line">    UC_X86_INS_VPUNPCKLQDQ,</span><br><span class="line">    UC_X86_INS_VPUNPCKLWD,</span><br><span class="line">    UC_X86_INS_VPXORD,</span><br><span class="line">    UC_X86_INS_VPXORQ,</span><br><span class="line">    UC_X86_INS_VPXOR,</span><br><span class="line">    UC_X86_INS_VRCP14PD,</span><br><span class="line">    UC_X86_INS_VRCP14PS,</span><br><span class="line">    UC_X86_INS_VRCP14SD,</span><br><span class="line">    UC_X86_INS_VRCP14SS,</span><br><span class="line">    UC_X86_INS_VRCP28PD,</span><br><span class="line">    UC_X86_INS_VRCP28PS,</span><br><span class="line">    UC_X86_INS_VRCP28SD,</span><br><span class="line">    UC_X86_INS_VRCP28SS,</span><br><span class="line">    UC_X86_INS_VRCPPS,</span><br><span class="line">    UC_X86_INS_VRCPSS,</span><br><span class="line">    UC_X86_INS_VRNDSCALEPD,</span><br><span class="line">    UC_X86_INS_VRNDSCALEPS,</span><br><span class="line">    UC_X86_INS_VRNDSCALESD,</span><br><span class="line">    UC_X86_INS_VRNDSCALESS,</span><br><span class="line">    UC_X86_INS_VROUNDPD,</span><br><span class="line">    UC_X86_INS_VROUNDPS,</span><br><span class="line">    UC_X86_INS_VROUNDSD,</span><br><span class="line">    UC_X86_INS_VROUNDSS,</span><br><span class="line">    UC_X86_INS_VRSQRT14PD,</span><br><span class="line">    UC_X86_INS_VRSQRT14PS,</span><br><span class="line">    UC_X86_INS_VRSQRT14SD,</span><br><span class="line">    UC_X86_INS_VRSQRT14SS,</span><br><span class="line">    UC_X86_INS_VRSQRT28PD,</span><br><span class="line">    UC_X86_INS_VRSQRT28PS,</span><br><span class="line">    UC_X86_INS_VRSQRT28SD,</span><br><span class="line">    UC_X86_INS_VRSQRT28SS,</span><br><span class="line">    UC_X86_INS_VRSQRTPS,</span><br><span class="line">    UC_X86_INS_VRSQRTSS,</span><br><span class="line">    UC_X86_INS_VSCATTERDPD,</span><br><span class="line">    UC_X86_INS_VSCATTERDPS,</span><br><span class="line">    UC_X86_INS_VSCATTERPF0DPD,</span><br><span class="line">    UC_X86_INS_VSCATTERPF0DPS,</span><br><span class="line">    UC_X86_INS_VSCATTERPF0QPD,</span><br><span class="line">    UC_X86_INS_VSCATTERPF0QPS,</span><br><span class="line">    UC_X86_INS_VSCATTERPF1DPD,</span><br><span class="line">    UC_X86_INS_VSCATTERPF1DPS,</span><br><span class="line">    UC_X86_INS_VSCATTERPF1QPD,</span><br><span class="line">    UC_X86_INS_VSCATTERPF1QPS,</span><br><span class="line">    UC_X86_INS_VSCATTERQPD,</span><br><span class="line">    UC_X86_INS_VSCATTERQPS,</span><br><span class="line">    UC_X86_INS_VSHUFPD,</span><br><span class="line">    UC_X86_INS_VSHUFPS,</span><br><span class="line">    UC_X86_INS_VSQRTPD,</span><br><span class="line">    UC_X86_INS_VSQRTPS,</span><br><span class="line">    UC_X86_INS_VSQRTSD,</span><br><span class="line">    UC_X86_INS_VSQRTSS,</span><br><span class="line">    UC_X86_INS_VSTMXCSR,</span><br><span class="line">    UC_X86_INS_VSUBPD,</span><br><span class="line">    UC_X86_INS_VSUBPS,</span><br><span class="line">    UC_X86_INS_VSUBSD,</span><br><span class="line">    UC_X86_INS_VSUBSS,</span><br><span class="line">    UC_X86_INS_VTESTPD,</span><br><span class="line">    UC_X86_INS_VTESTPS,</span><br><span class="line">    UC_X86_INS_VUNPCKHPD,</span><br><span class="line">    UC_X86_INS_VUNPCKHPS,</span><br><span class="line">    UC_X86_INS_VUNPCKLPD,</span><br><span class="line">    UC_X86_INS_VUNPCKLPS,</span><br><span class="line">    UC_X86_INS_VZEROALL,</span><br><span class="line">    UC_X86_INS_VZEROUPPER,</span><br><span class="line">    UC_X86_INS_WAIT,</span><br><span class="line">    UC_X86_INS_WBINVD,</span><br><span class="line">    UC_X86_INS_WRFSBASE,</span><br><span class="line">    UC_X86_INS_WRGSBASE,</span><br><span class="line">    UC_X86_INS_WRMSR,</span><br><span class="line">    UC_X86_INS_XABORT,</span><br><span class="line">    UC_X86_INS_XACQUIRE,</span><br><span class="line">    UC_X86_INS_XBEGIN,</span><br><span class="line">    UC_X86_INS_XCHG,</span><br><span class="line">    UC_X86_INS_XCRYPTCBC,</span><br><span class="line">    UC_X86_INS_XCRYPTCFB,</span><br><span class="line">    UC_X86_INS_XCRYPTCTR,</span><br><span class="line">    UC_X86_INS_XCRYPTECB,</span><br><span class="line">    UC_X86_INS_XCRYPTOFB,</span><br><span class="line">    UC_X86_INS_XEND,</span><br><span class="line">    UC_X86_INS_XGETBV,</span><br><span class="line">    UC_X86_INS_XLATB,</span><br><span class="line">    UC_X86_INS_XRELEASE,</span><br><span class="line">    UC_X86_INS_XRSTOR,</span><br><span class="line">    UC_X86_INS_XRSTOR64,</span><br><span class="line">    UC_X86_INS_XRSTORS,</span><br><span class="line">    UC_X86_INS_XRSTORS64,</span><br><span class="line">    UC_X86_INS_XSAVE,</span><br><span class="line">    UC_X86_INS_XSAVE64,</span><br><span class="line">    UC_X86_INS_XSAVEC,</span><br><span class="line">    UC_X86_INS_XSAVEC64,</span><br><span class="line">    UC_X86_INS_XSAVEOPT,</span><br><span class="line">    UC_X86_INS_XSAVEOPT64,</span><br><span class="line">    UC_X86_INS_XSAVES,</span><br><span class="line">    UC_X86_INS_XSAVES64,</span><br><span class="line">    UC_X86_INS_XSETBV,</span><br><span class="line">    UC_X86_INS_XSHA1,</span><br><span class="line">    UC_X86_INS_XSHA256,</span><br><span class="line">    UC_X86_INS_XSTORE,</span><br><span class="line">    UC_X86_INS_XTEST,</span><br><span class="line">    UC_X86_INS_FDISI8087_NOP,</span><br><span class="line">    UC_X86_INS_FENI8087_NOP,</span><br><span class="line">    UC_X86_INS_ENDING, // mark the end of the list of insn</span><br><span class="line">&#125; uc_x86_insn;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://example.com">EPs1l0h</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://example.com/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/">https://example.com/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://example.com" target="_blank">EPs1l0h's Castle</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover1.jpg?raw=true" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/02/06/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E5%88%9D%E8%B5%9B2023/"><img class="prev-cover" src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover3.jpg?raw=true" onerror="onerror=null;src='/img/404.gif'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">西湖论剑初赛2023 - re复现</div></div></a></div><div class="next-post pull-right"><a href="/2022/12/12/%E8%AE%B0%E4%B8%80%E6%AC%A1TEC-8%E4%BB%BF%E7%9C%9F%E8%BD%AF%E4%BB%B6patch/"><img class="next-cover" src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover5.jpg?raw=true" onerror="onerror=null;src='/img/404.gif'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">记一次TEC-8仿真软件patch</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">EPs1l0h</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/EPs1l0h"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Spears shall be shaken! Shields shall be splintered! A sword day! A red day! Ere the sun rises!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFunicorn"><span class="toc-number">1.</span> <span class="toc-text">什么是unicorn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%AE%98%E6%96%B9%E7%BF%BB%E8%AF%91"><span class="toc-number">1.1.</span> <span class="toc-text">一些官方翻译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unicorn-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.2.</span> <span class="toc-text">Unicorn 快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">多架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%AF%AD%E8%A8%80"><span class="toc-number">1.2.2.</span> <span class="toc-text">多语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="toc-number">1.2.3.</span> <span class="toc-text">多线程安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98"><span class="toc-number">1.2.4.</span> <span class="toc-text">虚拟内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook-%E6%9C%BA%E5%88%B6"><span class="toc-number">1.2.5.</span> <span class="toc-text">Hook 机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%B1%BB"><span class="toc-number">1.2.6.</span> <span class="toc-text">指令执行类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE%E7%B1%BB"><span class="toc-number">1.2.7.</span> <span class="toc-text">内存访问类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%B1%BB"><span class="toc-number">1.2.8.</span> <span class="toc-text">异常处理类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Task1"><span class="toc-number">2.</span> <span class="toc-text">Task1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E9%80%BB%E8%BE%91"><span class="toc-number">2.1.</span> <span class="toc-text">程序逻辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unicorn%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C"><span class="toc-number">2.2.</span> <span class="toc-text">unicorn模拟执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9hook%E5%87%BD%E6%95%B0%E6%8F%90%E9%AB%98%E6%95%88%E7%8E%87"><span class="toc-number">2.3.</span> <span class="toc-text">修改hook函数提高效率</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Task2"><span class="toc-number">3.</span> <span class="toc-text">Task2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9Bhint"><span class="toc-number">3.1.</span> <span class="toc-text">一些hint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shellcode%E8%BD%AC%E6%B1%87%E7%BC%96"><span class="toc-number">3.2.</span> <span class="toc-text">shellcode转汇编</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unicorn%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C-1"><span class="toc-number">3.3.</span> <span class="toc-text">unicorn模拟执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8D%B0-chmod-%E5%92%8C-exit-%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">打印 chmod 和 exit 的参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E7%A8%8B%E5%BA%8F%E6%B5%81"><span class="toc-number">3.5.</span> <span class="toc-text">输出程序流</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Task3"><span class="toc-number">4.</span> <span class="toc-text">Task3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90"><span class="toc-number">4.1.</span> <span class="toc-text">程序分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%88%E7%9A%84%E9%AB%98%E5%9C%B0%E5%9D%80%E8%BF%9B%E8%A1%8C-patch"><span class="toc-number">4.2.</span> <span class="toc-text">修改栈的高地址进行 patch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Task4"><span class="toc-number">5.</span> <span class="toc-text">Task4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90-1"><span class="toc-number">5.1.</span> <span class="toc-text">程序分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unicorn-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C%E7%94%A8-stack-%E4%BC%98%E5%8C%96"><span class="toc-number">5.2.</span> <span class="toc-text">unicorn 模拟执行用 stack 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%93%81%E4%BA%BA%E4%B8%89%E9%A1%B92024-ez-driver"><span class="toc-number">5.3.</span> <span class="toc-text">信息安全铁人三项2024 - ez_driver</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%87%E5%BD%95"><span class="toc-number">6.</span> <span class="toc-text">备录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%80%E6%9C%89unicorn%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84%E5%B8%B8%E9%87%8F"><span class="toc-number">6.1.</span> <span class="toc-text">所有unicorn模块中的常量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hook%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.2.</span> <span class="toc-text">hook的类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0%E7%9A%84%E5%A3%B0%E6%98%8E%E7%AD%89"><span class="toc-number">6.3.</span> <span class="toc-text">关键函数的声明等</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#uc-open"><span class="toc-number">6.3.1.</span> <span class="toc-text">uc_open</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uc-mem-map"><span class="toc-number">6.3.2.</span> <span class="toc-text">uc_mem_map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uc-mem-write"><span class="toc-number">6.3.3.</span> <span class="toc-text">uc_mem_write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uc-reg-write"><span class="toc-number">6.3.4.</span> <span class="toc-text">uc_reg_write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uc-hook-add"><span class="toc-number">6.3.5.</span> <span class="toc-text">uc_hook_add</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/02/19/BeginCTF2024-re-wp/" title="BeginCTF2024-re-wp"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover2.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="BeginCTF2024-re-wp"/></a><div class="content"><a class="title" href="/2024/02/19/BeginCTF2024-re-wp/" title="BeginCTF2024-re-wp">BeginCTF2024-re-wp</a><time datetime="2024-02-19T06:55:40.000Z" title="发表于 2024-02-19 14:55:40">2024-02-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/12/L3HCTF-2024-%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/" title="L3HCTF-2024-部分复现"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover3.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="L3HCTF-2024-部分复现"/></a><div class="content"><a class="title" href="/2024/02/12/L3HCTF-2024-%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/" title="L3HCTF-2024-部分复现">L3HCTF-2024-部分复现</a><time datetime="2024-02-12T07:03:06.000Z" title="发表于 2024-02-12 15:03:06">2024-02-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/05/%E8%93%9D%E5%B8%BD%E6%9D%AF2022%E5%8D%8A%E5%86%B3%E8%B5%9BWP%E2%80%94%E2%80%94%E8%A6%81%E8%93%9D%E5%B8%BD%E4%B8%8D%E8%A6%81%E7%BB%BF%E5%B8%BD/" title="蓝帽杯(取证杯）2022半决赛WP"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover2.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="蓝帽杯(取证杯）2022半决赛WP"/></a><div class="content"><a class="title" href="/2023/10/05/%E8%93%9D%E5%B8%BD%E6%9D%AF2022%E5%8D%8A%E5%86%B3%E8%B5%9BWP%E2%80%94%E2%80%94%E8%A6%81%E8%93%9D%E5%B8%BD%E4%B8%8D%E8%A6%81%E7%BB%BF%E5%B8%BD/" title="蓝帽杯(取证杯）2022半决赛WP">蓝帽杯(取证杯）2022半决赛WP</a><time datetime="2023-10-05T08:20:32.725Z" title="发表于 2023-10-05 16:20:32">2023-10-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/05/%E8%93%9D%E5%B8%BD%E6%9D%AF2022%E5%88%9D%E8%B5%9B%E5%A4%8D%E7%8E%B0/" title="蓝帽杯(电子取证杯)2022赛题复现"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover3.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="蓝帽杯(电子取证杯)2022赛题复现"/></a><div class="content"><a class="title" href="/2023/10/05/%E8%93%9D%E5%B8%BD%E6%9D%AF2022%E5%88%9D%E8%B5%9B%E5%A4%8D%E7%8E%B0/" title="蓝帽杯(电子取证杯)2022赛题复现">蓝帽杯(电子取证杯)2022赛题复现</a><time datetime="2023-10-05T08:20:32.719Z" title="发表于 2023-10-05 16:20:32">2023-10-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/05/%E5%BC%BA%E7%BD%91%E6%9D%AF2022%20%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/" title="强网杯2022 部分赛题复现"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover3.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="强网杯2022 部分赛题复现"/></a><div class="content"><a class="title" href="/2023/10/05/%E5%BC%BA%E7%BD%91%E6%9D%AF2022%20%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/" title="强网杯2022 部分赛题复现">强网杯2022 部分赛题复现</a><time datetime="2023-10-05T08:20:32.684Z" title="发表于 2023-10-05 16:20:32">2023-10-05</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover1.jpg?raw=true')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By EPs1l0h</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://example.com/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/'
    this.page.identifier = '/2023/01/18/unicorn%E5%88%9D%E6%8E%A2/'
    this.page.title = 'unicorn模拟执行初探'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Disqus' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><div class="aplayer no-destroy" data-id="2981528901" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>