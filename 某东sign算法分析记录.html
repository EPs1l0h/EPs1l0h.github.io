<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>某东sign算法分析记录（萌新向） | EPs1l0h's Castle</title><meta name="author" content="EPs1l0h"><meta name="copyright" content="EPs1l0h"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="app 版本：12.2.2 抓包用Charles抓包，可以用Structure查看 api.m.jd.com 里面的接口，很多 client.action 的包  看一下contents，可以根据这个 x-api-eid-token 定位签名逻辑  x-api-eid-tokenx-api-eid-token 是一个用于身份验证和授权的关键参数，通过API网关传递给后端服务，实现流程大概分为三步：">
<meta property="og:type" content="website">
<meta property="og:title" content="某东sign算法分析记录（萌新向）">
<meta property="og:url" content="https://example.com/%E6%9F%90%E4%B8%9Csign%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95.html">
<meta property="og:site_name" content="EPs1l0h&#39;s Castle">
<meta property="og:description" content="app 版本：12.2.2 抓包用Charles抓包，可以用Structure查看 api.m.jd.com 里面的接口，很多 client.action 的包  看一下contents，可以根据这个 x-api-eid-token 定位签名逻辑  x-api-eid-tokenx-api-eid-token 是一个用于身份验证和授权的关键参数，通过API网关传递给后端服务，实现流程大概分为三步：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover1.jpg?raw=true">
<meta property="article:published_time" content="2024-09-04T01:21:08.000Z">
<meta property="article:modified_time" content="2024-09-09T05:54:25.387Z">
<meta property="article:author" content="EPs1l0h">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover1.jpg?raw=true"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://example.com/%E6%9F%90%E4%B8%9Csign%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '某东sign算法分析记录（萌新向）',
  isPost: false,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-09-09 13:54:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="source/css/aplayer_custom.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/writeup"><i class="fa-fw fas fa-folder-open"></i><span> writeup</span></a></li><li><a class="site-page child" href="/categories/notes"><i class="fa-fw fas fa-folder-open"></i><span> notes</span></a></li><li><a class="site-page child" href="/categories/jottings"><i class="fa-fw fas fa-folder-open"></i><span> jottings</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-link"></i><span> Link</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.cnblogs.com/Here-is-SG"><i class="fa-fw fas fa-link"></i><span> iPlayForSG</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://jameshoi.github.io/"><i class="fa-fw fas fa-link"></i><span> jameshoi</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.cnblogs.com/Only-xiaoxiao"><i class="fa-fw fas fa-link"></i><span> xiaoxiao</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.cnblogs.com/Clovershrub"><i class="fa-fw fas fa-link"></i><span> Clovershrub</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.gaoyucan.site/"><i class="fa-fw fas fa-link"></i><span> gaoyucan</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://demoyao100.github.io/"><i class="fa-fw fas fa-link"></i><span> moyao</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://lantern.cool/"><i class="fa-fw fas fa-link"></i><span> lantern</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://mapleqian.github.io/"><i class="fa-fw fas fa-link"></i><span> Serendy</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-home-page" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">EPs1l0h's Castle</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/writeup"><i class="fa-fw fas fa-folder-open"></i><span> writeup</span></a></li><li><a class="site-page child" href="/categories/notes"><i class="fa-fw fas fa-folder-open"></i><span> notes</span></a></li><li><a class="site-page child" href="/categories/jottings"><i class="fa-fw fas fa-folder-open"></i><span> jottings</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-link"></i><span> Link</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.cnblogs.com/Here-is-SG"><i class="fa-fw fas fa-link"></i><span> iPlayForSG</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://jameshoi.github.io/"><i class="fa-fw fas fa-link"></i><span> jameshoi</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.cnblogs.com/Only-xiaoxiao"><i class="fa-fw fas fa-link"></i><span> xiaoxiao</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.cnblogs.com/Clovershrub"><i class="fa-fw fas fa-link"></i><span> Clovershrub</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://blog.gaoyucan.site/"><i class="fa-fw fas fa-link"></i><span> gaoyucan</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://demoyao100.github.io/"><i class="fa-fw fas fa-link"></i><span> moyao</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://lantern.cool/"><i class="fa-fw fas fa-link"></i><span> lantern</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://mapleqian.github.io/"><i class="fa-fw fas fa-link"></i><span> Serendy</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> about</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="page-site-info"><h1 id="site-title">某东sign算法分析记录（萌新向）</h1></div></header><main class="layout" id="content-inner"><div id="page"><div id="article-container"><p>app 版本：12.2.2</p>
<h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>用Charles抓包，可以用Structure查看 <code>api.m.jd.com</code> 里面的接口，很多 <code>client.action</code> 的包</p>
<p><img src="/QQ_1725592965134.png" alt="QQ_1725592965134"></p>
<p>看一下contents，可以根据这个 <code>x-api-eid-token</code> 定位签名逻辑</p>
<p><img src="/image-20240906113323944.png" alt="image-20240906113323944"></p>
<h1 id="x-api-eid-token"><a href="#x-api-eid-token" class="headerlink" title="x-api-eid-token"></a>x-api-eid-token</h1><p>x-api-eid-token 是一个用于身份验证和授权的关键参数，通过API网关传递给后端服务，实现流程大概分为三步：</p>
<ol>
<li>客户端发起请求到API网关</li>
<li>API网关验证并生成 x-api-eid-token</li>
<li>API网关把 x-api-eid-token 传递给后端</li>
</ol>
<h1 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h1><p>扔 jadx 搜索 <code>EID_TOKEN</code>，再找到交叉引用</p>
<p><img src="/QQ_1725414391371.png" alt="QQ_1725414391371"></p>
<p>定位到这个函数，输入一个参数 <code>z</code>，生成一个包含各种设备和用户信息的URL参数字符串，下面逐段分析一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">buildPublicStateUri</span><span class="params">(<span class="type">boolean</span> z)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">stringBuffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取设备指纹，如果不为空，就添加到 REPORT_PARAM_EID 字段</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">urlEncodeUTF8</span> <span class="operator">=</span> urlEncodeUTF8(DeviceFinger.getFinger(JdSdk.getInstance().getApplicationContext()));</span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(urlEncodeUTF8)) &#123;</span><br><span class="line">                stringBuffer.append(EncryptStatParamController.REPORT_PARAM_EID);</span><br><span class="line">                stringBuffer.append(urlEncodeUTF8);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable unused) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获得用户的pin码</span></span><br><span class="line">            <span class="keyword">if</span> (UserUtil.getWJLoginHelper() != <span class="literal">null</span>) &#123;</span><br><span class="line">                str = UserUtil.getWJLoginHelper().getPin();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 从 BiometricManager 里面获得 token 缓存，通过UTF-8编码后作为参数 eid_token 连带上面的 pin 添加到 stringBuffer 中</span></span><br><span class="line">            <span class="comment">// 通过交叉引用可以找到</span></span><br><span class="line">            <span class="comment">//    public static final String REPORT_PARAM_EID = &quot;&amp;eid=&quot;;</span></span><br><span class="line">            <span class="comment">//    public static final String REPORT_PARAM_EID_TOKEN = &quot;&amp;x-api-eid-token=&quot;;</span></span><br><span class="line">            <span class="comment">// eid 就是设备指纹，x-api-eid-token 就是 下面的urlEncodeUTF82</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">urlEncodeUTF82</span> <span class="operator">=</span> urlEncodeUTF8(BiometricManager.getInstance().getCacheTokenByBizId(JdSdk.getInstance().getApplicationContext(), <span class="string">&quot;CCO-WAAP&quot;</span>, str));</span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(urlEncodeUTF82)) &#123;</span><br><span class="line">                stringBuffer.append(EncryptStatParamController.REPORT_PARAM_EID_TOKEN);</span><br><span class="line">                stringBuffer.append(urlEncodeUTF82);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable unused2) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    	<span class="comment">// z 是该函数的参数</span></span><br><span class="line">        <span class="keyword">if</span> (z) &#123;</span><br><span class="line">            <span class="comment">// 获取设备的地理位置参数并进行一些替换处理，最后作为 area 参数添加到 stringBuffer 中。</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">commonLbsParameter</span> <span class="operator">=</span> LocManager.getCommonLbsParameter();</span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(commonLbsParameter)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">replace</span> <span class="operator">=</span> commonLbsParameter.replace(<span class="string">&quot;-1&quot;</span>, str2);</span><br><span class="line">                stringBuffer.append(<span class="string">&quot;&amp;area=&quot;</span>);</span><br><span class="line">                stringBuffer.append(replace);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">// 获取设备的网络类型和WiFi的BSSID，并分别作为 networkType 和 wifiBssid 参数添加到 stringBuffer 中。</span></span><br><span class="line">        stringBuffer.append(<span class="string">&quot;&amp;networkType=&quot;</span>);</span><br><span class="line">        stringBuffer.append(DeviceInfoHelper.getNetworkTypeAccordingPrivacy());</span><br><span class="line">        stringBuffer.append(<span class="string">&quot;&amp;wifiBssid=&quot;</span>);</span><br><span class="line">        stringBuffer.append(BssidFetcher.getInstance().getBssid());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取用户的 uts 信息（可能是用户标识或追踪标识），并作为 uts 参数添加到 stringBuffer 中</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">uts</span> <span class="operator">=</span> PersonalInfoManager.getInstance().getUts();</span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(uts)) &#123;</span><br><span class="line">                stringBuffer.append(<span class="string">&quot;&amp;uts=&quot;</span>);</span><br><span class="line">                stringBuffer.append(uts);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable unused3) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 老年模式信息 uemps</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">uemps</span> <span class="operator">=</span> JDElderModeUtils.getUemps();</span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(uemps)) &#123;</span><br><span class="line">                stringBuffer.append(<span class="string">&quot;&amp;uemps=&quot;</span>);</span><br><span class="line">                stringBuffer.append(uemps);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable unused4) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">     	<span class="comment">// 是否是 harmonyOs</span></span><br><span class="line">        stringBuffer.append(<span class="string">&quot;&amp;harmonyOs=&quot;</span>);</span><br><span class="line">        JdSdk.getInstance();</span><br><span class="line">        <span class="keyword">if</span> (JdSdk.isHarmonyOS()) &#123;</span><br><span class="line">            str2 = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">     	<span class="comment">// 扩展参数 ext</span></span><br><span class="line">        stringBuffer.append(str2);</span><br><span class="line">        stringBuffer.append(<span class="string">&quot;&amp;ext=&quot;</span>);</span><br><span class="line">        stringBuffer.append(ExtParamUtils.getExtParamsStr());</span><br><span class="line">        <span class="type">String</span> <span class="variable">verifyToken</span> <span class="operator">=</span> JDHttpTookit.getEngine().getGuardVerifyPlugin().getVerifyToken();</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(verifyToken)) &#123;</span><br><span class="line">            <span class="comment">// 获取验证Token</span></span><br><span class="line">            stringBuffer.append(<span class="string">&quot;&amp;vt=&quot;</span>);</span><br><span class="line">            stringBuffer.append(verifyToken);</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">// 检查设备是否支持AVIF格式图片</span></span><br><span class="line">        <span class="keyword">if</span> (AvifImageUtils.avifEnable()) &#123;</span><br><span class="line">            stringBuffer.append(<span class="string">&quot;&amp;avifSupport=&quot;</span>);</span><br><span class="line">            stringBuffer.append(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (AvifImageUtils.avifBitmapConvertEnable()) &#123;</span><br><span class="line">            stringBuffer.append(<span class="string">&quot;&amp;acs=&quot;</span>);</span><br><span class="line">            stringBuffer.append(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuffer.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>看起来就是一个组包字符串的函数，获取各种信息组成一个字符串并返回，那么不出意外后面可能会有加密</p>
<p>查看其交叉引用，也是在拼接字符串组包，继续找交叉引用</p>
<p><img src="/QQ_1725419897050.png" alt="QQ_1725419897050"></p>
<p>接着找交叉引用</p>
<p><img src="/QQ_1725420001680.png" alt="QQ_1725420001680"></p>
<p><img src="/QQ_1725420362085.png" alt="QQ_1725420362085"></p>
<p>再网上交叉引用，找到加密函数</p>
<p><img src="/QQ_1725420409104.png" alt="QQ_1725420409104"></p>
<p>前面都是在检查是否是第三方应用然后进行一些操作，看一下后面的逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// 获取统计报告字符串</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">statisticReportString</span> <span class="operator">=</span> JDHttpTookit.getEngine().getStatInfoConfigImpl().getStatisticReportString(<span class="string">&quot;&quot;</span>, <span class="literal">true</span>, <span class="literal">true</span>, z, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">   <span class="comment">// 如果统计报告字符串不为空，将其解析为查询参数并添加到 builder 中</span></span><br><span class="line">   <span class="keyword">if</span> (!TextUtils.isEmpty(statisticReportString) &amp;&amp; (urlParams2 = getUrlParams(statisticReportString)) != <span class="literal">null</span> &amp;&amp; !urlParams2.isEmpty()) &#123;</span><br><span class="line">       <span class="keyword">for</span> (String str8 : urlParams2.keySet()) &#123;</span><br><span class="line">           <span class="keyword">if</span> (TextUtils.equals(str8, <span class="string">&quot;ep&quot;</span>)) &#123;</span><br><span class="line">               builder.addEncodedQueryParameter(str8, urlParams2.get(str8));</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               builder.addQueryParameter(str8, urlParams2.get(str8));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 获取其他信息并计算签名</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">queryParameter</span> <span class="operator">=</span> request.url().queryParameter(<span class="string">&quot;functionId&quot;</span>);</span><br><span class="line">   <span class="type">String</span> <span class="variable">property</span> <span class="operator">=</span> InternalConfiguration.getProperty(<span class="string">&quot;client&quot;</span>, str2);</span><br><span class="line">   <span class="type">String</span> <span class="variable">versionName</span> <span class="operator">=</span> JDHttpTookit.getEngine().getStatInfoConfigImpl().getVersionName();</span><br><span class="line">   <span class="type">String</span> <span class="variable">deviceUUID</span> <span class="operator">=</span> JDHttpTookit.getEngine().getStatInfoConfigImpl().getDeviceUUID(z);</span><br><span class="line">   <span class="keyword">if</span> (OKLog.D) &#123;</span><br><span class="line">       OKLog.d(TAG, <span class="string">&quot;- ..functionId --&gt;&gt; &quot;</span> + queryParameter);</span><br><span class="line">       OKLog.d(TAG, <span class="string">&quot;- ..body --&gt;&gt; &quot;</span> + str);</span><br><span class="line">       OKLog.d(TAG, <span class="string">&quot;- ..uuid --&gt;&gt; &quot;</span> + deviceUUID);</span><br><span class="line">       OKLog.d(TAG, <span class="string">&quot;- ..client --&gt;&gt; &quot;</span> + property);</span><br><span class="line">       OKLog.d(TAG, <span class="string">&quot;- ..clientVersion --&gt;&gt; &quot;</span> + versionName);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="comment">// 计算签名</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">signature</span> <span class="operator">=</span> JDHttpTookit.getEngine().getSignatureHandlerImpl().signature(JDHttpTookit.getEngine().getApplicationContext(), queryParameter, str, deviceUUID, property, versionName);</span><br><span class="line">       <span class="keyword">if</span> (OKLog.D) &#123;</span><br><span class="line">           OKLog.d(<span class="string">&quot;Signature&quot;</span>, <span class="string">&quot;native signature sucess &quot;</span> + signature);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (TextUtils.isEmpty(signature) || (urlParams = getUrlParams(signature)) == <span class="literal">null</span> || urlParams.isEmpty()) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 如果签名不为空，将其解析为查询参数并添加到 builder 中</span></span><br><span class="line">       <span class="keyword">for</span> (String str9 : urlParams.keySet()) &#123;</span><br><span class="line">           builder.addQueryParameter(str9, urlParams.get(str9));</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>跟进 <code>signature</code> 函数</p>
<p><img src="/QQ_1725421085696.png" alt="QQ_1725421085696"></p>
<p>查找 <code>ISignatureHandler</code> 交叉引用找到这个类</p>
<p><img src="/QQ_1725421356101.png" alt="QQ_1725421356101"></p>
<p>这里是初始化函数</p>
<p><img src="/QQ_1725421494813.png" alt="QQ_1725421494813"></p>
<p>查看其交叉引用发现了很长的一个初始化代码，是在 <code>initialize</code>，点进 <code>getSignatureHandler</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JDHttpTookit.initialize(JDHttpTookit.newBuilder(JdSdk.getInstance().getApplication()).setAppProxy(JDNetworkDependencyFactory.getAppProxy()).setRuntimeConfigImpl(JDNetworkDependencyFactory.getRuntimeConfigImpl()).setStatInfoConfigImpl(JDNetworkDependencyFactory.getStatInfoConfigImpl()).</span><br><span class="line">setSignatureHandler(JDNetworkDependencyFactory.getSignatureHandler())</span><br><span class="line">.setLoginUserControllerImpl(JDNetworkDependencyFactory.getLoginUserControllerImpl()).setExceptionReporter(JDNetworkDependencyFactory.getExceptionReportDelegate()).setNetworkControllerImpl(JDNetworkDependencyFactory.getNetworkControllerImpl()).setExternalDebugConfigImpl(JDNetworkDependencyFactory.getExternalDebugConfigImpl()).setCustomUIComponentImpl(JDNetworkDependencyFactory.getCustomUIComponentDependency()).setHttpDnsController(JDNetworkDependencyFactory.getHttpDnsControllerImpl()).setPhcEncryptionPlugin(JDNetworkDependencyFactory.getPhcEncryptionPlugin()).setHttpErrorDialogImpl(JDNetworkDependencyFactory.getHttpErrorAlertDialog()).setGateWayRespHeaderListener(JDNetworkDependencyFactory.getGatewayRespHeaderListenerImpl()).setGuardVerifyPlugin(JDNetworkDependencyFactory.getGuardVerifyPlugin()).setJDGuardPlugin(JDGuardHelper.getJDGuardPlugin()).setDownloadDomainResolver(JDNetworkDependencyFactory.getDownloadDomainResolver()).setBusinessJsonCodeListener(JDNetworkDependencyFactory.getBusinessJsonCodeEventListener()).setHardGuardVerifyPlugin(JDNetworkDependencyFactory.getHardGuardVerifyPlugin()).setCronetProvider(JDNetworkDependencyFactory.getCronetProvider()).setPerformanceReporter(JDNetworkDependencyFactory.getPerformanceReporter()).isPrintLog(Configuration.isBeta()).build());</span><br></pre></td></tr></table></figure>
<p><img src="/QQ_1725425681513.png" alt="QQ_1725425681513"></p>
<p>点进 <code>getSignFromJni</code> 方法</p>
<p><img src="/QQ_1725425743620.png" alt="QQ_1725425743620"></p>
<p>看到 <code>native</code> 方法，好似，有的忙了</p>
<h1 id="SO-层分析"><a href="#SO-层分析" class="headerlink" title="SO 层分析"></a>SO 层分析</h1><p>看一下 package 是<code>com.jingdong.common.utils</code>，我们要找到这些 native 函数是在哪个 so 文件里被声明的。</p>
<p>这里可以 hook dlsym 然后在通过加载的 so 文件枚举每个 so 文件的导出表来定位，脚本如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_dlsym</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> dlsymAddr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libdl.so&quot;</span>, <span class="string">&quot;dlsym&quot;</span>);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(dlsymAddr, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">args1</span> = args[<span class="number">1</span>];</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">findModuleByAddress</span>(retval);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">module</span> === <span class="literal">null</span>) <span class="keyword">return</span>; </span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">args1</span>.<span class="title function_">readCString</span>(), <span class="variable language_">module</span>.<span class="property">name</span>, retval, retval.<span class="title function_">sub</span>(<span class="variable language_">module</span>.<span class="property">base</span>));</span><br><span class="line">            <span class="keyword">let</span> <span class="built_in">exports</span> = <span class="title class_">Module</span>.<span class="title function_">enumerateExports</span>(<span class="variable language_">module</span>.<span class="property">name</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">exports</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="built_in">exports</span>[i]));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;----------------------------------------------------------------&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(hook_dlsym);</span><br></pre></td></tr></table></figure>
<p>打印日志信息到文件中 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -f com.jingdong.app.mall  -l hookJD.js --no &gt; hookJD_output.<span class="built_in">log</span> 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p><img src="/image-20240906230808807.png" alt="image-20240906230808807"></p>
<p>定位到 <code>getSignFromJni</code> 是在 <code>libjdbitmapkit.so</code> 这个文件中被调用的</p>
<p>这里遇到一个问题： <code>Process.enumerateModules()</code> 和 <code>hook dlsym</code> 两种方法都是为了得到 modules，那么这两种方法有什么区别呢？</p>
<p>先来看官方文档的解释：</p>
<p><img src="/image-20240906231716319.png" alt="image-20240906231716319"></p>
<p>而 dlsym 则涉及到运行时的动态链接，尽管加载时的动态链接是大部分编译加载系统都在使用的方式，操作系统同样提供了<strong>运行时加载和链接共享库的方式</strong>。其可以通过共享库的方式来让引用程序在下次运行时执行不同的代码，这也为应用程序 <strong>Hook</strong> 系统函数提供了基础。</p>
<p>Unix-like 系统提供了 <code>dlopen</code>，<code>dlsym</code> 系列函数来供程序在运行时操作外部的动态链接库，从而获取动态链接库中的函数或者功能调用。</p>
<p>GPT 答：</p>
<h3 id="Process-enumerateModules-的工作机制"><a href="#Process-enumerateModules-的工作机制" class="headerlink" title="Process.enumerateModules() 的工作机制"></a><strong><code>Process.enumerateModules()</code> 的工作机制</strong></h3><ul>
<li><strong>工作原理</strong>：<code>Process.enumerateModules()</code> 直接从操作系统中获取当前进程的内存映射（类似于读取 <code>/proc/&lt;pid&gt;/maps</code> 文件）。它枚举了进程中已经加载到内存的所有模块（如 SO 文件、可执行文件和动态库）。</li>
<li><strong>时间点</strong>：只能获取到当前已经<strong>加载进内存的模块</strong>。这些模块通常是在进程启动时或静态加载时加载的模块。</li>
<li>局限性：<ul>
<li>不能捕获<strong>动态加载</strong>的模块，尤其是使用 <code>dlopen</code> 在运行时动态加载的模块。如果某个模块是在你调用 <code>Process.enumerateModules()</code> 之后才加载的，它不会出现在结果中。</li>
<li>也不会捕获那些没有经过 <code>dlopen</code> 或 <code>dlsym</code> 的模块符号。</li>
</ul>
</li>
</ul>
<h3 id="Hook-dlsym-的工作机制"><a href="#Hook-dlsym-的工作机制" class="headerlink" title="Hook dlsym 的工作机制"></a><strong>Hook <code>dlsym</code> 的工作机制</strong></h3><ul>
<li><strong>工作原理</strong>：<code>dlsym</code> 是一个标准的动态链接库符号查找函数。当应用程序动态查找符号时（尤其是使用 <code>dlopen</code> 加载动态库时），它会调用 <code>dlsym</code> 查找导出的函数和变量的地址。通过 Hook <code>dlsym</code>，可以拦截每次符号解析的操作，从而获取<strong>运行时加载的动态库</strong>及其符号。</li>
<li><strong>时间点</strong>：<code>dlsym</code> 可以捕获<strong>动态加载</strong>的模块，即便它们是在应用程序运行时才加载的。每当 <code>dlsym</code> 解析符号时，无论符号在哪个模块中（包括动态加载的 SO 文件），都可以通过 Hook 获取这些符号和模块。</li>
<li>优势：<ul>
<li>可以捕获通过 <code>dlopen</code> 动态加载的库和符号，即使这些库是在脚本运行后才被加载。</li>
<li>能捕获所有使用 <code>dlsym</code> 的符号解析，无论何时加载模块。</li>
</ul>
</li>
</ul>
<h3 id="区别总结："><a href="#区别总结：" class="headerlink" title="区别总结："></a>区别总结：</h3><div class="table-container">
<table>
<thead>
<tr>
<th>特性</th>
<th><code>Process.enumerateModules()</code></th>
<th>Hook <code>dlsym</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>作用时间</strong></td>
<td>列举已经加载的模块</td>
<td>捕获运行时动态加载的模块</td>
</tr>
<tr>
<td><strong>获取方式</strong></td>
<td>通过操作系统的内存映射表获取</td>
<td>通过拦截 <code>dlsym</code> 符号解析获取</td>
</tr>
<tr>
<td><strong>捕获范围</strong></td>
<td>只能捕获已经加载的模块</td>
<td>捕获所有动态加载和解析的符号及模块</td>
</tr>
<tr>
<td><strong>动态库支持</strong></td>
<td>不能捕获运行时加载的动态库</td>
<td>可以捕获通过 <code>dlopen</code> 加载的库</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>快速列举进程中当前的所有模块</td>
<td>动态追踪应用程序加载的库和符号</td>
</tr>
</tbody>
</table>
</div>
<p>JNI_OnLoad有动态注册，看一下结构体</p>
<p><img src="/image-20240907001646042.png" alt="image-20240907001646042"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* name; <span class="comment">//动态注册的Java方法名</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* signature; <span class="comment">//描述方法参数和返回值</span></span><br><span class="line">    <span class="type">void</span>*       fnPtr; <span class="comment">//指向实现Java方法的C/C++函数指针</span></span><br><span class="line">&#125; JNINativeMethod;</span><br></pre></td></tr></table></figure>
<p>我们找到这个 <code>libjdbitmapkit.so</code> 文件中的 <code>getSignFromJni</code> 函数</p>
<p><img src="/image-20240906232331579.png" alt="image-20240906232331579"></p>
<p><code>findhash</code> 查一下（一个ida插件）</p>
<p><img src="/image-20240906234938265.png" alt="image-20240906234938265"></p>
<p>把函数 <code>sub_1900</code> 丢个GPT分析</p>
<p><img src="/image-20240906235859364.png" alt="image-20240906235859364"></p>
<p>是一个 <code>MD5</code> 算法</p>
<p><img src="/image-20240908215214389.png" alt="image-20240908215214389"></p>
<p>这个函数是根据方法名称进行调用，我们给他命名成 <code>callJavaObjectMethod</code>，前面还有一个新建 <code>object</code> 的函数</p>
<p>看一下前面的逻辑，建了一个空的对象，然后把 json 信息提取出来用 append 方法连接起来，再转成 string，丢尽函数 <code>sub_18C9C</code> 里面</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">v82[<span class="number">3</span>] = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">v13 = (*a1)-&gt;FindClass(a1, <span class="string">&quot;java/lang/StringBuffer&quot;</span>);</span><br><span class="line">v14 = (*a1)-&gt;GetMethodID(a1, v13, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;()V&quot;</span>);</span><br><span class="line">JavaObject = (<span class="type">void</span> *)createJavaObject(a1, v13, v14);</span><br><span class="line">appendFunc = (*a1)-&gt;GetMethodID(a1, v13, <span class="string">&quot;append&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)Ljava/lang/StringBuffer;&quot;</span>);</span><br><span class="line">v73 = v13;</span><br><span class="line">toStringFunc = (*a1)-&gt;GetMethodID(a1, v13, <span class="string">&quot;toString&quot;</span>, <span class="string">&quot;()Ljava/lang/String;&quot;</span>);</span><br><span class="line">v17 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">v18 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;functionId=&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( v18 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v18);</span><br><span class="line">v70 = v18;</span><br><span class="line"><span class="keyword">if</span> ( a3 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, a3);</span><br><span class="line"><span class="keyword">if</span> ( v17 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v17);</span><br><span class="line">v19 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;body=&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( v19 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v19);</span><br><span class="line"><span class="keyword">if</span> ( a4 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, a4);</span><br><span class="line"><span class="keyword">if</span> ( v17 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v17);</span><br><span class="line">v20 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;uuid=&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( v20 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v20);</span><br><span class="line"><span class="keyword">if</span> ( a5 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, a5);</span><br><span class="line"><span class="keyword">if</span> ( v17 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v17);</span><br><span class="line">v21 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;client=&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( v21 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v21);</span><br><span class="line"><span class="keyword">if</span> ( a6 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, a6);</span><br><span class="line"><span class="keyword">if</span> ( v17 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v17);</span><br><span class="line">v22 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;clientVersion=&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( v22 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v22);</span><br><span class="line"><span class="keyword">if</span> ( a7 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, a7);</span><br><span class="line"><span class="keyword">if</span> ( v17 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v17);</span><br><span class="line"><span class="built_in">memset</span>(v82, <span class="number">0</span>, <span class="number">21</span>);</span><br><span class="line">v23 = sub_18F7C((__int64)v82);</span><br><span class="line">v24 = (*a1)-&gt;NewStringUTF(a1, v23);</span><br><span class="line">v25 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;st=&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( v25 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v25);</span><br><span class="line"><span class="keyword">if</span> ( v24 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v24);</span><br><span class="line">v72 = v25;</span><br><span class="line">v74 = v24;</span><br><span class="line">v67 = v22;</span><br><span class="line">v68 = v21;</span><br><span class="line"><span class="keyword">if</span> ( v17 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v17);</span><br><span class="line">v65 = v17;</span><br><span class="line">v26 = rand() % <span class="number">3</span>;</span><br><span class="line">v27 = rand() % <span class="number">3</span>;</span><br><span class="line">__android_log_print(<span class="number">4</span>, <span class="string">&quot;SignJni&quot;</span>, <span class="string">&quot;encryptId=%d,offset=%d&quot;</span>, v26, v27);</span><br><span class="line">v28 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;sv=&quot;</span>);</span><br><span class="line">v29 = createIntegerObject(a1, <span class="number">1u</span>);</span><br><span class="line">v30 = createIntegerObject(a1, v27);</span><br><span class="line">v77 = (<span class="type">void</span> *)createIntegerObject(a1, v26);</span><br><span class="line"><span class="keyword">if</span> ( v28 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v28);</span><br><span class="line"><span class="keyword">if</span> ( v29 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v29);</span><br><span class="line"><span class="keyword">if</span> ( v30 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc, v30);</span><br><span class="line">v71 = v29;</span><br><span class="line">v66 = v28;</span><br><span class="line">v69 = v20;</span><br><span class="line"><span class="keyword">if</span> ( v77 )</span><br><span class="line">  callJavaObjectMethod(a1, JavaObject, appendFunc);</span><br><span class="line">str = (<span class="type">void</span> *)callJavaObjectMethod(a1, JavaObject, toStringFunc);</span><br><span class="line">v32 = (*a1)-&gt;GetStringUTFChars(a1, str, <span class="number">0LL</span>);</span><br><span class="line">__android_log_print(<span class="number">4</span>, <span class="string">&quot;SignJni&quot;</span>, <span class="string">&quot;info = %s&quot;</span>, v32);</span><br><span class="line">v78 = (*a1)-&gt;FindClass(a1, <span class="string">&quot;java/lang/String&quot;</span>);</span><br><span class="line">v33 = (*a1)-&gt;GetMethodID(a1, v78, <span class="string">&quot;getBytes&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)[B&quot;</span>);</span><br><span class="line">v79 = str;</span><br><span class="line">v76 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">v34 = (<span class="type">void</span> *)callJavaObjectMethod(a1, str, v33);</span><br><span class="line">v35 = (*a1)-&gt;GetArrayLength(a1, v34);</span><br><span class="line">v64 = v34;</span><br><span class="line">v36 = sub_18C9C(a1, v34, v35, <span class="number">1</span>, v26, v27);</span><br><span class="line">v37 = (*a1)-&gt;GetArrayLength(a1, v36);</span><br><span class="line">__android_log_print(<span class="number">4</span>, <span class="string">&quot;SignJni&quot;</span>, <span class="string">&quot;begin base64 theArrayLengthJ = %d&quot;</span>, v37);<span class="comment">// v37 是length</span></span><br><span class="line">v38 = (*a1)-&gt;GetByteArrayElements(a1, v36, <span class="number">0LL</span>);<span class="comment">// b64加密对象是 v38</span></span><br><span class="line">v39 = <span class="built_in">malloc</span>(<span class="number">2</span> * v37);</span><br><span class="line"><span class="built_in">memset</span>(v39, <span class="number">0</span>, <span class="number">2</span> * v37);</span><br><span class="line"><span class="keyword">if</span> ( v39 )</span><br><span class="line">&#123;</span><br><span class="line">  v63 = v19;</span><br><span class="line">  base64_encode(v39, (__int64)v38, v37);      <span class="comment">// 签名之前有个b64</span></span><br><span class="line">  <span class="built_in">memset</span>(v81, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">  v40 = <span class="built_in">strlen</span>(v39);</span><br><span class="line">  sub_25E0((<span class="type">int</span> *)v39, v40, (__int64)v81);    <span class="comment">// 签名算法主体</span></span><br><span class="line">  v41 = s;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i != <span class="number">32</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sprintf</span>(v41, <span class="string">&quot;%02x&quot;</span>, (<span class="type">unsigned</span> __int8)v81[i]);</span><br><span class="line">    v41 += <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  s[<span class="number">32</span>] = <span class="number">0</span>;</span><br><span class="line">  v43 = (*a1)-&gt;GetMethodID(a1, v73, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;()V&quot;</span>);</span><br><span class="line">  v44 = (<span class="type">void</span> *)createJavaObject(a1, v73, v43);</span><br><span class="line">  v45 = v44;</span><br><span class="line">  <span class="keyword">if</span> ( v72 )</span><br><span class="line">    callJavaObjectMethod(a1, v44, appendFunc);</span><br><span class="line">  <span class="keyword">if</span> ( v74 )</span><br><span class="line">    callJavaObjectMethod(a1, v45, appendFunc);</span><br><span class="line">  v46 = (*a1)-&gt;NewStringUTF(a1, s);</span><br><span class="line">  v47 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;&amp;sign=&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v47 )</span><br><span class="line">    callJavaObjectMethod(a1, v45, appendFunc, v47);</span><br><span class="line">  <span class="keyword">if</span> ( v46 )</span><br><span class="line">    callJavaObjectMethod(a1, v45, appendFunc, v46);</span><br><span class="line">  v48 = (*a1)-&gt;NewStringUTF(a1, <span class="string">&quot;&amp;sv=&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v48 )</span><br><span class="line">    callJavaObjectMethod(a1, v45, appendFunc, v48);</span><br><span class="line">  <span class="keyword">if</span> ( v71 )</span><br><span class="line">    callJavaObjectMethod(a1, v45, appendFunc);</span><br><span class="line">  <span class="keyword">if</span> ( v30 )</span><br><span class="line">    callJavaObjectMethod(a1, v45, appendFunc, v30);</span><br><span class="line">  <span class="keyword">if</span> ( v77 )</span><br><span class="line">    callJavaObjectMethod(a1, v45, appendFunc);</span><br><span class="line">  sub_18ACC((__int64)a1, (__int64)v45);</span><br><span class="line">  v49 = callJavaObjectMethod(a1, v45, toStringFunc);</span><br><span class="line">  <span class="keyword">if</span> ( v48 )</span><br><span class="line">    (*a1)-&gt;DeleteLocalRef(a1, v48);</span><br><span class="line">  <span class="keyword">if</span> ( v47 )</span><br><span class="line">    (*a1)-&gt;DeleteLocalRef(a1, v47);</span><br><span class="line">  v50 = v73;</span><br><span class="line">  <span class="keyword">if</span> ( v46 )</span><br><span class="line">    (*a1)-&gt;DeleteLocalRef(a1, v46);</span><br><span class="line">  v51 = v69;</span><br><span class="line">  <span class="keyword">if</span> ( v45 )</span><br><span class="line">    (*a1)-&gt;DeleteLocalRef(a1, v45);</span><br><span class="line">  <span class="built_in">free</span>(v39);</span><br><span class="line">  v19 = v63;</span><br><span class="line">  v52 = v68;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是前面有两个随机数也进去了，看起来在进入 base64 和 md5 之前还有一个加密操作，我们重点分析 <code>sub_18C9C</code></p>
<p><img src="/image-20240908220354187.png" alt="image-20240908220354187"></p>
<p>该函数前面是利用随机数计算出一个 <code>v19</code>，看起来是随机使用了 3 种方法进行加密，我们先分析 <code>case 2</code> 分支的加密函数</p>
<p><img src="/image-20240908221506852.png" alt="image-20240908221506852"></p>
<p>修一下变量声明</p>
<p><img src="/image-20240908222010394.png" alt="image-20240908222010394"></p>
<p>就一个 <code>sub_1882C</code> 有逻辑，第一个参数 v8 不用看，看起来该算法不是很复杂</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">sub_1882C</span><span class="params">(_QWORD *result, _BYTE *a2, <span class="type">char</span> a3, jbyte *input, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v9; <span class="comment">// x8</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// w13</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// w14</span></span><br><span class="line">  jbyte v12; <span class="comment">// w12</span></span><br><span class="line">  _QWORD v13[<span class="number">2</span>]; <span class="comment">// [xsp+0h] [xbp-40h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v13[<span class="number">1</span>] = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  <span class="keyword">if</span> ( len )</span><br><span class="line">  &#123;</span><br><span class="line">    result = sub_187DC(result, (__int64)a2, v13);</span><br><span class="line">    v9 = <span class="number">0LL</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v10 = byte_1A1E0[v9 &amp; <span class="number">0xF</span>];</span><br><span class="line">      <span class="keyword">if</span> ( (a3 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">        LOBYTE(v11) = byte_1A1E0[v9 &amp; <span class="number">0xF</span>];</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v11 = -v10;</span><br><span class="line">      v12 = ((v10 ^ input[v9] ^ a2[v9 &amp; <span class="number">7</span>]) + v11) ^ v10;</span><br><span class="line">      input[v9] = v12;</span><br><span class="line">      input[v9] = v12 ^ a2[v9 &amp; <span class="number">7</span>];</span><br><span class="line">      ++v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( len != v9 );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接用 frida 对该函数进行 hook ，偷一个脚本，对入参和函数执行结束后参数的值进行 hook</p>
<blockquote>
<p>在 TypeScript 中，<code>// @ts-ignore</code> 是一个注释指令，用于告诉 TypeScript 编译器忽略下一行代码的类型检查。</p>
<p>它的主要作用是在某些情况下，当你明确知道代码的行为是正确的，但 TypeScript 编译器可能会发出类型错误或警告时，使用 <code>// @ts-ignore</code> 可以暂时禁用这些类型检查，以便代码能够顺利编译和运行。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_dlsym</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> dlsymAddr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libdl.so&quot;</span>, <span class="string">&quot;dlsym&quot;</span>);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(dlsymAddr, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">args1</span> = args[<span class="number">1</span>];</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">findModuleByAddress</span>(retval);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">module</span> === <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">args1</span>.<span class="title function_">readCString</span>(), <span class="variable language_">module</span>.<span class="property">name</span>, retval, retval.<span class="title function_">sub</span>(<span class="variable language_">module</span>.<span class="property">base</span>));</span><br><span class="line">            <span class="keyword">let</span> <span class="built_in">exports</span> = <span class="title class_">Module</span>.<span class="title function_">enumerateExports</span>(<span class="variable language_">module</span>.<span class="property">name</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">exports</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="built_in">exports</span>[i]));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;----------------------------------------------------------------&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">print_arg</span>(<span class="params">addr</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">findRangeByAddress</span>(addr);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">module</span> != <span class="literal">null</span>) <span class="keyword">return</span> <span class="title function_">hexdump</span>(addr) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">ptr</span>(addr) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> addr + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_native_func</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> soAddr = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libjdbitmapkit.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> funcAddr = soAddr.<span class="title function_">add</span>(<span class="number">0x1882C</span>);</span><br><span class="line">    <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">findModuleByAddress</span>(funcAddr);</span><br><span class="line">    <span class="keyword">var</span> paramsNum = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(funcAddr, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">logs</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">params</span> = [];</span><br><span class="line">                <span class="comment">// @ts-ignore</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">logs</span> = <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">concat</span>(<span class="string">&quot;So: &quot;</span> + <span class="variable language_">module</span>.<span class="property">name</span> + <span class="string">&quot;  Method: sub_1882C offset: &quot;</span> + <span class="title function_">ptr</span>(funcAddr).<span class="title function_">sub</span>(<span class="variable language_">module</span>.<span class="property">base</span>) + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paramsNum; i++) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">params</span>.<span class="title function_">push</span>(args[i]);</span><br><span class="line">                    <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">// this.logs=this.logs.concat(&quot;this.args&quot; + i + &quot; onEnter: &quot; +args[i].readCString());</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">3</span>) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">logs</span> = <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">concat</span>(<span class="string">&quot;this.args&quot;</span> + i + <span class="string">&quot; onEnter: \n&quot;</span> + <span class="title function_">hexdump</span>(args[<span class="number">3</span>]));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">logs</span> = <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">concat</span>(<span class="string">&quot;this.args&quot;</span> + i + <span class="string">&quot; onEnter: \n&quot;</span> + <span class="title function_">print_arg</span>(args[i]));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paramsNum; i++) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">logs</span> = <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">concat</span>(<span class="string">&quot;\nthis.args&quot;</span> + i + <span class="string">&quot; onLeave: \n&quot;</span> + <span class="title function_">print_arg</span>(<span class="variable language_">this</span>.<span class="property">params</span>[i]));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">logs</span> = <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">concat</span>(<span class="string">&quot;retval onLeave: \n&quot;</span> + <span class="title function_">print_arg</span>(retval) + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">logs</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(hook_native_func);</span><br></pre></td></tr></table></figure>
<p>看一下结果，对比函数声明<code>sub_1882C(_QWORD *result, _BYTE *a2, char a3, jbyte *input, int len)</code>，a2 是密钥<code>80306f4370b39fd5630ad0529f77adb6</code>，input 是一个json转成的字符串，返回的时候明文被加密成了密文，也就是 args3 指向的地址，最后是长度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 6 Pro::京东 ]-&gt; So: libjdbitmapkit.so  Method: sub_1882C offset: 0x1882c</span><br><span class="line">this.args0 onEnter: </span><br><span class="line">             0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">733f90a2d8  90 05 13 66 74 00 00 00 60 a0 1a 96 74 00 00 00  ...ft...`...t...</span><br><span class="line">733f90a2e8  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">733f90a2f8  5b 1d 13 64 29 de 9f 56 b0 6b 17 06 75 00 00 00  [..d)..V.k..u...</span><br><span class="line">733f90a308  90 a3 90 3f 73 00 00 00 29 05 00 00 00 00 00 00  ...?s...).......</span><br><span class="line">733f90a318  01 00 00 00 00 00 00 00 d9 00 00 00 00 00 00 00  ................</span><br><span class="line">733f90a328  f0 02 0f 16 75 00 00 00 20 a4 90 3f 73 00 00 00  ....u... ..?s...</span><br><span class="line">733f90a338  ec 8e 59 38 74 00 00 00 34 34 65 37 31 35 61 36  ..Y8t...44e715a6</span><br><span class="line">733f90a348  65 33 32 32 63 63 62 37 64 30 32 38 66 37 61 34  e322ccb7d028f7a4</span><br><span class="line">733f90a358  32 66 61 35 35 30 34 30 00 00 00 00 00 00 00 00  2fa55040........</span><br><span class="line">733f90a368  37 64 30 30 36 39 36 36 30 63 39 62 35 64 33 32  7d0069660c9b5d32</span><br><span class="line">733f90a378  30 37 34 66 61 63 66 33 37 63 33 37 33 38 61 31  074facf37c3738a1</span><br><span class="line">733f90a388  00 00 00 00 00 00 00 00 38 30 33 30 36 66 34 33  ........80306f43</span><br><span class="line">733f90a398  37 30 62 33 39 66 64 35 36 33 30 61 64 30 35 32  70b39fd5630ad052</span><br><span class="line">733f90a3a8  39 66 37 37 61 64 62 36 00 00 00 00 00 00 00 00  9f77adb6........</span><br><span class="line">733f90a3b8  00 00 00 00 01 00 00 00 02 00 00 00 75 00 00 b4  ............u...</span><br><span class="line">733f90a3c8  5b 1d 13 64 29 de 9f 56 c0 44 fb 70 00 00 00 00  [..d)..V.D.p....</span><br><span class="line">this.args1 onEnter: </span><br><span class="line">             0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">733f90a390  38 30 33 30 36 66 34 33 37 30 62 33 39 66 64 35  80306f4370b39fd5</span><br><span class="line">733f90a3a0  36 33 30 61 64 30 35 32 39 66 37 37 61 64 62 36  630ad0529f77adb6</span><br><span class="line">733f90a3b0  00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00  ................</span><br><span class="line">733f90a3c0  02 00 00 00 75 00 00 b4 5b 1d 13 64 29 de 9f 56  ....u...[..d)..V</span><br><span class="line">733f90a3d0  c0 44 fb 70 00 00 00 00 19 01 00 00 00 00 00 00  .D.p............</span><br><span class="line">733f90a3e0  00 00 00 00 00 00 00 00 b5 04 00 00 00 00 00 00  ................</span><br><span class="line">733f90a3f0  34 a2 59 38 74 00 00 00 0d 05 00 00 00 00 00 00  4.Y8t...........</span><br><span class="line">733f90a400  35 04 00 00 00 00 00 00 41 00 00 00 00 00 00 00  5.......A.......</span><br><span class="line">733f90a410  02 00 00 00 00 00 00 00 f0 02 0f 16 75 00 00 00  ............u...</span><br><span class="line">733f90a420  60 a6 90 3f 73 00 00 00 2c 96 59 38 74 00 00 00  `..?s...,.Y8t...</span><br><span class="line">733f90a430  18 00 00 00 00 00 00 00 0d 05 00 00 00 00 00 00  ................</span><br><span class="line">733f90a440  61 00 00 00 00 00 00 00 b5 03 00 00 00 00 00 00  a...............</span><br><span class="line">733f90a450  95 02 00 00 00 00 00 00 15 02 00 00 00 00 00 00  ................</span><br><span class="line">733f90a460  95 01 00 00 00 00 00 00 81 00 00 00 00 00 00 00  ................</span><br><span class="line">733f90a470  00 b0 90 3f 73 00 00 00 15 04 00 00 00 00 00 00  ...?s...........</span><br><span class="line">733f90a480  35 03 00 00 00 00 00 00 2d 00 00 00 00 00 00 00  5.......-.......</span><br><span class="line">this.args2 onEnter: </span><br><span class="line">0x1</span><br><span class="line">this.args3 onEnter: </span><br><span class="line">             0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">7506176bb0  66 75 6e 63 74 69 6f 6e 49 64 3d 73 65 61 72 63  functionId=searc</span><br><span class="line">7506176bc0  68 42 6f 78 57 6f 72 64 26 62 6f 64 79 3d 7b 22  hBoxWord&amp;body=&#123;&quot;</span><br><span class="line">7506176bd0  61 70 70 54 79 70 65 22 3a 30 2c 22 67 65 6f 22  appType&quot;:0,&quot;geo&quot;</span><br><span class="line">7506176be0  3a 22 56 4e 66 4f 32 77 51 48 6d 76 50 34 79 35  :&quot;VNfO2wQHmvP4y5</span><br><span class="line">7506176bf0  6e 4d 7a 47 35 37 61 6f 5a 36 4a 65 4d 54 47 70  nMzG57aoZ6JeMTGp</span><br><span class="line">7506176c00  38 71 55 30 4d 58 73 73 70 37 53 4e 44 4f 46 50  8qU0MXssp7SNDOFP</span><br><span class="line">7506176c10  64 53 53 31 6c 67 31 64 54 4d 62 52 70 43 49 45  dSS1lg1dTMbRpCIE</span><br><span class="line">7506176c20  67 6c 22 2c 22 68 6f 6d 65 41 72 65 61 43 6f 64  gl&quot;,&quot;homeAreaCod</span><br><span class="line">7506176c30  65 22 3a 22 30 22 7d 26 75 75 69 64 3d 31 62 35  e&quot;:&quot;0&quot;&#125;&amp;uuid=1b5</span><br><span class="line">7506176c40  38 65 63 64 39 30 34 32 35 36 32 31 35 26 63 6c  8ecd904256215&amp;cl</span><br><span class="line">7506176c50  69 65 6e 74 3d 61 6e 64 72 6f 69 64 26 63 6c 69  ient=android&amp;cli</span><br><span class="line">7506176c60  65 6e 74 56 65 72 73 69 6f 6e 3d 31 32 2e 32 2e  entVersion=12.2.</span><br><span class="line">7506176c70  32 26 73 74 3d 31 37 32 35 38 31 30 33 30 31 32  2&amp;st=17258103012</span><br><span class="line">7506176c80  32 35 26 73 76 3d 31 30 32 00 80 00 00 00 00 00  25&amp;sv=102.......</span><br><span class="line">7506176c90  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">7506176ca0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">this.args4 onEnter: </span><br><span class="line">0xd9</span><br><span class="line"></span><br><span class="line">this.args0 onLeave: </span><br><span class="line">             0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">733f90a2d8  90 05 13 66 74 00 00 00 60 a0 1a 96 74 00 00 00  ...ft...`...t...</span><br><span class="line">733f90a2e8  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">733f90a2f8  5b 1d 13 64 29 de 9f 56 b0 6b 17 06 75 00 00 00  [..d)..V.k..u...</span><br><span class="line">733f90a308  90 a3 90 3f 73 00 00 00 29 05 00 00 00 00 00 00  ...?s...).......</span><br><span class="line">733f90a318  01 00 00 00 00 00 00 00 d9 00 00 00 00 00 00 00  ................</span><br><span class="line">733f90a328  f0 02 0f 16 75 00 00 00 20 a4 90 3f 73 00 00 00  ....u... ..?s...</span><br><span class="line">733f90a338  ec 8e 59 38 74 00 00 00 34 34 65 37 31 35 61 36  ..Y8t...44e715a6</span><br><span class="line">733f90a348  65 33 32 32 63 63 62 37 64 30 32 38 66 37 61 34  e322ccb7d028f7a4</span><br><span class="line">733f90a358  32 66 61 35 35 30 34 30 00 00 00 00 00 00 00 00  2fa55040........</span><br><span class="line">733f90a368  37 64 30 30 36 39 36 36 30 63 39 62 35 64 33 32  7d0069660c9b5d32</span><br><span class="line">733f90a378  30 37 34 66 61 63 66 33 37 63 33 37 33 38 61 31  074facf37c3738a1</span><br><span class="line">733f90a388  00 00 00 00 00 00 00 00 38 30 33 30 36 66 34 33  ........80306f43</span><br><span class="line">733f90a398  37 30 62 33 39 66 64 35 36 33 30 61 64 30 35 32  70b39fd5630ad052</span><br><span class="line">733f90a3a8  39 66 37 37 61 64 62 36 00 00 00 00 00 00 00 00  9f77adb6........</span><br><span class="line">733f90a3b8  00 00 00 00 01 00 00 00 02 00 00 00 75 00 00 b4  ............u...</span><br><span class="line">733f90a3c8  5b 1d 13 64 29 de 9f 56 c0 44 fb 70 00 00 00 00  [..d)..V.D.p....</span><br><span class="line"></span><br><span class="line">this.args1 onLeave: </span><br><span class="line">             0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">733f90a390  38 30 33 30 36 66 34 33 37 30 62 33 39 66 64 35  80306f4370b39fd5</span><br><span class="line">733f90a3a0  36 33 30 61 64 30 35 32 39 66 37 37 61 64 62 36  630ad0529f77adb6</span><br><span class="line">733f90a3b0  00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00  ................</span><br><span class="line">733f90a3c0  02 00 00 00 75 00 00 b4 5b 1d 13 64 29 de 9f 56  ....u...[..d)..V</span><br><span class="line">733f90a3d0  c0 44 fb 70 00 00 00 00 19 01 00 00 00 00 00 00  .D.p............</span><br><span class="line">733f90a3e0  00 00 00 00 00 00 00 00 b5 04 00 00 00 00 00 00  ................</span><br><span class="line">733f90a3f0  34 a2 59 38 74 00 00 00 0d 05 00 00 00 00 00 00  4.Y8t...........</span><br><span class="line">733f90a400  35 04 00 00 00 00 00 00 41 00 00 00 00 00 00 00  5.......A.......</span><br><span class="line">733f90a410  02 00 00 00 00 00 00 00 f0 02 0f 16 75 00 00 00  ............u...</span><br><span class="line">733f90a420  60 a6 90 3f 73 00 00 00 2c 96 59 38 74 00 00 00  `..?s...,.Y8t...</span><br><span class="line">733f90a430  18 00 00 00 00 00 00 00 0d 05 00 00 00 00 00 00  ................</span><br><span class="line">733f90a440  61 00 00 00 00 00 00 00 b5 03 00 00 00 00 00 00  a...............</span><br><span class="line">733f90a450  95 02 00 00 00 00 00 00 15 02 00 00 00 00 00 00  ................</span><br><span class="line">733f90a460  95 01 00 00 00 00 00 00 81 00 00 00 00 00 00 00  ................</span><br><span class="line">733f90a470  00 b0 90 3f 73 00 00 00 15 04 00 00 00 00 00 00  ...?s...........</span><br><span class="line">733f90a480  35 03 00 00 00 00 00 00 2d 00 00 00 00 00 00 00  5.......-.......</span><br><span class="line"></span><br><span class="line">this.args2 onLeave: </span><br><span class="line">0x1</span><br><span class="line"></span><br><span class="line">this.args3 onLeave: </span><br><span class="line">             0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">7506176bb0  af cb 2a fb 1f 34 9b ed 06 55 5a eb 73 cb 45 0d  ..*..4...UZ.s.E.</span><br><span class="line">7506176bc0  91 d0 2b d0 fa 2a ae eb e3 53 b4 dc 57 a7 52 cc  ..+..*...S..W.R.</span><br><span class="line">7506176bd0  aa c6 3c 2c 1c 33 91 a1 f7 21 75 9a 75 cf 46 cc  ..&lt;,.3...!u.u.F.</span><br><span class="line">7506176be0  63 b0 12 26 09 0a 6e f6 0e b9 8a ee ae 9e 50 df  c..&amp;..n.......P.</span><br><span class="line">7506176bf0  97 23 26 df d8 f2 9d ee 17 27 93 dd 5b be 5e 1a  .#&amp;......&#x27;..[.^.</span><br><span class="line">7506176c00  61 c7 11 88 10 1b af f2 2d 28 78 c6 52 b1 59 fa  a.......-(x.R.Y.</span><br><span class="line">7506176c10  ad 21 1f 89 37 22 6d eb 11 be 8b ca 4e a5 a0 ef  .!..7&quot;m.....N...</span><br><span class="line">7506176c20  90 c2 ee 84 c5 2b 9b ec 22 b2 9b dd 7f a5 46 0e  .....+..&quot;.....F.</span><br><span class="line">7506176c30  ae b0 e6 ba db ed a9 a5 32 66 b6 dc 0b 9b 75 df  ........2f....u.</span><br><span class="line">7506176c40  61 fb 2f fc dc f3 60 b1 f2 27 5b a9 03 88 7a 36  a./...`..&#x27;[...z6</span><br><span class="line">7506176c50  92 fb 2a cc c0 2c 9a eb 2f 60 b6 dc 34 c5 47 33  ..*..,../`..4.G3</span><br><span class="line">7506176c60  ae fc 30 2e 08 3d af e8 24 5f 5a a9 00 90 05 c8  ..0..=..$_Z.....</span><br><span class="line">7506176c70  7b b4 3f cc c0 fc 63 b1 f2 29 5e a8 01 9a 08 dc  &#123;.?...c..)^.....</span><br><span class="line">7506176c80  7b 8b e2 cb 19 f8 6d b7 ef 00 80 00 00 00 00 00  &#123;.....m.........</span><br><span class="line">7506176c90  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">7506176ca0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line"></span><br><span class="line">this.args4 onLeave: </span><br><span class="line">0xd9</span><br><span class="line">retval onLeave: </span><br><span class="line">             0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">733f90a2d8  90 05 13 66 74 00 00 00 60 a0 1a 96 74 00 00 00  ...ft...`...t...</span><br><span class="line">733f90a2e8  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">733f90a2f8  5b 1d 13 64 29 de 9f 56 b0 6b 17 06 75 00 00 00  [..d)..V.k..u...</span><br><span class="line">733f90a308  90 a3 90 3f 73 00 00 00 29 05 00 00 00 00 00 00  ...?s...).......</span><br><span class="line">733f90a318  01 00 00 00 00 00 00 00 d9 00 00 00 00 00 00 00  ................</span><br><span class="line">733f90a328  f0 02 0f 16 75 00 00 00 20 a4 90 3f 73 00 00 00  ....u... ..?s...</span><br><span class="line">733f90a338  ec 8e 59 38 74 00 00 00 34 34 65 37 31 35 61 36  ..Y8t...44e715a6</span><br><span class="line">733f90a348  65 33 32 32 63 63 62 37 64 30 32 38 66 37 61 34  e322ccb7d028f7a4</span><br><span class="line">733f90a358  32 66 61 35 35 30 34 30 00 00 00 00 00 00 00 00  2fa55040........</span><br><span class="line">733f90a368  37 64 30 30 36 39 36 36 30 63 39 62 35 64 33 32  7d0069660c9b5d32</span><br><span class="line">733f90a378  30 37 34 66 61 63 66 33 37 63 33 37 33 38 61 31  074facf37c3738a1</span><br><span class="line">733f90a388  00 00 00 00 00 00 00 00 38 30 33 30 36 66 34 33  ........80306f43</span><br><span class="line">733f90a398  37 30 62 33 39 66 64 35 36 33 30 61 64 30 35 32  70b39fd5630ad052</span><br><span class="line">733f90a3a8  39 66 37 37 61 64 62 36 00 00 00 00 00 00 00 00  9f77adb6........</span><br><span class="line">733f90a3b8  00 00 00 00 01 00 00 00 02 00 00 00 75 00 00 b4  ............u...</span><br><span class="line">733f90a3c8  5b 1d 13 64 29 de 9f 56 c0 44 fb 70 00 00 00 00  [..d)..V.D.p....</span><br></pre></td></tr></table></figure>
<p>拿到密钥以后就能对该加密算法进行复现了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span><span class="params">(<span class="type">char</span> *input, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>* key = <span class="string">&quot;80306f4370b39fd5630ad0529f77adb6&quot;</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> table[] =</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="number">0x37</span>, <span class="number">0x92</span>, <span class="number">0x44</span>, <span class="number">0x68</span>, <span class="number">0xA5</span>, <span class="number">0x3D</span>, <span class="number">0xCC</span>, <span class="number">0x7F</span>, <span class="number">0xBB</span>, <span class="number">0x0F</span>, </span><br><span class="line">		<span class="number">0xD9</span>, <span class="number">0x88</span>, <span class="number">0xEE</span>, <span class="number">0x9A</span>, <span class="number">0xE9</span>, <span class="number">0x5A</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">uint8_t</span> tByte, tmp;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		tByte = table[i &amp; <span class="number">0xF</span>];</span><br><span class="line">		tmp = ((tByte ^ input[i] ^ key[i &amp; <span class="number">7</span>]) + tByte) ^ tByte;</span><br><span class="line">		*(<span class="type">uint8_t</span> *)(input + i) = tmp;</span><br><span class="line">		*(<span class="type">uint8_t</span> *)(input + i) = tmp ^ key[i &amp; <span class="number">7</span>];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> input[] = <span class="string">&quot;functionId=searchBoxWord&amp;body=&#123;\&quot;appType\&quot;:0,\&quot;geo\&quot;:\&quot;VNfO2wQHmvP4y5nMzG57aoZ6JeMTGp8qU0MXssp7SNDOFPdSS1lg1dTMbRpCIEgl\&quot;,\&quot;homeAreaCode\&quot;:\&quot;0\&quot;&#125;&amp;uuid=1b58ecd904256215&amp;client=android&amp;clientVersion=12.2.2&amp;st=1725810301225&amp;sv=102&quot;</span>;</span><br><span class="line">	<span class="type">int</span> len = <span class="built_in">strlen</span>(input);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;len: 0x%2x\n&quot;</span>, len);</span><br><span class="line">	encrypt(input, len);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%2x &quot;</span>, *(<span class="type">uint8_t</span> *)(input + i));</span><br><span class="line">		<span class="keyword">if</span>((i + <span class="number">1</span>) % <span class="number">0xF</span> == <span class="number">0</span>)<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>流程就是加密 -&gt; base64 -&gt; md5，不过本次复现只实现了 case 2 的，剩下两个加密有点看不懂了，看文章说得 unidbg，赶紧学学</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-282678.htm">[原创]记录一次某app的sign分析过程（篇章一）新手推荐-Android安全-看雪-安全社区|安全招聘|kanxue.com</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_16236578/10706377">x-api-eid-token_mob64e737fed71c的技术博客_51CTO博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/revercc/p/17944995">某电商app的sign分析 - 怎么可以吃突突 - 博客园 (cnblogs.com)</a></p>
</div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">EPs1l0h</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/EPs1l0h"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Spears shall be shaken! Shields shall be splintered! A sword day! A red day! Ere the sun rises!</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/20/unidbg%E5%88%9D%E6%8E%A2/" title="unidbg初探"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover1.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="unidbg初探"/></a><div class="content"><a class="title" href="/2024/09/20/unidbg%E5%88%9D%E6%8E%A2/" title="unidbg初探">unidbg初探</a><time datetime="2024-09-20T15:37:23.000Z" title="发表于 2024-09-20 23:37:23">2024-09-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/27/%E4%B8%8A%E6%B5%B7%E5%A4%A7%E5%AD%A6%E7%94%9F-2024-re/" title="上海大学生-2024-re"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover2.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="上海大学生-2024-re"/></a><div class="content"><a class="title" href="/2024/05/27/%E4%B8%8A%E6%B5%B7%E5%A4%A7%E5%AD%A6%E7%94%9F-2024-re/" title="上海大学生-2024-re">上海大学生-2024-re</a><time datetime="2024-05-27T14:35:03.000Z" title="发表于 2024-05-27 22:35:03">2024-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/27/%E4%BA%AC%E9%BA%92CTF-2024-re-wp/" title="京麒CTF-2024-re-wp"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover2.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="京麒CTF-2024-re-wp"/></a><div class="content"><a class="title" href="/2024/05/27/%E4%BA%AC%E9%BA%92CTF-2024-re-wp/" title="京麒CTF-2024-re-wp">京麒CTF-2024-re-wp</a><time datetime="2024-05-27T13:37:23.000Z" title="发表于 2024-05-27 21:37:23">2024-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/25/%E9%93%81%E4%B8%892024-re/" title="铁三2024-re"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover2.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="铁三2024-re"/></a><div class="content"><a class="title" href="/2024/05/25/%E9%93%81%E4%B8%892024-re/" title="铁三2024-re">铁三2024-re</a><time datetime="2024-05-25T03:42:12.000Z" title="发表于 2024-05-25 11:42:12">2024-05-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/19/BeginCTF2024-re-wp/" title="BeginCTF2024-re-wp"><img src="https://github.com/EPs1l0h/EPs1l0h.github.io/blob/main/medias/cover/cover2.jpg?raw=true" onerror="this.onerror=null;this.src='/img/404.gif'" alt="BeginCTF2024-re-wp"/></a><div class="content"><a class="title" href="/2024/02/19/BeginCTF2024-re-wp/" title="BeginCTF2024-re-wp">BeginCTF2024-re-wp</a><time datetime="2024-02-19T06:55:40.000Z" title="发表于 2024-02-19 14:55:40">2024-02-19</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/jottings/"><span class="card-category-list-name">jottings</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/notes/"><span class="card-category-list-name">notes</span><span class="card-category-list-count">21</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/writeup/"><span class="card-category-list-name">writeup</span><span class="card-category-list-count">24</span></a></li>
            </ul></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><span class="card-archive-list-count">1</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">48</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-10-31T14:46:54.733Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By EPs1l0h</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://example.com/%E6%9F%90%E4%B8%9Csign%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95.html'
    this.page.identifier = '/%E6%9F%90%E4%B8%9Csign%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95.html'
    this.page.title = '某东sign算法分析记录（萌新向）'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Disqus' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><div class="aplayer no-destroy" data-id="2981528901" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>